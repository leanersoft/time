<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Vite HMR (dev only) -->

    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta
      name="description"
      content="A mobile-first, offline-first time tracking application"
    />
    <title>Pragmatic Focus - Time Tracker</title>

    <!-- Initial theme on <html> BEFORE paint (prevents FOUC and respects saved choice) -->
    <script>
      (function () {
        try {
          const saved = localStorage.getItem("theme"); // 'light' | 'dark'
          const theme =
            saved === "light" || saved === "dark"
              ? saved
              : window.matchMedia("(prefers-color-scheme: dark)").matches
              ? "dark"
              : "light";
          document.documentElement.classList.toggle("dark", theme === "dark");
        } catch (_) {}
      })();
    </script>

    <!-- Hide UI until Alpine initializes -->
    <style>
      [x-cloak] {
        display: none !important;
      }
    </style>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap"
      rel="stylesheet"
    />
    <script type="module" crossorigin src="/assets/main-D9O-0MtM.js"></script>
    <link rel="stylesheet" crossorigin href="/assets/main-DI0-TDfk.css">
  </head>

  <body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-200">
    <div id="app" x-data="appState" x-init="init" x-cloak class="min-h-screen">
      <!-- Top Header -->
      <header class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 sticky top-0 z-30">
        <div class="container py-3 flex items-center justify-between">
          <h1 class="text-lg font-semibold text-gray-900 dark:text-white">
            <span x-show="currentPage === 'timer'">Timer</span>
            <span x-show="currentPage === 'timeline'">Timeline</span>
            <span x-show="currentPage === 'insights'">Insights</span>
            <span x-show="currentPage === 'settings'">Settings</span>
          </h1>
          <button
            @click="$store.theme.toggle()"
            class="btn-icon bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"
          >
            <span x-text="$store.theme.theme === 'dark' ? '☀️' : '🌙'"></span>
          </button>
        </div>
        
        <!-- Inline Notifications -->
        <div x-data="notifications" x-init="init">
          <template x-for="notification in visibleNotifications" :key="notification.id">
            <div
              x-show="notification"
              x-transition:enter="transition ease-out duration-200"
              x-transition:enter-start="opacity-0 transform -translate-y-2"
              x-transition:enter-end="opacity-100 transform translate-y-0"
              x-transition:leave="transition ease-in duration-150"
              x-transition:leave-start="opacity-100 transform translate-y-0"
              x-transition:leave-end="opacity-0 transform -translate-y-2"
              class="mx-4 mb-2 px-3 py-2 rounded border text-xs flex items-center gap-2"
              :class="getTypeClasses(notification.type)"
            >
              <span class="text-current font-medium" x-text="getTypeIcon(notification.type)"></span>
              <span class="flex-1" x-text="notification.message"></span>
              <button
                @click="remove(notification.id)"
                class="text-current opacity-50 hover:opacity-100 transition-opacity text-sm leading-none"
              >
                ×
              </button>
            </div>
          </template>
        </div>
      </header>

      <div class="pb-20">
        <!-- Timer Page -->
        <div x-show="currentPage === 'timer'" class="container py-6">
          <!-- Parent timer component -->
          <div x-data="timer" @toggle-activity="toggleActivity($event.detail)">
            <!-- Page Title and Status -->
            <div class="text-center mb-8">
              <h2 
                x-show="!currentActivity"
                class="text-2xl font-semibold text-gray-900 dark:text-white mb-4"
              >
                What are you doing?
              </h2>
              <h2 
                x-show="currentActivity"
                class="text-2xl font-semibold text-gray-900 dark:text-white mb-2"
                x-text="currentActivity?.label"
              >
              </h2>
              <p
                x-show="currentActivity"
                class="text-gray-600 dark:text-gray-400 text-sm mb-4"
              >
                Started at <span x-text="formatStartTime()"></span>
              </p>
            </div>

            <!-- Timer Display -->
            <div class="text-center mb-8">
              <div
                class="text-5xl md:text-6xl font-mono font-medium text-gray-900 dark:text-white tracking-tight"
                x-text="formatTime(elapsed)"
              >
                00:00:00
              </div>
              <!-- Subcategory indicator -->
              <p 
                x-show="currentSubcategory"
                class="text-sm text-gray-600 dark:text-gray-400 mt-2"
              >
                <span x-text="currentSubcategory"></span>
              </p>
            </div>
            
            <!-- Subcategory Picker Modal -->
            <div 
              x-show="showSubcategoryPicker"
              x-transition:enter="transition ease-out duration-200"
              x-transition:enter-start="opacity-0 scale-95"
              x-transition:enter-end="opacity-100 scale-100"
              x-transition:leave="transition ease-in duration-150" 
              x-transition:leave-start="opacity-100 scale-100"
              x-transition:leave-end="opacity-0 scale-95"
              class="mb-8"
            >
              <div class="card border-blue-200 dark:border-blue-700">
                <div class="text-center mb-4">
                  <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">
                    Choose subcategory for 
                    <span class="text-blue-600 dark:text-blue-400" x-text="currentActivity?.label"></span>
                  </h3>
                  <p class="text-sm text-gray-600 dark:text-gray-400">
                    Select a specific activity or skip to use general category
                  </p>
                </div>
                
                <div class="grid grid-cols-2 gap-2 mb-4">
                  <template x-for="sub in currentActivity?.subcategories || []" :key="sub">
                    <button
                      @click="selectSubcategory(sub)"
                      class="p-3 text-sm rounded-lg border transition-colors"
                      :class="currentSubcategory === sub ? 
                        'ring-1' : 
                        'border-gray-200 dark:border-gray-700'"
                      :style="currentSubcategory === sub ? 
                        `border-color: ${currentActivity?.color}; ring-color: color-mix(in srgb, ${currentActivity?.color} 30%, transparent); background-color: color-mix(in srgb, ${currentActivity?.color} 8%, transparent)` :
                        `--hover-border: ${currentActivity?.color}; --hover-bg: color-mix(in srgb, ${currentActivity?.color} 8%, transparent)`"
                      @mouseenter="$event.target.style.borderColor = currentActivity?.color || '#6b7280'; $event.target.style.backgroundColor = `color-mix(in srgb, ${currentActivity?.color || '#6b7280'} 8%, transparent)`"
                      @mouseleave="if (currentSubcategory !== sub) { $event.target.style.borderColor = ''; $event.target.style.backgroundColor = '' }"
                    >
                      <span x-text="sub" class="capitalize"></span>
                    </button>
                  </template>
                </div>
                
                <div class="flex gap-2">
                  <button
                    @click="resetSubcategory()"
                    class="btn-secondary flex-1"
                  >
                    Reset
                  </button>
                </div>
              </div>
            </div>

            <!-- Activity Bubbles (child component; no $parent) -->
            <div
              class="grid grid-cols-2 gap-4 mb-8"
              x-data="activities(currentActivity?.id)"
            >
              <template x-for="activity in activities" :key="activity.id">
                <div
                  @click="handleActivityClick(activity)"
                  @dblclick="handleActivityDoubleClick(activity)"
                  class="activity-bubble relative group"
                  :class="activity.id === currentActivity?.id ? 'activity-bubble-active' : 'activity-bubble-inactive'"
                  :style="`--activity-color: ${activity.color}`"
                >
                  <!-- Color indicator -->
                  <div 
                    class="absolute top-2 right-2 w-4 h-4 rounded-full transition-opacity opacity-30 group-hover:opacity-70"
                    :style="`background-color: ${activity.color}`"
                  ></div>
                  
                  <div class="text-2xl mb-1" x-text="activity.icon"></div>
                  <div
                    class="font-medium text-sm text-gray-700 dark:text-gray-300"
                    x-text="activity.label"
                  ></div>
                  <div
                    x-show="todayDurations?.[activity.id] > 0"
                    class="text-xs text-gray-500 dark:text-gray-400 font-mono mt-1"
                    x-text="formatDurationFromSeconds(todayDurations?.[activity.id] || 0)"
                  ></div>
                </div>
              </template>
            </div>

            <!-- Stop Button -->
            <button
              x-show="currentActivity"
              @click="stopTracking"
              class="btn-danger w-full mb-6"
            >
              Stop Tracking
            </button>

            <!-- Natural Language Input -->
            <div class="card">
              <h3
                class="text-lg font-medium text-gray-900 dark:text-white mb-4"
              >
                Quick Add
              </h3>
              <textarea
                id="natural-language-input"
                name="naturalLanguageInput"
                x-model="naturalInput"
                @keydown.enter.meta.prevent="parseNaturalLanguage"
                class="input mb-4"
                rows="3"
                placeholder="e.g. work 9-12, break 30min, meeting till 3pm&#10;or: 9-12 work, 30min break, till 3pm meeting&#10;or: work 20m, break 10m (stacked from now)"
              ></textarea>
              <button
                @click="parseNaturalLanguage"
                class="btn-secondary w-full"
              >
                Add Entries
              </button>
            </div>
          </div>
        </div>

        <!-- Timeline Page -->
        <div x-show="currentPage === 'timeline'" class="container py-6">
          <div x-data="timeline">
            <!-- Period Selection -->
            <div class="card mb-4">
              <div class="flex flex-wrap items-center justify-between gap-4">
                <div class="flex flex-wrap gap-2">
                  <button
                    @click="selectPeriod('today')"
                    class="btn-secondary text-sm"
                    :class="{ 'bg-blue-600 text-white': selectedPeriod === 'today' }"
                  >
                    Today
                  </button>
                  <button
                    @click="selectPeriod('week')"
                    class="btn-secondary text-sm"
                    :class="{ 'bg-blue-600 text-white': selectedPeriod === 'week' }"
                  >
                    Week
                  </button>
                  <button
                    @click="selectPeriod('2-weeks')"
                    class="btn-secondary text-sm"
                    :class="{ 'bg-blue-600 text-white': selectedPeriod === '2-weeks' }"
                  >
                    2 Weeks
                  </button>
                  <button
                    @click="selectPeriod('custom')"
                    class="btn-secondary text-sm"
                    :class="{ 'bg-blue-600 text-white': selectedPeriod === 'custom' }"
                  >
                    Custom
                  </button>
                </div>
                
                <!-- Custom Date Range -->
                <div x-show="selectedPeriod === 'custom'" class="flex items-center gap-2 text-sm">
                  <input
                    type="date"
                    x-model="customStartDate"
                    class="input py-1 text-sm"
                  />
                  <span class="text-gray-500 dark:text-gray-400">to</span>
                  <input
                    type="date"
                    x-model="customEndDate"
                    class="input py-1 text-sm"
                  />
                  <button
                    @click="applyCustomDateRange()"
                    class="btn-primary text-sm"
                  >
                    Apply
                  </button>
                </div>
              </div>
              
              <!-- Date Range Display -->
              <div class="mt-3 pt-3 border-t border-gray-200 dark:border-gray-700">
                <p class="text-sm text-gray-500 dark:text-gray-400" x-text="dateRangeText"></p>
              </div>
            </div>

            <!-- Summary Card -->
            <div class="card mb-6">
              <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-3" x-text="periodLabel + ' Summary'"></h2>
              <div class="grid grid-cols-2 gap-4 text-sm">
                <div>
                  <span class="text-gray-500 dark:text-gray-400">Total Tracked:</span>
                  <span class="font-medium text-gray-900 dark:text-white ml-2" x-text="formatDuration(totalTime)"></span>
                </div>
                <div>
                  <span class="text-gray-500 dark:text-gray-400">Entries:</span>
                  <span class="font-medium text-gray-900 dark:text-white ml-2" x-text="entries.length"></span>
                </div>
              </div>
            </div>

            <!-- Timeline -->
            <div class="card">
              <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Timeline</h2>
                <button
                  @click="exportTimeline()"
                  class="btn-secondary text-sm"
                  :disabled="entries.length === 0"
                >
                  📄 Export
                </button>
              </div>
              
              <!-- Empty State -->
              <template x-if="entries.length === 0">
                <div class="text-center py-12 text-gray-500 dark:text-gray-400">
                  <div class="text-4xl mb-4">📅</div>
                  <h3 class="text-lg font-medium mb-2">No entries yet</h3>
                  <p class="text-sm">Start tracking to see your timeline</p>
                </div>
              </template>

              <!-- Timeline Items -->
              <div x-show="entries.length > 0" class="space-y-2">
                <template x-for="(item, index) in timelineItems" :key="index">
                  <div class="flex items-stretch">
                    <!-- Time Label -->
                    <div class="w-16 text-right pr-4 py-2 text-sm text-gray-500 dark:text-gray-400 font-mono flex-shrink-0" x-text="item.timeLabel"></div>
                    
                    <!-- Entry or Gap -->
                    <div class="flex-1 min-w-0">
                      <!-- Entry -->
                      <template x-if="item.type === 'entry'">
                        <div 
                          class="bg-gray-100 dark:bg-gray-700 rounded-lg px-4 py-3 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors border-l-4"
                          :style="`border-left-color: ${getActivityColor(item.entry)}`"
                          @click="editEntry(item.entry)"
                        >
                          <div class="flex items-center gap-2 mb-1">
                            <span class="text-lg" x-text="getActivityIcon(item.entry)"></span>
                            <span class="font-medium text-gray-900 dark:text-white" x-text="item.entry.description"></span>
                          </div>
                          <div class="flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400">
                            <span x-text="formatTime(item.entry.startTime) + ' - ' + (item.entry.endTime ? formatTime(item.entry.endTime) : 'ongoing')"></span>
                            <span x-text="formatDuration(item.entry.duration || 0)"></span>
                          </div>
                        </div>
                      </template>
                      
                      <!-- Gap -->
                      <template x-if="item.type === 'gap'">
                        <div 
                          class="bg-gray-50 dark:bg-gray-800 rounded-lg px-4 py-3 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors border-l-4 border-dashed border-gray-300 dark:border-gray-600"
                          @click="openFillGapModal(item)"
                        >
                          <div class="flex items-center gap-2 mb-1">
                            <span class="text-lg">⏳</span>
                            <span class="font-medium text-gray-500 dark:text-gray-400">Untracked time</span>
                          </div>
                          <div class="flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400">
                            <span x-text="formatTime(item.start) + ' - ' + formatTime(item.end)"></span>
                            <span x-text="formatDuration(item.duration)"></span>
                          </div>
                        </div>
                      </template>
                    </div>
                  </div>
                </template>
              </div>
            </div>

            <!-- Fill Gap Modal -->
            <div
              x-show="showFillGapModal"
              x-transition:enter="transition ease-out duration-200"
              x-transition:enter-start="opacity-0"
              x-transition:enter-end="opacity-100"
              x-transition:leave="transition ease-in duration-150"
              x-transition:leave-start="opacity-100"
              x-transition:leave-end="opacity-0"
              class="fixed inset-0 bg-black bg-opacity-50 flex items-end sm:items-center justify-center z-50 p-4"
              @click.self="showFillGapModal = false"
            >
              <div
                x-transition:enter="transition ease-out duration-200"
                x-transition:enter-start="opacity-0 transform translate-y-4 sm:translate-y-0 sm:scale-95"
                x-transition:enter-end="opacity-100 transform translate-y-0 sm:scale-100"
                x-transition:leave="transition ease-in duration-150"
                x-transition:leave-start="opacity-100 transform translate-y-0 sm:scale-100"
                x-transition:leave-end="opacity-0 transform translate-y-4 sm:translate-y-0 sm:scale-95"
                class="bg-white dark:bg-gray-800 rounded-t-2xl sm:rounded-2xl w-full sm:max-w-md max-h-screen overflow-y-auto"
              >
                <div class="p-6">
                  <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">What were you doing?</h2>
                  <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">
                    <span x-text="gapStart ? formatTime(gapStart) : ''"></span> -
                    <span x-text="gapEnd ? formatTime(gapEnd) : ''"></span>
                    (<span x-text="gapStart && gapEnd ? formatDuration(Math.floor((gapEnd.getTime() - gapStart.getTime()) / 1000)) : ''"></span>)
                  </p>

                  <!-- Activity Buttons -->
                  <div class="grid grid-cols-2 gap-3 mb-6">
                    <template x-for="activity in ($store.activities?.all || [])" :key="activity.id">
                      <button
                        @click="fillGapWithActivity(activity)"
                        class="flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-lg border-l-4 transition-colors text-left"
                        :style="`border-left-color: ${activity.color}`"
                      >
                        <span class="text-lg" x-text="activity.icon"></span>
                        <span class="font-medium text-gray-900 dark:text-white" x-text="activity.label"></span>
                      </button>
                    </template>
                  </div>

                  <!-- Natural Language Input -->
                  <div class="mb-6">
                    <input
                      type="text"
                      x-model="gapNaturalInput"
                      @keydown.enter="fillGapNatural"
                      class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400"
                      placeholder="e.g. work, break, personal"
                    />
                  </div>

                  <button
                    @click="showFillGapModal = false"
                    class="w-full py-3 px-4 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors"
                  >
                    Cancel
                  </button>
                </div>
              </div>
            </div>

            <!-- Edit Entry Modal -->
            <div
              x-show="showEditModal"
              x-transition:enter="transition ease-out duration-200"
              x-transition:enter-start="opacity-0"
              x-transition:enter-end="opacity-100"
              x-transition:leave="transition ease-in duration-150"
              x-transition:leave-start="opacity-100"
              x-transition:leave-end="opacity-0"
              class="fixed inset-0 bg-black bg-opacity-50 flex items-end sm:items-center justify-center z-50 p-4"
              @click.self="showEditModal = false"
            >
              <div
                x-transition:enter="transition ease-out duration-200"
                x-transition:enter-start="opacity-0 transform translate-y-4 sm:translate-y-0 sm:scale-95"
                x-transition:enter-end="opacity-100 transform translate-y-0 sm:scale-100"
                x-transition:leave="transition ease-in duration-150"
                x-transition:leave-start="opacity-100 transform translate-y-0 sm:scale-100"
                x-transition:leave-end="opacity-0 transform translate-y-4 sm:translate-y-0 sm:scale-95"
                class="bg-white dark:bg-gray-800 rounded-t-2xl sm:rounded-2xl w-full sm:max-w-md max-h-screen overflow-y-auto"
              >
                <div class="p-6">
                  <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Edit Entry</h2>
                  <div class="mb-4">
                    <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">
                      <span x-text="editingEntry?.description"></span>
                    </p>
                    <div class="grid grid-cols-2 gap-4 mb-6">
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Start Time</label>
                        <input 
                          type="time" 
                          x-model="editStartTime" 
                          class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 dark:text-white"
                        />
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">End Time</label>
                        <input 
                          type="time" 
                          x-model="editEndTime" 
                          class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 dark:text-white"
                        />
                      </div>
                    </div>
                    
                    <div class="flex gap-3">
                      <button
                        @click="saveEntry"
                        class="flex-1 py-3 px-4 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium"
                      >
                        Save Changes
                      </button>
                      <button
                        @click="deleteEntry"
                        class="py-3 px-4 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors"
                      >
                        Delete
                      </button>
                    </div>
                    
                    <button
                      @click="showEditModal = false"
                      class="w-full mt-3 py-3 px-4 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors"
                    >
                      Cancel
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Insights Page -->
        <div x-show="currentPage === 'insights'" class="container py-6">
          <div x-data="insights">
            <!-- Time Period Filters -->
            <div class="card mb-6">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-medium text-gray-900 dark:text-white">
                  Time Period
                </h3>
                <button
                  @click="exportInsights()"
                  class="btn-secondary text-sm"
                  :disabled="!summary || loading"
                >
                  📄 Export Insights
                </button>
              </div>
              <div class="flex flex-wrap gap-2 mb-4">
                <button
                  @click="selectPeriod('today')"
                  :class="selectedPeriod === 'today' ? 'bg-blue-600 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'"
                  class="px-3 py-2 rounded-md text-sm font-medium"
                >
                  Today
                </button>
                <button
                  @click="selectPeriod('week')"
                  :class="selectedPeriod === 'week' ? 'bg-blue-600 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'"
                  class="px-3 py-2 rounded-md text-sm font-medium"
                >
                  This Week
                </button>
                <button
                  @click="selectPeriod('month')"
                  :class="selectedPeriod === 'month' ? 'bg-blue-600 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'"
                  class="px-3 py-2 rounded-md text-sm font-medium"
                >
                  This Month
                </button>
                <button
                  @click="selectPeriod('custom')"
                  :class="selectedPeriod === 'custom' ? 'bg-blue-600 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'"
                  class="px-3 py-2 rounded-md text-sm font-medium"
                >
                  Custom
                </button>
              </div>
              
              <!-- Custom Date Range -->
              <div x-show="selectedPeriod === 'custom'" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                    Start Date
                  </label>
                  <input
                    type="date"
                    x-model="customStartDate"
                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                    End Date
                  </label>
                  <input
                    type="date"
                    x-model="customEndDate"
                    @change="applyCustomDateRange()"
                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  />
                </div>
              </div>
            </div>

            <!-- Loading State -->
            <div x-show="loading" class="card mb-6">
              <div class="text-center py-8">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"></div>
                <p class="text-gray-600 dark:text-gray-400">Loading insights...</p>
              </div>
            </div>

            <!-- Summary Cards -->
            <template x-if="summary && !loading">
              <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <!-- Total Tracked -->
                <div class="card">
                  <div class="text-center">
                    <div class="text-2xl font-bold text-blue-600 dark:text-blue-400" x-text="formatDuration(summary.totalTracked)"></div>
                    <div class="text-sm text-gray-600 dark:text-gray-400">Total Tracked</div>
                  </div>
                </div>
                
                <!-- Daily Average -->
                <div class="card">
                  <div class="text-center">
                    <div class="text-2xl font-bold text-green-600 dark:text-green-400" x-text="formatDuration(summary.avgDailyTracking)"></div>
                    <div class="text-sm text-gray-600 dark:text-gray-400">Daily Average</div>
                  </div>
                </div>
                
                <!-- Current Streak -->
                <div class="card">
                  <div class="text-center">
                    <div class="text-2xl font-bold text-orange-600 dark:text-orange-400" x-text="summary.currentStreak + ' days'"></div>
                    <div class="text-sm text-gray-600 dark:text-gray-400">Current Streak</div>
                  </div>
                </div>
                
                <!-- Active Days -->
                <div class="card">
                  <div class="text-center">
                    <div class="text-2xl font-bold text-purple-600 dark:text-purple-400" x-text="summary.totalDays"></div>
                    <div class="text-sm text-gray-600 dark:text-gray-400">Active Days</div>
                  </div>
                </div>
              </div>
            </template>

            <!-- Activity Breakdown -->
            <template x-if="activityStats.length > 0 && !loading">
              <div class="card mb-6">
                <div class="flex items-center justify-between mb-4">
                  <h3 class="text-lg font-medium text-gray-900 dark:text-white">
                    Activity Breakdown
                  </h3>
                  <div class="text-sm text-gray-600 dark:text-gray-400">
                    <span x-text="activityStats.length"></span> activities
                  </div>
                </div>
                
                <div class="space-y-4">
                  <template x-for="activity in activityStats.slice(0, 8)" :key="activity.id">
                    <div class="flex items-center gap-3">
                      <div class="w-8 h-8 rounded-full flex items-center justify-center text-sm"
                           :style="`background-color: ${activity.color}20; color: ${activity.color}`">
                        <span x-text="activity.icon"></span>
                      </div>
                      <div class="flex-1 min-w-0">
                        <div class="flex items-center justify-between mb-1">
                          <span class="text-sm font-medium text-gray-900 dark:text-white" x-text="activity.label"></span>
                          <span class="text-sm text-gray-600 dark:text-gray-400" x-text="formatDuration(activity.totalSeconds)"></span>
                        </div>
                        <div class="flex items-center gap-2">
                          <div class="flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                            <div class="h-2 rounded-full transition-all"
                                 :style="`background-color: ${activity.color}; width: ${activity.percentage}%`"></div>
                          </div>
                          <span class="text-xs text-gray-500 dark:text-gray-400" x-text="formatPercentage(activity.percentage)"></span>
                        </div>
                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                          <span x-text="activity.entryCount"></span> sessions • 
                          avg <span x-text="formatDuration(activity.avgSessionDuration)"></span>
                        </div>
                      </div>
                    </div>
                  </template>
                </div>
              </div>
            </template>

            <!-- Daily Patterns -->
            <template x-if="dailyStats.length > 0 && !loading">
              <div class="card mb-6">
                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">
                  Daily Patterns
                </h3>
                
                <div class="space-y-2">
                  <template x-for="day in dailyStats.slice(-7)" :key="day.date">
                    <div class="flex items-center gap-3">
                      <div class="w-20 text-sm text-gray-600 dark:text-gray-400" x-text="formatDate(day.date)"></div>
                      <div class="flex-1">
                        <div class="flex items-center justify-between mb-1">
                          <span class="text-sm font-medium text-gray-900 dark:text-white" x-text="formatDuration(day.totalSeconds)"></span>
                          <span class="text-xs text-gray-500 dark:text-gray-400" x-text="day.entryCount + ' sessions'"></span>
                        </div>
                        <div class="bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                          <div class="h-2 bg-blue-500 rounded-full transition-all" 
                               :style="`width: ${day.productivity * 100}%`"></div>
                        </div>
                      </div>
                    </div>
                  </template>
                </div>
              </div>
            </template>

            <!-- Hourly Heatmap -->
            <template x-if="hourlyStats.length > 0 && !loading">
              <div class="card mb-6">
                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">
                  Time of Day Pattern
                </h3>
                
                <div class="grid grid-cols-12 gap-1">
                  <template x-for="hourStat in hourlyStats" :key="hourStat.hour">
                    <div class="text-center">
                      <div class="text-xs text-gray-500 dark:text-gray-400 mb-1" x-show="hourStat.hour % 2 === 0">
                        <span x-text="hourStat.hour.toString().padStart(2, '0')"></span>
                      </div>
                      <div class="w-full h-8 rounded-sm border border-gray-200 dark:border-gray-600 flex items-center justify-center relative group"
                           :class="hourStat.totalSeconds > 0 ? 'cursor-pointer' : ''"
                           :style="hourStat.totalSeconds > 0 ? `background-color: rgb(59, 130, 246, ${Math.min(hourStat.totalSeconds / Math.max(...hourlyStats.map(h => h.totalSeconds), 1), 1)})` : ''">
                        <!-- Tooltip -->
                        <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-gray-900 dark:bg-gray-100 text-white dark:text-gray-900 text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-10"
                             x-show="hourStat.totalSeconds > 0">
                          <span x-text="hourStat.hour.toString().padStart(2, '0') + ':00 - ' + formatDuration(hourStat.totalSeconds)"></span>
                        </div>
                      </div>
                    </div>
                  </template>
                </div>
                
                <div class="flex items-center justify-between text-xs text-gray-500 dark:text-gray-400 mt-2">
                  <span>Less active</span>
                  <span>More active</span>
                </div>
              </div>
            </template>

            <!-- Key Insights -->
            <template x-if="insights.length > 0 && !loading">
              <div class="card mb-6">
                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">
                  Key Insights
                </h3>
                
                <div class="space-y-3">
                  <template x-for="insight in insights" :key="insight">
                    <div class="flex items-start gap-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                      <div class="text-blue-600 dark:text-blue-400 text-sm" x-text="insight"></div>
                    </div>
                  </template>
                </div>
              </div>
            </template>

            <!-- Empty State -->
            <template x-if="!loading && !summary">
              <div class="card text-center py-12">
                <div class="text-6xl mb-4">📊</div>
                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">
                  No Data Available
                </h3>
                <p class="text-gray-600 dark:text-gray-400 mb-6">
                  Start tracking your activities to see detailed insights and patterns.
                </p>
                <button
                  @click="$store.app.navigateTo('timer')"
                  class="btn-primary"
                >
                  Start Tracking
                </button>
              </div>
            </template>

          </div>
        </div>

        <!-- Settings Page -->
        <div x-show="currentPage === 'settings'" class="container py-6">
          <div x-data="settings">
            <div class="space-y-6">
              
              <!-- Duration Threshold -->
              <div class="card">
                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">
                  Duration Threshold
                </h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                  Entries shorter than this will be automatically discarded
                </p>
                <div class="flex items-center gap-4">
                  <select 
                    x-model.number="durationThreshold"
                    class="flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  >
                    <template x-for="option in thresholdOptions" :key="option.value">
                      <option :value="option.value" x-text="option.label"></option>
                    </template>
                  </select>
                  <span class="text-sm font-medium text-gray-900 dark:text-white min-w-[60px]" x-text="getThresholdLabel()"></span>
                </div>
              </div>

              <!-- Time Rounding/Snap -->
              <div class="card">
                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">
                  Time Rounding/Snap
                </h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                  Snap timer start/end times to specific intervals for cleaner time tracking
                </p>
                <div class="flex items-center gap-4">
                  <select 
                    x-model="timeRounding"
                    class="flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  >
                    <template x-for="(option, index) in timeRoundingOptions" :key="'time-' + index">
                      <option :value="option.value" x-text="option.label"></option>
                    </template>
                  </select>
                  <span class="text-sm font-medium text-gray-900 dark:text-white min-w-[120px]" x-text="getTimeRoundingLabel()"></span>
                </div>
              </div>

              <!-- Activity Categories -->
              <div class="card">
                <div class="flex items-center justify-between mb-4">
                  <h3 class="text-lg font-medium text-gray-900 dark:text-white">
                    Activity Categories
                  </h3>
                  <button
                    @click="showAdvanced = !showAdvanced"
                    class="text-sm text-blue-600 dark:text-blue-400 hover:underline"
                  >
                    <span x-show="!showAdvanced">Advanced</span>
                    <span x-show="showAdvanced">Simple</span>
                  </button>
                </div>

                <!-- Simple Mode: Presets -->
                <div x-show="!showAdvanced" class="space-y-4">
                  <p class="text-sm text-gray-600 dark:text-gray-400">
                    Choose a preset to get started quickly
                  </p>
                  <div class="grid grid-cols-1 gap-3">
                    <template x-for="preset in presets" :key="preset.name">
                      <button
                        @click="applyPreset(preset)"
                        class="text-left p-4 rounded-lg border transition-colors"
                        :class="currentPreset === preset.name ? 
                          'border-blue-400 ring-1 ring-blue-300/50 hover:bg-blue-50 dark:hover:bg-blue-900/20' : 
                          'border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800'"
                      >
                        <div class="font-medium text-gray-900 dark:text-white" x-text="preset.name"></div>
                        <div class="text-sm text-gray-600 dark:text-gray-400" x-text="preset.description"></div>
                        <div class="flex gap-2 mt-2">
                          <template x-for="category in preset.categories" :key="category.id">
                            <span class="text-lg" x-text="category.icon"></span>
                          </template>
                        </div>
                      </button>
                    </template>
                  </div>
                </div>

                <!-- Advanced Mode: Custom Categories -->
                <div x-show="showAdvanced" class="space-y-4">
                  <!-- Column Headers -->
                  <div class="grid grid-cols-12 gap-3 items-center text-xs font-medium text-gray-500 dark:text-gray-400 mb-2">
                    <div class="col-span-2 text-center">Icon</div>
                    <div class="col-span-4">Name</div>
                    <div class="col-span-2 text-center">Color</div>
                    <div class="col-span-2 text-center">Max (h)</div>
                    <div class="col-span-2 text-center">Subcategories</div>
                    <div class="col-span-1"></div>
                  </div>
                  
                  <template x-for="(category, index) in categories" :key="category.id">
                    <div class="p-4 rounded-lg border border-gray-200 dark:border-gray-700">
                      <div class="grid grid-cols-12 gap-3 items-center">
                        <input
                          type="text"
                          x-model="category.icon"
                          placeholder="🔧"
                          class="col-span-2 input text-center"
                          maxlength="2"
                        />
                        <input
                          type="text"
                          x-model="category.label"
                          placeholder="Category name"
                          class="col-span-4 input"
                        />
                        <input
                          type="color"
                          x-model="category.color"
                          class="col-span-2 h-10 w-full rounded border border-gray-300 dark:border-gray-700"
                        />
                        <div class="col-span-2">
                          <select 
                            x-model="category.maxDuration"
                            class="w-full px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                          >
                            <template x-for="(option, index) in maxDurationOptions" :key="'max-' + index">
                              <option :value="option.value" x-text="option.label"></option>
                            </template>
                          </select>
                        </div>
                        <button
                          @click="toggleSubcategories(category.id)"
                          class="col-span-2 btn-secondary text-xs"
                        >
                          <span x-show="!category.showSub">+ Subcategories</span>
                          <span x-show="category.showSub">- Hide</span>
                        </button>
                        <button
                          @click="removeCategory(index)"
                          class="col-span-1 text-red-600 hover:text-red-700"
                        >
                          ×
                        </button>
                      </div>
                      
                      <!-- Subcategories -->
                      <div x-show="category.showSub" class="mt-4 pl-4 border-l-2 border-gray-200 dark:border-gray-700">
                        <div class="mb-3">
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Subcategories (comma-separated)
                          </label>
                          <textarea
                            x-model="category.subcategoriesText"
                            @input="updateSubcategories(category)"
                            placeholder="lunch, coffee break, rest, reading"
                            class="input"
                            rows="2"
                          ></textarea>
                        </div>
                        
                        
                        <div x-show="category.subcategories.length > 0" class="flex flex-wrap gap-1">
                          <template x-for="sub in category.subcategories" :key="sub">
                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 text-xs rounded" x-text="sub"></span>
                          </template>
                        </div>
                      </div>
                    </div>
                  </template>
                  
                  <button
                    @click="addCategory()"
                    class="w-full py-3 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg text-gray-600 dark:text-gray-400 hover:border-gray-400 dark:hover:border-gray-500 transition-colors"
                  >
                    + Add Category
                  </button>
                </div>
              </div>

              <!-- Data Export -->
              <div class="card">
                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">
                  Export Data
                </h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                  Export your time tracking data for backup or analysis
                </p>
                
                <!-- Date Range Filters -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                      Start Date (optional)
                    </label>
                    <input
                      type="date"
                      x-model="exportStartDate"
                      class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    />
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                      End Date (optional)
                    </label>
                    <input
                      type="date"
                      x-model="exportEndDate"
                      class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    />
                  </div>
                </div>
                
                <!-- Export Path Configuration -->
                <div class="mb-4">
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Default Export Directory (optional)
                  </label>
                  <div class="flex gap-2">
                    <input
                      type="text"
                      x-model="defaultExportPath"
                      placeholder="No default directory set - files will prompt for location"
                      readonly
                      class="flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 cursor-not-allowed"
                    />
                    <button
                      type="button"
                      @click="chooseExportDirectory()"
                      class="px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:border-transparent whitespace-nowrap"
                    >
                      📁 Choose
                    </button>
                    <button
                      type="button"
                      @click="clearExportDirectory()"
                      x-show="defaultExportPath"
                      class="px-3 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 focus:ring-2 focus:ring-gray-500 focus:border-transparent"
                    >
                      ✕
                    </button>
                  </div>
                  <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                    When set, exports will be saved directly to this directory. Leave empty to choose location each time.
                  </p>
                </div>

                <!-- Format and Compression Options -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                      Export Format
                    </label>
                    <select 
                      x-model="exportFormat"
                      class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    >
                      <option value="json">JSON (database backup)</option>
                      <option value="markdown">Markdown (readable report)</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                      Compression
                    </label>
                    <select 
                      x-model="exportCompression"
                      class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    >
                      <option value="none">None</option>
                      <option value="zip">ZIP</option>
                      <option value="gzip">GZIP</option>
                    </select>
                  </div>
                </div>

                <!-- Export Button -->
                <button
                  @click="exportData()"
                  class="w-full btn-primary flex items-center justify-center gap-2"
                >
                  <span>📊</span>
                  <span>Export Data</span>
                </button>

                <!-- Helper Text -->
                <p class="text-xs text-gray-500 dark:text-gray-400 mt-3">
                  Leave dates blank to export all data. JSON format includes complete database backup with settings. Markdown format creates a readable time tracking report.
                </p>
              </div>

              <!-- Settings Export -->
              <div class="card">
                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">
                  Export Settings
                </h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                  Export your application settings configuration for backup or sharing
                </p>
                
                <!-- Format Selection -->
                <div class="mb-4">
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Export Format
                  </label>
                  <select 
                    x-model="settingsExportFormat"
                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  >
                    <option value="yaml">YAML (most human-friendly)</option>
                    <option value="json">JSON (structured data)</option>
                    <option value="toml">TOML (configuration format)</option>
                    <option value="txt">Text (summary report)</option>
                  </select>
                </div>

                <!-- Export Button -->
                <button
                  @click="exportSettings()"
                  class="w-full btn-secondary flex items-center justify-center gap-2"
                >
                  <span>⚙️</span>
                  <span>Export Settings</span>
                </button>

                <!-- Helper Text -->
                <div class="text-xs text-gray-500 dark:text-gray-400 mt-3">
                  <p class="mb-1"><strong>YAML:</strong> Best for manual editing and version control</p>
                  <p class="mb-1"><strong>JSON:</strong> Best for programmatic access and tools</p>
                  <p class="mb-1"><strong>TOML:</strong> Great for configuration management</p>
                  <p><strong>Text:</strong> Human-readable summary with import instructions</p>
                </div>
              </div>

              <!-- Settings Import -->
              <div class="card">
                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">
                  Import Settings
                </h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                  Restore settings from a previously exported file (YAML, JSON, or TOML)
                </p>
                
                <!-- File Selection -->
                <div class="mb-4">
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Select Settings File
                  </label>
                  <input 
                    type="file"
                    id="settings-import-file"
                    accept=".yaml,.yml,.json,.toml"
                    @change="handleImportFileSelection($event)"
                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent file:mr-4 file:py-1 file:px-3 file:rounded file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 dark:file:bg-blue-900 dark:file:text-blue-300"
                  />
                  <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                    Supports YAML (.yaml, .yml), JSON (.json), and TOML (.toml) files
                  </p>
                </div>

                <!-- Import Preview -->
                <div x-show="showImportPreview" x-transition class="mb-4">
                  <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md p-4">
                    <div class="flex items-center gap-2 mb-3">
                      <span class="text-blue-600 dark:text-blue-400">📋</span>
                      <h4 class="font-medium text-blue-900 dark:text-blue-100">
                        Preview: <span x-text="settingsImportFormat"></span> Format
                      </h4>
                    </div>
                    
                    <!-- Validation Status -->
                    <div class="mb-3" x-show="settingsImportValidation">
                      <div x-show="settingsImportValidation && settingsImportValidation.isValid" class="flex items-center gap-2 text-green-700 dark:text-green-300">
                        <span>✅</span>
                        <span class="text-sm">Settings file is valid and ready to import</span>
                      </div>
                      <div x-show="settingsImportValidation && !settingsImportValidation.isValid" class="flex items-center gap-2 text-red-700 dark:text-red-300">
                        <span>❌</span>
                        <span class="text-sm">Settings file has validation errors</span>
                      </div>
                      
                      <!-- Errors -->
                      <div x-show="settingsImportValidation && settingsImportValidation.errors && settingsImportValidation.errors.length > 0" class="mt-2">
                        <p class="text-sm font-medium text-red-700 dark:text-red-300">Errors:</p>
                        <ul class="text-xs text-red-600 dark:text-red-400 ml-4 mt-1">
                          <template x-for="error in settingsImportValidation.errors" :key="error">
                            <li class="list-disc" x-text="error"></li>
                          </template>
                        </ul>
                      </div>
                      
                      <!-- Warnings -->
                      <div x-show="settingsImportValidation && settingsImportValidation.warnings && settingsImportValidation.warnings.length > 0" class="mt-2">
                        <p class="text-sm font-medium text-yellow-700 dark:text-yellow-300">Warnings:</p>
                        <ul class="text-xs text-yellow-600 dark:text-yellow-400 ml-4 mt-1">
                          <template x-for="warning in settingsImportValidation.warnings" :key="warning">
                            <li class="list-disc" x-text="warning"></li>
                          </template>
                        </ul>
                      </div>
                    </div>

                    <!-- Settings Preview -->
                    <div x-show="settingsImportPreview" class="mb-3">
                      <p class="text-sm font-medium text-blue-900 dark:text-blue-100 mb-2">Settings to import:</p>
                      <div class="text-xs text-blue-800 dark:text-blue-200 space-y-1">
                        <div x-show="settingsImportPreview && settingsImportPreview.timeRounding !== undefined">
                          <strong>Time Rounding:</strong> 
                          <span x-text="settingsImportPreview.timeRounding === null ? 'No rounding' : (settingsImportPreview.timeRounding + 's')"></span>
                        </div>
                        <div x-show="settingsImportPreview && settingsImportPreview.durationThreshold !== undefined">
                          <strong>Duration Threshold:</strong> 
                          <span x-text="settingsImportPreview.durationThreshold + 's'"></span>
                        </div>
                        <div x-show="settingsImportPreview && settingsImportPreview.categories && settingsImportPreview.categories.length > 0">
                          <strong>Categories:</strong> 
                          <span x-text="settingsImportPreview.categories.length + ' categories'"></span>
                          <div class="ml-4 mt-1">
                            <template x-for="category in settingsImportPreview.categories" :key="category.id">
                              <div class="flex items-center gap-1">
                                <span x-text="category.icon"></span>
                                <span x-text="category.label"></span>
                                <span x-show="category.subcategories && category.subcategories.length > 0" 
                                      class="text-xs opacity-75"
                                      x-text="'(' + category.subcategories.length + ' subcategories)'"></span>
                              </div>
                            </template>
                          </div>
                        </div>
                        <div x-show="settingsImportPreview && settingsImportPreview.defaultExportPath">
                          <strong>Default Export Path:</strong> 
                          <span x-text="settingsImportPreview.defaultExportPath"></span>
                        </div>
                      </div>
                    </div>

                    <!-- Import Actions -->
                    <div class="flex gap-2 pt-2 border-t border-blue-200 dark:border-blue-800">
                      <button
                        @click="importSettings('replace')"
                        :disabled="settingsImportValidation && !settingsImportValidation.isValid"
                        class="btn-primary text-sm disabled:opacity-50 disabled:cursor-not-allowed"
                      >
                        Import & Replace
                      </button>
                      <button
                        @click="cancelImport()"
                        class="btn-secondary text-sm"
                      >
                        Cancel
                      </button>
                    </div>
                    
                    <p class="text-xs text-blue-700 dark:text-blue-300 mt-2">
                      <strong>Replace:</strong> All current settings will be replaced with imported settings
                    </p>
                  </div>
                </div>

                <!-- Import Helper Text -->
                <div x-show="!showImportPreview" class="text-xs text-gray-500 dark:text-gray-400">
                  <p class="mb-2"><strong>Import Process:</strong></p>
                  <ol class="list-decimal list-inside space-y-1 ml-2">
                    <li>Select a settings file exported from this application</li>
                    <li>Preview the settings to ensure they're correct</li>
                    <li>Choose to replace your current settings</li>
                    <li>The application will automatically reload with imported settings</li>
                  </ol>
                  <p class="mt-3 text-yellow-600 dark:text-yellow-400">
                    <strong>⚠️ Warning:</strong> Importing will replace your current settings. Consider exporting your current settings first as a backup.
                  </p>
                </div>
              </div>

              <!-- Settings Backups -->
              <div class="card">
                <div class="flex items-center justify-between mb-4">
                  <h3 class="text-lg font-medium text-gray-900 dark:text-white">
                    Settings Backups
                  </h3>
                  <button
                    @click="showBackups = !showBackups"
                    class="text-sm text-blue-600 dark:text-blue-400 hover:underline"
                  >
                    <span x-show="!showBackups">Show Backups</span>
                    <span x-show="showBackups">Hide Backups</span>
                  </button>
                </div>
                
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                  Automatic backups are created before imports. You can also create manual backups and restore previous settings.
                </p>

                <!-- Backup Summary -->
                <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-3 mb-4">
                  <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
                    <span>🔒</span>
                    <span x-text="settingsBackups.length === 0 ? 'No backups available' : 
                                  settingsBackups.length === 1 ? '1 backup available' : 
                                  settingsBackups.length + ' backups available (max 3)'">
                    </span>
                  </div>
                </div>

                <!-- Create Manual Backup Button -->
                <button
                  @click="createManualBackup()"
                  class="w-full btn-secondary flex items-center justify-center gap-2 mb-4"
                >
                  <span>💾</span>
                  <span>Create Manual Backup</span>
                </button>

                <!-- Backups List -->
                <div x-show="showBackups" x-transition class="space-y-3">
                  <!-- No backups message -->
                  <div x-show="settingsBackups.length === 0" class="text-center py-6 text-gray-500 dark:text-gray-400">
                    <div class="text-2xl mb-2">📦</div>
                    <p class="text-sm">No backups available yet</p>
                    <p class="text-xs">Backups will be created automatically when you import settings</p>
                  </div>

                  <!-- Backups list -->
                  <template x-for="backup in settingsBackups" :key="backup.id">
                    <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700">
                      <div class="flex items-start justify-between mb-2">
                        <div class="flex-1">
                          <div class="flex items-center gap-2 mb-1">
                            <span x-text="getBackupSourceIcon(backup.source)"></span>
                            <h4 class="font-medium text-gray-900 dark:text-white text-sm" 
                                x-text="formatBackupDescription(backup)">
                            </h4>
                          </div>
                          <div class="text-xs text-gray-500 dark:text-gray-400">
                            <span x-text="backup.settings.categories ? backup.settings.categories.length : 0"></span> categories •
                            <span x-text="backup.settings.durationThreshold || 'N/A'"></span>s threshold •
                            <span x-text="backup.settings.timeRounding === null ? 'No rounding' : 
                                         backup.settings.timeRounding === undefined ? 'Default' :
                                         backup.settings.timeRounding + 's rounding'"></span>
                          </div>
                        </div>
                        <div class="flex gap-1 ml-2">
                          <button
                            @click="restoreFromBackup(backup.id)"
                            class="text-xs px-2 py-1 bg-blue-100 hover:bg-blue-200 dark:bg-blue-900 dark:hover:bg-blue-800 text-blue-700 dark:text-blue-300 rounded transition-colors"
                            title="Restore this backup"
                          >
                            Restore
                          </button>
                          <button
                            @click="deleteBackup(backup.id)"
                            class="text-xs px-2 py-1 bg-red-100 hover:bg-red-200 dark:bg-red-900 dark:hover:bg-red-800 text-red-700 dark:text-red-300 rounded transition-colors"
                            title="Delete this backup"
                          >
                            Delete
                          </button>
                        </div>
                      </div>
                      
                      <!-- Backup categories preview -->
                      <div x-show="backup.settings.categories && backup.settings.categories.length > 0" class="mt-2">
                        <div class="flex gap-1 flex-wrap">
                          <template x-for="category in backup.settings.categories.slice(0, 6)" :key="category.id">
                            <span class="text-xs bg-white dark:bg-gray-700 px-2 py-1 rounded border border-gray-200 dark:border-gray-600 flex items-center gap-1">
                              <span x-text="category.icon"></span>
                              <span x-text="category.label"></span>
                            </span>
                          </template>
                          <span x-show="backup.settings.categories.length > 6" 
                                class="text-xs text-gray-500 dark:text-gray-400 px-2 py-1"
                                x-text="'+ ' + (backup.settings.categories.length - 6) + ' more'">
                          </span>
                        </div>
                      </div>
                    </div>
                  </template>

                  <!-- Clear all backups button -->
                  <div x-show="settingsBackups.length > 0" class="pt-2 border-t border-gray-200 dark:border-gray-700">
                    <button
                      @click="clearAllBackups()"
                      class="text-xs text-red-600 dark:text-red-400 hover:underline"
                    >
                      Clear All Backups
                    </button>
                  </div>
                </div>

                <!-- Helper text -->
                <div x-show="!showBackups" class="text-xs text-gray-500 dark:text-gray-400 mt-3">
                  <p><strong>Automatic Backups:</strong> Created before each settings import (max 3 kept)</p>
                  <p><strong>Manual Backups:</strong> Create snapshots of current settings anytime</p>
                  <p><strong>Restore:</strong> Revert to any backup - current settings will be backed up first</p>
                </div>
              </div>

              <!-- Auto-save indicator and controls -->
              <div class="card bg-gray-50 dark:bg-gray-800 border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-3">
                    <!-- Save status indicator -->
                    <div class="relative">
                      <div 
                        class="w-3 h-3 rounded-full transition-all duration-300"
                        :class="justSaved ? 'bg-green-500 scale-110' : 'bg-gray-300 dark:bg-gray-600'"
                      ></div>
                      <div 
                        x-show="justSaved"
                        x-transition:enter="transition ease-out duration-200"
                        x-transition:enter-start="opacity-0 scale-75"
                        x-transition:enter-end="opacity-100 scale-100"
                        x-transition:leave="transition ease-in duration-300"
                        x-transition:leave-start="opacity-100 scale-100"
                        x-transition:leave-end="opacity-0 scale-75"
                        class="absolute inset-0 w-3 h-3 bg-green-500 rounded-full animate-ping"
                      ></div>
                    </div>
                    
                    <span class="text-sm text-gray-600 dark:text-gray-400">
                      <span x-show="justSaved" class="text-green-600 dark:text-green-400">Settings saved</span>
                      <span x-show="!justSaved">Auto-save enabled</span>
                    </span>
                  </div>
                  
                  <div class="flex items-center gap-3">
                    <button
                      @click="cancelChanges()"
                      x-show="hasChanges()"
                      class="btn-secondary text-sm px-3 py-1 hover:bg-red-50 hover:border-red-200 hover:text-red-600 dark:hover:bg-red-900/20 dark:hover:border-red-700 dark:hover:text-red-400 transition-colors"
                    >
                      Cancel Changes
                    </button>
                    
                    <span
                      @click="$nextTick(() => { if (confirm('Reset all settings to default? This cannot be undone.')) resetToDefaults() })"
                      class="text-xs text-gray-400 dark:text-gray-500 hover:text-red-500 dark:hover:text-red-400 cursor-pointer px-2 py-1 rounded transition-colors"
                    >
                      Reset All
                    </span>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>

      <!-- Bottom Navigation -->
      <nav
        class="fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 z-40"
      >
        <div class="max-w-lg mx-auto px-4">
          <div class="flex justify-around">
            <button
              @click="navigateTo('timer')"
              class="nav-item"
              :class="{ 'nav-item-active': currentPage === 'timer' }"
            >
              <div class="text-xl mb-1">⏱️</div>
              <div class="text-xs">Timer</div>
            </button>
            <button
              @click="navigateTo('timeline')"
              class="nav-item"
              :class="{ 'nav-item-active': currentPage === 'timeline' }"
            >
              <div class="text-xl mb-1">📊</div>
              <div class="text-xs">Timeline</div>
            </button>
            <button
              @click="navigateTo('insights')"
              class="nav-item"
              :class="{ 'nav-item-active': currentPage === 'insights' }"
            >
              <div class="text-xl mb-1">💡</div>
              <div class="text-xs">Insights</div>
            </button>
            <button
              @click="navigateTo('settings')"
              class="nav-item"
              :class="{ 'nav-item-active': currentPage === 'settings' }"
            >
              <div class="text-xl mb-1">⚙️</div>
              <div class="text-xs">Settings</div>
            </button>
          </div>
        </div>
      </nav>
    </div>

    <!-- App entry -->
  </body>
</html>
