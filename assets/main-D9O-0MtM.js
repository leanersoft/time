const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/settings-import-DppVEF-q.js","assets/settings-backup-D_tuVzAd.js"])))=>i.map(i=>d[i]);
var Ys=Object.defineProperty;var Gs=(t,e,i)=>e in t?Ys(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var Yt=(t,e,i)=>Gs(t,typeof e!="symbol"?e+"":e,i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function i(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerPolicy&&(c.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?c.credentials="include":s.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(s){if(s.ep)return;s.ep=!0;const c=i(s);fetch(s.href,c)}})();var ii=!1,oi=!1,me=[],ai=-1;function Qs(t){Xs(t)}function Xs(t){me.includes(t)||me.push(t),tu()}function Zs(t){let e=me.indexOf(t);e!==-1&&e>ai&&me.splice(e,1)}function tu(){!oi&&!ii&&(ii=!0,queueMicrotask(eu))}function eu(){ii=!1,oi=!0;for(let t=0;t<me.length;t++)me[t](),ai=t;me.length=0,ai=-1,oi=!1}var Re,_e,Fe,Xo,si=!0;function nu(t){si=!1,t(),si=!0}function ru(t){Re=t.reactive,Fe=t.release,_e=e=>t.effect(e,{scheduler:i=>{si?Qs(i):i()}}),Xo=t.raw}function ko(t){_e=t}function iu(t){let e=()=>{};return[o=>{let s=_e(o);return t._x_effects||(t._x_effects=new Set,t._x_runEffects=()=>{t._x_effects.forEach(c=>c())}),t._x_effects.add(s),e=()=>{s!==void 0&&(t._x_effects.delete(s),Fe(s))},s},()=>{e()}]}function Zo(t,e){let i=!0,o,s=_e(()=>{let c=t();JSON.stringify(c),i?o=c:queueMicrotask(()=>{e(c,o),o=c}),i=!1});return()=>Fe(s)}var ta=[],ea=[],na=[];function ou(t){na.push(t)}function Si(t,e){typeof e=="function"?(t._x_cleanups||(t._x_cleanups=[]),t._x_cleanups.push(e)):(e=t,ea.push(e))}function ra(t){ta.push(t)}function ia(t,e,i){t._x_attributeCleanups||(t._x_attributeCleanups={}),t._x_attributeCleanups[e]||(t._x_attributeCleanups[e]=[]),t._x_attributeCleanups[e].push(i)}function oa(t,e){t._x_attributeCleanups&&Object.entries(t._x_attributeCleanups).forEach(([i,o])=>{(e===void 0||e.includes(i))&&(o.forEach(s=>s()),delete t._x_attributeCleanups[i])})}function au(t){for(t._x_effects?.forEach(Zs);t._x_cleanups?.length;)t._x_cleanups.pop()()}var xi=new MutationObserver(Ai),Ti=!1;function Ei(){xi.observe(document,{subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0}),Ti=!0}function aa(){su(),xi.disconnect(),Ti=!1}var en=[];function su(){let t=xi.takeRecords();en.push(()=>t.length>0&&Ai(t));let e=en.length;queueMicrotask(()=>{if(en.length===e)for(;en.length>0;)en.shift()()})}function st(t){if(!Ti)return t();aa();let e=t();return Ei(),e}var ki=!1,Xn=[];function uu(){ki=!0}function cu(){ki=!1,Ai(Xn),Xn=[]}function Ai(t){if(ki){Xn=Xn.concat(t);return}let e=[],i=new Set,o=new Map,s=new Map;for(let c=0;c<t.length;c++)if(!t[c].target._x_ignoreMutationObserver&&(t[c].type==="childList"&&(t[c].removedNodes.forEach(d=>{d.nodeType===1&&d._x_marker&&i.add(d)}),t[c].addedNodes.forEach(d=>{if(d.nodeType===1){if(i.has(d)){i.delete(d);return}d._x_marker||e.push(d)}})),t[c].type==="attributes")){let d=t[c].target,h=t[c].attributeName,m=t[c].oldValue,S=()=>{o.has(d)||o.set(d,[]),o.get(d).push({name:h,value:d.getAttribute(h)})},O=()=>{s.has(d)||s.set(d,[]),s.get(d).push(h)};d.hasAttribute(h)&&m===null?S():d.hasAttribute(h)?(O(),S()):O()}s.forEach((c,d)=>{oa(d,c)}),o.forEach((c,d)=>{ta.forEach(h=>h(d,c))});for(let c of i)e.some(d=>d.contains(c))||ea.forEach(d=>d(c));for(let c of e)c.isConnected&&na.forEach(d=>d(c));e=null,i=null,o=null,s=null}function sa(t){return fn($e(t))}function dn(t,e,i){return t._x_dataStack=[e,...$e(i||t)],()=>{t._x_dataStack=t._x_dataStack.filter(o=>o!==e)}}function $e(t){return t._x_dataStack?t._x_dataStack:typeof ShadowRoot=="function"&&t instanceof ShadowRoot?$e(t.host):t.parentNode?$e(t.parentNode):[]}function fn(t){return new Proxy({objects:t},lu)}var lu={ownKeys({objects:t}){return Array.from(new Set(t.flatMap(e=>Object.keys(e))))},has({objects:t},e){return e==Symbol.unscopables?!1:t.some(i=>Object.prototype.hasOwnProperty.call(i,e)||Reflect.has(i,e))},get({objects:t},e,i){return e=="toJSON"?du:Reflect.get(t.find(o=>Reflect.has(o,e))||{},e,i)},set({objects:t},e,i,o){const s=t.find(d=>Object.prototype.hasOwnProperty.call(d,e))||t[t.length-1],c=Object.getOwnPropertyDescriptor(s,e);return c?.set&&c?.get?c.set.call(o,i)||!0:Reflect.set(s,e,i)}};function du(){return Reflect.ownKeys(this).reduce((e,i)=>(e[i]=Reflect.get(this,i),e),{})}function ua(t){let e=o=>typeof o=="object"&&!Array.isArray(o)&&o!==null,i=(o,s="")=>{Object.entries(Object.getOwnPropertyDescriptors(o)).forEach(([c,{value:d,enumerable:h}])=>{if(h===!1||d===void 0||typeof d=="object"&&d!==null&&d.__v_skip)return;let m=s===""?c:`${s}.${c}`;typeof d=="object"&&d!==null&&d._x_interceptor?o[c]=d.initialize(t,m,c):e(d)&&d!==o&&!(d instanceof Element)&&i(d,m)})};return i(t)}function ca(t,e=()=>{}){let i={initialValue:void 0,_x_interceptor:!0,initialize(o,s,c){return t(this.initialValue,()=>fu(o,s),d=>ui(o,s,d),s,c)}};return e(i),o=>{if(typeof o=="object"&&o!==null&&o._x_interceptor){let s=i.initialize.bind(i);i.initialize=(c,d,h)=>{let m=o.initialize(c,d,h);return i.initialValue=m,s(c,d,h)}}else i.initialValue=o;return i}}function fu(t,e){return e.split(".").reduce((i,o)=>i[o],t)}function ui(t,e,i){if(typeof e=="string"&&(e=e.split(".")),e.length===1)t[e[0]]=i;else{if(e.length===0)throw error;return t[e[0]]||(t[e[0]]={}),ui(t[e[0]],e.slice(1),i)}}var la={};function Dt(t,e){la[t]=e}function ci(t,e){let i=hu(e);return Object.entries(la).forEach(([o,s])=>{Object.defineProperty(t,`$${o}`,{get(){return s(e,i)},enumerable:!1})}),t}function hu(t){let[e,i]=ma(t),o={interceptor:ca,...e};return Si(t,i),o}function pu(t,e,i,...o){try{return i(...o)}catch(s){ln(s,t,e)}}function ln(t,e,i=void 0){t=Object.assign(t??{message:"No error message given."},{el:e,expression:i}),console.warn(`Alpine Expression Error: ${t.message}

${i?'Expression: "'+i+`"

`:""}`,e),setTimeout(()=>{throw t},0)}var Yn=!0;function da(t){let e=Yn;Yn=!1;let i=t();return Yn=e,i}function ye(t,e,i={}){let o;return _t(t,e)(s=>o=s,i),o}function _t(...t){return fa(...t)}var fa=ha;function gu(t){fa=t}function ha(t,e){let i={};ci(i,t);let o=[i,...$e(t)],s=typeof e=="function"?mu(o,e):vu(o,e,t);return pu.bind(null,t,e,s)}function mu(t,e){return(i=()=>{},{scope:o={},params:s=[]}={})=>{let c=e.apply(fn([o,...t]),s);Zn(i,c)}}var Xr={};function yu(t,e){if(Xr[t])return Xr[t];let i=Object.getPrototypeOf(async function(){}).constructor,o=/^[\n\s]*if.*\(.*\)/.test(t.trim())||/^(let|const)\s/.test(t.trim())?`(async()=>{ ${t} })()`:t,c=(()=>{try{let d=new i(["__self","scope"],`with (scope) { __self.result = ${o} }; __self.finished = true; return __self.result;`);return Object.defineProperty(d,"name",{value:`[Alpine] ${t}`}),d}catch(d){return ln(d,e,t),Promise.resolve()}})();return Xr[t]=c,c}function vu(t,e,i){let o=yu(e,i);return(s=()=>{},{scope:c={},params:d=[]}={})=>{o.result=void 0,o.finished=!1;let h=fn([c,...t]);if(typeof o=="function"){let m=o(o,h).catch(S=>ln(S,i,e));o.finished?(Zn(s,o.result,h,d,i),o.result=void 0):m.then(S=>{Zn(s,S,h,d,i)}).catch(S=>ln(S,i,e)).finally(()=>o.result=void 0)}}}function Zn(t,e,i,o,s){if(Yn&&typeof e=="function"){let c=e.apply(i,o);c instanceof Promise?c.then(d=>Zn(t,d,i,o)).catch(d=>ln(d,s,e)):t(c)}else typeof e=="object"&&e instanceof Promise?e.then(c=>t(c)):t(e)}var Di="x-";function Le(t=""){return Di+t}function wu(t){Di=t}var tr={};function dt(t,e){return tr[t]=e,{before(i){if(!tr[i]){console.warn(String.raw`Cannot find directive \`${i}\`. \`${t}\` will use the default order of execution`);return}const o=pe.indexOf(i);pe.splice(o>=0?o:pe.indexOf("DEFAULT"),0,t)}}}function bu(t){return Object.keys(tr).includes(t)}function Oi(t,e,i){if(e=Array.from(e),t._x_virtualDirectives){let c=Object.entries(t._x_virtualDirectives).map(([h,m])=>({name:h,value:m})),d=pa(c);c=c.map(h=>d.find(m=>m.name===h.name)?{name:`x-bind:${h.name}`,value:`"${h.value}"`}:h),e=e.concat(c)}let o={};return e.map(wa((c,d)=>o[c]=d)).filter(_a).map(xu(o,i)).sort(Tu).map(c=>Su(t,c))}function pa(t){return Array.from(t).map(wa()).filter(e=>!_a(e))}var li=!1,sn=new Map,ga=Symbol();function _u(t){li=!0;let e=Symbol();ga=e,sn.set(e,[]);let i=()=>{for(;sn.get(e).length;)sn.get(e).shift()();sn.delete(e)},o=()=>{li=!1,i()};t(i),o()}function ma(t){let e=[],i=h=>e.push(h),[o,s]=iu(t);return e.push(s),[{Alpine:hn,effect:o,cleanup:i,evaluateLater:_t.bind(_t,t),evaluate:ye.bind(ye,t)},()=>e.forEach(h=>h())]}function Su(t,e){let i=()=>{},o=tr[e.type]||i,[s,c]=ma(t);ia(t,e.original,c);let d=()=>{t._x_ignore||t._x_ignoreSelf||(o.inline&&o.inline(t,e,s),o=o.bind(o,t,e,s),li?sn.get(ga).push(o):o())};return d.runCleanups=c,d}var ya=(t,e)=>({name:i,value:o})=>(i.startsWith(t)&&(i=i.replace(t,e)),{name:i,value:o}),va=t=>t;function wa(t=()=>{}){return({name:e,value:i})=>{let{name:o,value:s}=ba.reduce((c,d)=>d(c),{name:e,value:i});return o!==e&&t(o,e),{name:o,value:s}}}var ba=[];function Pi(t){ba.push(t)}function _a({name:t}){return Sa().test(t)}var Sa=()=>new RegExp(`^${Di}([^:^.]+)\\b`);function xu(t,e){return({name:i,value:o})=>{let s=i.match(Sa()),c=i.match(/:([a-zA-Z0-9\-_:]+)/),d=i.match(/\.[^.\]]+(?=[^\]]*$)/g)||[],h=e||t[i]||i;return{type:s?s[1]:null,value:c?c[1]:null,modifiers:d.map(m=>m.replace(".","")),expression:o,original:h}}}var di="DEFAULT",pe=["ignore","ref","data","id","anchor","bind","init","for","model","modelable","transition","show","if",di,"teleport"];function Tu(t,e){let i=pe.indexOf(t.type)===-1?di:t.type,o=pe.indexOf(e.type)===-1?di:e.type;return pe.indexOf(i)-pe.indexOf(o)}function un(t,e,i={}){t.dispatchEvent(new CustomEvent(e,{detail:i,bubbles:!0,composed:!0,cancelable:!0}))}function be(t,e){if(typeof ShadowRoot=="function"&&t instanceof ShadowRoot){Array.from(t.children).forEach(s=>be(s,e));return}let i=!1;if(e(t,()=>i=!0),i)return;let o=t.firstElementChild;for(;o;)be(o,e),o=o.nextElementSibling}function kt(t,...e){console.warn(`Alpine Warning: ${t}`,...e)}var Ao=!1;function Eu(){Ao&&kt("Alpine has already been initialized on this page. Calling Alpine.start() more than once can cause problems."),Ao=!0,document.body||kt("Unable to initialize. Trying to load Alpine before `<body>` is available. Did you forget to add `defer` in Alpine's `<script>` tag?"),un(document,"alpine:init"),un(document,"alpine:initializing"),Ei(),ou(e=>Kt(e,be)),Si(e=>Ne(e)),ra((e,i)=>{Oi(e,i).forEach(o=>o())});let t=e=>!rr(e.parentElement,!0);Array.from(document.querySelectorAll(Ea().join(","))).filter(t).forEach(e=>{Kt(e)}),un(document,"alpine:initialized"),setTimeout(()=>{Ou()})}var Ci=[],xa=[];function Ta(){return Ci.map(t=>t())}function Ea(){return Ci.concat(xa).map(t=>t())}function ka(t){Ci.push(t)}function Aa(t){xa.push(t)}function rr(t,e=!1){return je(t,i=>{if((e?Ea():Ta()).some(s=>i.matches(s)))return!0})}function je(t,e){if(t){if(e(t))return t;if(t._x_teleportBack&&(t=t._x_teleportBack),!!t.parentElement)return je(t.parentElement,e)}}function ku(t){return Ta().some(e=>t.matches(e))}var Da=[];function Au(t){Da.push(t)}var Du=1;function Kt(t,e=be,i=()=>{}){je(t,o=>o._x_ignore)||_u(()=>{e(t,(o,s)=>{o._x_marker||(i(o,s),Da.forEach(c=>c(o,s)),Oi(o,o.attributes).forEach(c=>c()),o._x_ignore||(o._x_marker=Du++),o._x_ignore&&s())})})}function Ne(t,e=be){e(t,i=>{au(i),oa(i),delete i._x_marker})}function Ou(){[["ui","dialog",["[x-dialog], [x-popover]"]],["anchor","anchor",["[x-anchor]"]],["sort","sort",["[x-sort]"]]].forEach(([e,i,o])=>{bu(i)||o.some(s=>{if(document.querySelector(s))return kt(`found "${s}", but missing ${e} plugin`),!0})})}var fi=[],Ii=!1;function $i(t=()=>{}){return queueMicrotask(()=>{Ii||setTimeout(()=>{hi()})}),new Promise(e=>{fi.push(()=>{t(),e()})})}function hi(){for(Ii=!1;fi.length;)fi.shift()()}function Pu(){Ii=!0}function Mi(t,e){return Array.isArray(e)?Do(t,e.join(" ")):typeof e=="object"&&e!==null?Cu(t,e):typeof e=="function"?Mi(t,e()):Do(t,e)}function Do(t,e){let i=s=>s.split(" ").filter(c=>!t.classList.contains(c)).filter(Boolean),o=s=>(t.classList.add(...s),()=>{t.classList.remove(...s)});return e=e===!0?e="":e||"",o(i(e))}function Cu(t,e){let i=h=>h.split(" ").filter(Boolean),o=Object.entries(e).flatMap(([h,m])=>m?i(h):!1).filter(Boolean),s=Object.entries(e).flatMap(([h,m])=>m?!1:i(h)).filter(Boolean),c=[],d=[];return s.forEach(h=>{t.classList.contains(h)&&(t.classList.remove(h),d.push(h))}),o.forEach(h=>{t.classList.contains(h)||(t.classList.add(h),c.push(h))}),()=>{d.forEach(h=>t.classList.add(h)),c.forEach(h=>t.classList.remove(h))}}function ir(t,e){return typeof e=="object"&&e!==null?Iu(t,e):$u(t,e)}function Iu(t,e){let i={};return Object.entries(e).forEach(([o,s])=>{i[o]=t.style[o],o.startsWith("--")||(o=Mu(o)),t.style.setProperty(o,s)}),setTimeout(()=>{t.style.length===0&&t.removeAttribute("style")}),()=>{ir(t,i)}}function $u(t,e){let i=t.getAttribute("style",e);return t.setAttribute("style",e),()=>{t.setAttribute("style",i||"")}}function Mu(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function pi(t,e=()=>{}){let i=!1;return function(){i?e.apply(this,arguments):(i=!0,t.apply(this,arguments))}}dt("transition",(t,{value:e,modifiers:i,expression:o},{evaluate:s})=>{typeof o=="function"&&(o=s(o)),o!==!1&&(!o||typeof o=="boolean"?Fu(t,i,e):Ru(t,o,e))});function Ru(t,e,i){Oa(t,Mi,""),{enter:s=>{t._x_transition.enter.during=s},"enter-start":s=>{t._x_transition.enter.start=s},"enter-end":s=>{t._x_transition.enter.end=s},leave:s=>{t._x_transition.leave.during=s},"leave-start":s=>{t._x_transition.leave.start=s},"leave-end":s=>{t._x_transition.leave.end=s}}[i](e)}function Fu(t,e,i){Oa(t,ir);let o=!e.includes("in")&&!e.includes("out")&&!i,s=o||e.includes("in")||["enter"].includes(i),c=o||e.includes("out")||["leave"].includes(i);e.includes("in")&&!o&&(e=e.filter((Y,Z)=>Z<e.indexOf("out"))),e.includes("out")&&!o&&(e=e.filter((Y,Z)=>Z>e.indexOf("out")));let d=!e.includes("opacity")&&!e.includes("scale"),h=d||e.includes("opacity"),m=d||e.includes("scale"),S=h?0:1,O=m?nn(e,"scale",95)/100:1,C=nn(e,"delay",0)/1e3,$=nn(e,"origin","center"),K="opacity, transform",V=nn(e,"duration",150)/1e3,et=nn(e,"duration",75)/1e3,H="cubic-bezier(0.4, 0.0, 0.2, 1)";s&&(t._x_transition.enter.during={transformOrigin:$,transitionDelay:`${C}s`,transitionProperty:K,transitionDuration:`${V}s`,transitionTimingFunction:H},t._x_transition.enter.start={opacity:S,transform:`scale(${O})`},t._x_transition.enter.end={opacity:1,transform:"scale(1)"}),c&&(t._x_transition.leave.during={transformOrigin:$,transitionDelay:`${C}s`,transitionProperty:K,transitionDuration:`${et}s`,transitionTimingFunction:H},t._x_transition.leave.start={opacity:1,transform:"scale(1)"},t._x_transition.leave.end={opacity:S,transform:`scale(${O})`})}function Oa(t,e,i={}){t._x_transition||(t._x_transition={enter:{during:i,start:i,end:i},leave:{during:i,start:i,end:i},in(o=()=>{},s=()=>{}){gi(t,e,{during:this.enter.during,start:this.enter.start,end:this.enter.end},o,s)},out(o=()=>{},s=()=>{}){gi(t,e,{during:this.leave.during,start:this.leave.start,end:this.leave.end},o,s)}})}window.Element.prototype._x_toggleAndCascadeWithTransitions=function(t,e,i,o){const s=document.visibilityState==="visible"?requestAnimationFrame:setTimeout;let c=()=>s(i);if(e){t._x_transition&&(t._x_transition.enter||t._x_transition.leave)?t._x_transition.enter&&(Object.entries(t._x_transition.enter.during).length||Object.entries(t._x_transition.enter.start).length||Object.entries(t._x_transition.enter.end).length)?t._x_transition.in(i):c():t._x_transition?t._x_transition.in(i):c();return}t._x_hidePromise=t._x_transition?new Promise((d,h)=>{t._x_transition.out(()=>{},()=>d(o)),t._x_transitioning&&t._x_transitioning.beforeCancel(()=>h({isFromCancelledTransition:!0}))}):Promise.resolve(o),queueMicrotask(()=>{let d=Pa(t);d?(d._x_hideChildren||(d._x_hideChildren=[]),d._x_hideChildren.push(t)):s(()=>{let h=m=>{let S=Promise.all([m._x_hidePromise,...(m._x_hideChildren||[]).map(h)]).then(([O])=>O?.());return delete m._x_hidePromise,delete m._x_hideChildren,S};h(t).catch(m=>{if(!m.isFromCancelledTransition)throw m})})})};function Pa(t){let e=t.parentNode;if(e)return e._x_hidePromise?e:Pa(e)}function gi(t,e,{during:i,start:o,end:s}={},c=()=>{},d=()=>{}){if(t._x_transitioning&&t._x_transitioning.cancel(),Object.keys(i).length===0&&Object.keys(o).length===0&&Object.keys(s).length===0){c(),d();return}let h,m,S;Lu(t,{start(){h=e(t,o)},during(){m=e(t,i)},before:c,end(){h(),S=e(t,s)},after:d,cleanup(){m(),S()}})}function Lu(t,e){let i,o,s,c=pi(()=>{st(()=>{i=!0,o||e.before(),s||(e.end(),hi()),e.after(),t.isConnected&&e.cleanup(),delete t._x_transitioning})});t._x_transitioning={beforeCancels:[],beforeCancel(d){this.beforeCancels.push(d)},cancel:pi(function(){for(;this.beforeCancels.length;)this.beforeCancels.shift()();c()}),finish:c},st(()=>{e.start(),e.during()}),Pu(),requestAnimationFrame(()=>{if(i)return;let d=Number(getComputedStyle(t).transitionDuration.replace(/,.*/,"").replace("s",""))*1e3,h=Number(getComputedStyle(t).transitionDelay.replace(/,.*/,"").replace("s",""))*1e3;d===0&&(d=Number(getComputedStyle(t).animationDuration.replace("s",""))*1e3),st(()=>{e.before()}),o=!0,requestAnimationFrame(()=>{i||(st(()=>{e.end()}),hi(),setTimeout(t._x_transitioning.finish,d+h),s=!0)})})}function nn(t,e,i){if(t.indexOf(e)===-1)return i;const o=t[t.indexOf(e)+1];if(!o||e==="scale"&&isNaN(o))return i;if(e==="duration"||e==="delay"){let s=o.match(/([0-9]+)ms/);if(s)return s[1]}return e==="origin"&&["top","right","left","center","bottom"].includes(t[t.indexOf(e)+2])?[o,t[t.indexOf(e)+2]].join(" "):o}var Qt=!1;function Zt(t,e=()=>{}){return(...i)=>Qt?e(...i):t(...i)}function ju(t){return(...e)=>Qt&&t(...e)}var Ca=[];function or(t){Ca.push(t)}function Nu(t,e){Ca.forEach(i=>i(t,e)),Qt=!0,Ia(()=>{Kt(e,(i,o)=>{o(i,()=>{})})}),Qt=!1}var mi=!1;function Bu(t,e){e._x_dataStack||(e._x_dataStack=t._x_dataStack),Qt=!0,mi=!0,Ia(()=>{Ku(e)}),Qt=!1,mi=!1}function Ku(t){let e=!1;Kt(t,(o,s)=>{be(o,(c,d)=>{if(e&&ku(c))return d();e=!0,s(c,d)})})}function Ia(t){let e=_e;ko((i,o)=>{let s=e(i);return Fe(s),()=>{}}),t(),ko(e)}function $a(t,e,i,o=[]){switch(t._x_bindings||(t._x_bindings=Re({})),t._x_bindings[e]=i,e=o.includes("camel")?Yu(e):e,e){case"value":qu(t,i);break;case"style":Uu(t,i);break;case"class":Hu(t,i);break;case"selected":case"checked":Wu(t,e,i);break;default:Ma(t,e,i);break}}function qu(t,e){if(La(t))t.attributes.value===void 0&&(t.value=e),window.fromModel&&(typeof e=="boolean"?t.checked=Gn(t.value)===e:t.checked=Oo(t.value,e));else if(Ri(t))Number.isInteger(e)?t.value=e:!Array.isArray(e)&&typeof e!="boolean"&&![null,void 0].includes(e)?t.value=String(e):Array.isArray(e)?t.checked=e.some(i=>Oo(i,t.value)):t.checked=!!e;else if(t.tagName==="SELECT")Ju(t,e);else{if(t.value===e)return;t.value=e===void 0?"":e}}function Hu(t,e){t._x_undoAddedClasses&&t._x_undoAddedClasses(),t._x_undoAddedClasses=Mi(t,e)}function Uu(t,e){t._x_undoAddedStyles&&t._x_undoAddedStyles(),t._x_undoAddedStyles=ir(t,e)}function Wu(t,e,i){Ma(t,e,i),zu(t,e,i)}function Ma(t,e,i){[null,void 0,!1].includes(i)&&Qu(e)?t.removeAttribute(e):(Ra(e)&&(i=e),Vu(t,e,i))}function Vu(t,e,i){t.getAttribute(e)!=i&&t.setAttribute(e,i)}function zu(t,e,i){t[e]!==i&&(t[e]=i)}function Ju(t,e){const i=[].concat(e).map(o=>o+"");Array.from(t.options).forEach(o=>{o.selected=i.includes(o.value)})}function Yu(t){return t.toLowerCase().replace(/-(\w)/g,(e,i)=>i.toUpperCase())}function Oo(t,e){return t==e}function Gn(t){return[1,"1","true","on","yes",!0].includes(t)?!0:[0,"0","false","off","no",!1].includes(t)?!1:t?!!t:null}var Gu=new Set(["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected","shadowrootclonable","shadowrootdelegatesfocus","shadowrootserializable"]);function Ra(t){return Gu.has(t)}function Qu(t){return!["aria-pressed","aria-checked","aria-expanded","aria-selected"].includes(t)}function Xu(t,e,i){return t._x_bindings&&t._x_bindings[e]!==void 0?t._x_bindings[e]:Fa(t,e,i)}function Zu(t,e,i,o=!0){if(t._x_bindings&&t._x_bindings[e]!==void 0)return t._x_bindings[e];if(t._x_inlineBindings&&t._x_inlineBindings[e]!==void 0){let s=t._x_inlineBindings[e];return s.extract=o,da(()=>ye(t,s.expression))}return Fa(t,e,i)}function Fa(t,e,i){let o=t.getAttribute(e);return o===null?typeof i=="function"?i():i:o===""?!0:Ra(e)?!![e,"true"].includes(o):o}function Ri(t){return t.type==="checkbox"||t.localName==="ui-checkbox"||t.localName==="ui-switch"}function La(t){return t.type==="radio"||t.localName==="ui-radio"}function ja(t,e){var i;return function(){var o=this,s=arguments,c=function(){i=null,t.apply(o,s)};clearTimeout(i),i=setTimeout(c,e)}}function Na(t,e){let i;return function(){let o=this,s=arguments;i||(t.apply(o,s),i=!0,setTimeout(()=>i=!1,e))}}function Ba({get:t,set:e},{get:i,set:o}){let s=!0,c,d=_e(()=>{let h=t(),m=i();if(s)o(Zr(h)),s=!1;else{let S=JSON.stringify(h),O=JSON.stringify(m);S!==c?o(Zr(h)):S!==O&&e(Zr(m))}c=JSON.stringify(t()),JSON.stringify(i())});return()=>{Fe(d)}}function Zr(t){return typeof t=="object"?JSON.parse(JSON.stringify(t)):t}function tc(t){(Array.isArray(t)?t:[t]).forEach(i=>i(hn))}var he={},Po=!1;function ec(t,e){if(Po||(he=Re(he),Po=!0),e===void 0)return he[t];he[t]=e,ua(he[t]),typeof e=="object"&&e!==null&&e.hasOwnProperty("init")&&typeof e.init=="function"&&he[t].init()}function nc(){return he}var Ka={};function rc(t,e){let i=typeof e!="function"?()=>e:e;return t instanceof Element?qa(t,i()):(Ka[t]=i,()=>{})}function ic(t){return Object.entries(Ka).forEach(([e,i])=>{Object.defineProperty(t,e,{get(){return(...o)=>i(...o)}})}),t}function qa(t,e,i){let o=[];for(;o.length;)o.pop()();let s=Object.entries(e).map(([d,h])=>({name:d,value:h})),c=pa(s);return s=s.map(d=>c.find(h=>h.name===d.name)?{name:`x-bind:${d.name}`,value:`"${d.value}"`}:d),Oi(t,s,i).map(d=>{o.push(d.runCleanups),d()}),()=>{for(;o.length;)o.pop()()}}var Ha={};function oc(t,e){Ha[t]=e}function ac(t,e){return Object.entries(Ha).forEach(([i,o])=>{Object.defineProperty(t,i,{get(){return(...s)=>o.bind(e)(...s)},enumerable:!1})}),t}var sc={get reactive(){return Re},get release(){return Fe},get effect(){return _e},get raw(){return Xo},version:"3.14.9",flushAndStopDeferringMutations:cu,dontAutoEvaluateFunctions:da,disableEffectScheduling:nu,startObservingMutations:Ei,stopObservingMutations:aa,setReactivityEngine:ru,onAttributeRemoved:ia,onAttributesAdded:ra,closestDataStack:$e,skipDuringClone:Zt,onlyDuringClone:ju,addRootSelector:ka,addInitSelector:Aa,interceptClone:or,addScopeToNode:dn,deferMutations:uu,mapAttributes:Pi,evaluateLater:_t,interceptInit:Au,setEvaluator:gu,mergeProxies:fn,extractProp:Zu,findClosest:je,onElRemoved:Si,closestRoot:rr,destroyTree:Ne,interceptor:ca,transition:gi,setStyles:ir,mutateDom:st,directive:dt,entangle:Ba,throttle:Na,debounce:ja,evaluate:ye,initTree:Kt,nextTick:$i,prefixed:Le,prefix:wu,plugin:tc,magic:Dt,store:ec,start:Eu,clone:Bu,cloneNode:Nu,bound:Xu,$data:sa,watch:Zo,walk:be,data:oc,bind:rc},hn=sc;function uc(t,e){const i=Object.create(null),o=t.split(",");for(let s=0;s<o.length;s++)i[o[s]]=!0;return s=>!!i[s]}var cc=Object.freeze({}),lc=Object.prototype.hasOwnProperty,ar=(t,e)=>lc.call(t,e),ve=Array.isArray,cn=t=>Ua(t)==="[object Map]",dc=t=>typeof t=="string",Fi=t=>typeof t=="symbol",sr=t=>t!==null&&typeof t=="object",fc=Object.prototype.toString,Ua=t=>fc.call(t),Wa=t=>Ua(t).slice(8,-1),Li=t=>dc(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,hc=t=>{const e=Object.create(null);return i=>e[i]||(e[i]=t(i))},pc=hc(t=>t.charAt(0).toUpperCase()+t.slice(1)),Va=(t,e)=>t!==e&&(t===t||e===e),yi=new WeakMap,rn=[],$t,we=Symbol("iterate"),vi=Symbol("Map key iterate");function gc(t){return t&&t._isEffect===!0}function mc(t,e=cc){gc(t)&&(t=t.raw);const i=wc(t,e);return e.lazy||i(),i}function yc(t){t.active&&(za(t),t.options.onStop&&t.options.onStop(),t.active=!1)}var vc=0;function wc(t,e){const i=function(){if(!i.active)return t();if(!rn.includes(i)){za(i);try{return _c(),rn.push(i),$t=i,t()}finally{rn.pop(),Ja(),$t=rn[rn.length-1]}}};return i.id=vc++,i.allowRecurse=!!e.allowRecurse,i._isEffect=!0,i.active=!0,i.raw=t,i.deps=[],i.options=e,i}function za(t){const{deps:e}=t;if(e.length){for(let i=0;i<e.length;i++)e[i].delete(t);e.length=0}}var Me=!0,ji=[];function bc(){ji.push(Me),Me=!1}function _c(){ji.push(Me),Me=!0}function Ja(){const t=ji.pop();Me=t===void 0?!0:t}function At(t,e,i){if(!Me||$t===void 0)return;let o=yi.get(t);o||yi.set(t,o=new Map);let s=o.get(i);s||o.set(i,s=new Set),s.has($t)||(s.add($t),$t.deps.push(s),$t.options.onTrack&&$t.options.onTrack({effect:$t,target:t,type:e,key:i}))}function Xt(t,e,i,o,s,c){const d=yi.get(t);if(!d)return;const h=new Set,m=O=>{O&&O.forEach(C=>{(C!==$t||C.allowRecurse)&&h.add(C)})};if(e==="clear")d.forEach(m);else if(i==="length"&&ve(t))d.forEach((O,C)=>{(C==="length"||C>=o)&&m(O)});else switch(i!==void 0&&m(d.get(i)),e){case"add":ve(t)?Li(i)&&m(d.get("length")):(m(d.get(we)),cn(t)&&m(d.get(vi)));break;case"delete":ve(t)||(m(d.get(we)),cn(t)&&m(d.get(vi)));break;case"set":cn(t)&&m(d.get(we));break}const S=O=>{O.options.onTrigger&&O.options.onTrigger({effect:O,target:t,key:i,type:e,newValue:o,oldValue:s,oldTarget:c}),O.options.scheduler?O.options.scheduler(O):O()};h.forEach(S)}var Sc=uc("__proto__,__v_isRef,__isVue"),Ya=new Set(Object.getOwnPropertyNames(Symbol).map(t=>Symbol[t]).filter(Fi)),xc=Ga(),Tc=Ga(!0),Co=Ec();function Ec(){const t={};return["includes","indexOf","lastIndexOf"].forEach(e=>{t[e]=function(...i){const o=it(this);for(let c=0,d=this.length;c<d;c++)At(o,"get",c+"");const s=o[e](...i);return s===-1||s===!1?o[e](...i.map(it)):s}}),["push","pop","shift","unshift","splice"].forEach(e=>{t[e]=function(...i){bc();const o=it(this)[e].apply(this,i);return Ja(),o}}),t}function Ga(t=!1,e=!1){return function(o,s,c){if(s==="__v_isReactive")return!t;if(s==="__v_isReadonly")return t;if(s==="__v_raw"&&c===(t?e?Nc:ts:e?jc:Za).get(o))return o;const d=ve(o);if(!t&&d&&ar(Co,s))return Reflect.get(Co,s,c);const h=Reflect.get(o,s,c);return(Fi(s)?Ya.has(s):Sc(s))||(t||At(o,"get",s),e)?h:wi(h)?!d||!Li(s)?h.value:h:sr(h)?t?es(h):qi(h):h}}var kc=Ac();function Ac(t=!1){return function(i,o,s,c){let d=i[o];if(!t&&(s=it(s),d=it(d),!ve(i)&&wi(d)&&!wi(s)))return d.value=s,!0;const h=ve(i)&&Li(o)?Number(o)<i.length:ar(i,o),m=Reflect.set(i,o,s,c);return i===it(c)&&(h?Va(s,d)&&Xt(i,"set",o,s,d):Xt(i,"add",o,s)),m}}function Dc(t,e){const i=ar(t,e),o=t[e],s=Reflect.deleteProperty(t,e);return s&&i&&Xt(t,"delete",e,void 0,o),s}function Oc(t,e){const i=Reflect.has(t,e);return(!Fi(e)||!Ya.has(e))&&At(t,"has",e),i}function Pc(t){return At(t,"iterate",ve(t)?"length":we),Reflect.ownKeys(t)}var Cc={get:xc,set:kc,deleteProperty:Dc,has:Oc,ownKeys:Pc},Ic={get:Tc,set(t,e){return console.warn(`Set operation on key "${String(e)}" failed: target is readonly.`,t),!0},deleteProperty(t,e){return console.warn(`Delete operation on key "${String(e)}" failed: target is readonly.`,t),!0}},Ni=t=>sr(t)?qi(t):t,Bi=t=>sr(t)?es(t):t,Ki=t=>t,ur=t=>Reflect.getPrototypeOf(t);function Un(t,e,i=!1,o=!1){t=t.__v_raw;const s=it(t),c=it(e);e!==c&&!i&&At(s,"get",e),!i&&At(s,"get",c);const{has:d}=ur(s),h=o?Ki:i?Bi:Ni;if(d.call(s,e))return h(t.get(e));if(d.call(s,c))return h(t.get(c));t!==s&&t.get(e)}function Wn(t,e=!1){const i=this.__v_raw,o=it(i),s=it(t);return t!==s&&!e&&At(o,"has",t),!e&&At(o,"has",s),t===s?i.has(t):i.has(t)||i.has(s)}function Vn(t,e=!1){return t=t.__v_raw,!e&&At(it(t),"iterate",we),Reflect.get(t,"size",t)}function Io(t){t=it(t);const e=it(this);return ur(e).has.call(e,t)||(e.add(t),Xt(e,"add",t,t)),this}function $o(t,e){e=it(e);const i=it(this),{has:o,get:s}=ur(i);let c=o.call(i,t);c?Xa(i,o,t):(t=it(t),c=o.call(i,t));const d=s.call(i,t);return i.set(t,e),c?Va(e,d)&&Xt(i,"set",t,e,d):Xt(i,"add",t,e),this}function Mo(t){const e=it(this),{has:i,get:o}=ur(e);let s=i.call(e,t);s?Xa(e,i,t):(t=it(t),s=i.call(e,t));const c=o?o.call(e,t):void 0,d=e.delete(t);return s&&Xt(e,"delete",t,void 0,c),d}function Ro(){const t=it(this),e=t.size!==0,i=cn(t)?new Map(t):new Set(t),o=t.clear();return e&&Xt(t,"clear",void 0,void 0,i),o}function zn(t,e){return function(o,s){const c=this,d=c.__v_raw,h=it(d),m=e?Ki:t?Bi:Ni;return!t&&At(h,"iterate",we),d.forEach((S,O)=>o.call(s,m(S),m(O),c))}}function Jn(t,e,i){return function(...o){const s=this.__v_raw,c=it(s),d=cn(c),h=t==="entries"||t===Symbol.iterator&&d,m=t==="keys"&&d,S=s[t](...o),O=i?Ki:e?Bi:Ni;return!e&&At(c,"iterate",m?vi:we),{next(){const{value:C,done:$}=S.next();return $?{value:C,done:$}:{value:h?[O(C[0]),O(C[1])]:O(C),done:$}},[Symbol.iterator](){return this}}}}function Gt(t){return function(...e){{const i=e[0]?`on key "${e[0]}" `:"";console.warn(`${pc(t)} operation ${i}failed: target is readonly.`,it(this))}return t==="delete"?!1:this}}function $c(){const t={get(c){return Un(this,c)},get size(){return Vn(this)},has:Wn,add:Io,set:$o,delete:Mo,clear:Ro,forEach:zn(!1,!1)},e={get(c){return Un(this,c,!1,!0)},get size(){return Vn(this)},has:Wn,add:Io,set:$o,delete:Mo,clear:Ro,forEach:zn(!1,!0)},i={get(c){return Un(this,c,!0)},get size(){return Vn(this,!0)},has(c){return Wn.call(this,c,!0)},add:Gt("add"),set:Gt("set"),delete:Gt("delete"),clear:Gt("clear"),forEach:zn(!0,!1)},o={get(c){return Un(this,c,!0,!0)},get size(){return Vn(this,!0)},has(c){return Wn.call(this,c,!0)},add:Gt("add"),set:Gt("set"),delete:Gt("delete"),clear:Gt("clear"),forEach:zn(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(c=>{t[c]=Jn(c,!1,!1),i[c]=Jn(c,!0,!1),e[c]=Jn(c,!1,!0),o[c]=Jn(c,!0,!0)}),[t,i,e,o]}var[Mc,Rc,$l,Ml]=$c();function Qa(t,e){const i=t?Rc:Mc;return(o,s,c)=>s==="__v_isReactive"?!t:s==="__v_isReadonly"?t:s==="__v_raw"?o:Reflect.get(ar(i,s)&&s in o?i:o,s,c)}var Fc={get:Qa(!1)},Lc={get:Qa(!0)};function Xa(t,e,i){const o=it(i);if(o!==i&&e.call(t,o)){const s=Wa(t);console.warn(`Reactive ${s} contains both the raw and reactive versions of the same object${s==="Map"?" as keys":""}, which can lead to inconsistencies. Avoid differentiating between the raw and reactive versions of an object and only use the reactive version if possible.`)}}var Za=new WeakMap,jc=new WeakMap,ts=new WeakMap,Nc=new WeakMap;function Bc(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Kc(t){return t.__v_skip||!Object.isExtensible(t)?0:Bc(Wa(t))}function qi(t){return t&&t.__v_isReadonly?t:ns(t,!1,Cc,Fc,Za)}function es(t){return ns(t,!0,Ic,Lc,ts)}function ns(t,e,i,o,s){if(!sr(t))return console.warn(`value cannot be made reactive: ${String(t)}`),t;if(t.__v_raw&&!(e&&t.__v_isReactive))return t;const c=s.get(t);if(c)return c;const d=Kc(t);if(d===0)return t;const h=new Proxy(t,d===2?o:i);return s.set(t,h),h}function it(t){return t&&it(t.__v_raw)||t}function wi(t){return!!(t&&t.__v_isRef===!0)}Dt("nextTick",()=>$i);Dt("dispatch",t=>un.bind(un,t));Dt("watch",(t,{evaluateLater:e,cleanup:i})=>(o,s)=>{let c=e(o),h=Zo(()=>{let m;return c(S=>m=S),m},s);i(h)});Dt("store",nc);Dt("data",t=>sa(t));Dt("root",t=>rr(t));Dt("refs",t=>(t._x_refs_proxy||(t._x_refs_proxy=fn(qc(t))),t._x_refs_proxy));function qc(t){let e=[];return je(t,i=>{i._x_refs&&e.push(i._x_refs)}),e}var ti={};function rs(t){return ti[t]||(ti[t]=0),++ti[t]}function Hc(t,e){return je(t,i=>{if(i._x_ids&&i._x_ids[e])return!0})}function Uc(t,e){t._x_ids||(t._x_ids={}),t._x_ids[e]||(t._x_ids[e]=rs(e))}Dt("id",(t,{cleanup:e})=>(i,o=null)=>{let s=`${i}${o?`-${o}`:""}`;return Wc(t,s,e,()=>{let c=Hc(t,i),d=c?c._x_ids[i]:rs(i);return o?`${i}-${d}-${o}`:`${i}-${d}`})});or((t,e)=>{t._x_id&&(e._x_id=t._x_id)});function Wc(t,e,i,o){if(t._x_id||(t._x_id={}),t._x_id[e])return t._x_id[e];let s=o();return t._x_id[e]=s,i(()=>{delete t._x_id[e]}),s}Dt("el",t=>t);is("Focus","focus","focus");is("Persist","persist","persist");function is(t,e,i){Dt(e,o=>kt(`You can't use [$${e}] without first installing the "${t}" plugin here: https://alpinejs.dev/plugins/${i}`,o))}dt("modelable",(t,{expression:e},{effect:i,evaluateLater:o,cleanup:s})=>{let c=o(e),d=()=>{let O;return c(C=>O=C),O},h=o(`${e} = __placeholder`),m=O=>h(()=>{},{scope:{__placeholder:O}}),S=d();m(S),queueMicrotask(()=>{if(!t._x_model)return;t._x_removeModelListeners.default();let O=t._x_model.get,C=t._x_model.set,$=Ba({get(){return O()},set(K){C(K)}},{get(){return d()},set(K){m(K)}});s($)})});dt("teleport",(t,{modifiers:e,expression:i},{cleanup:o})=>{t.tagName.toLowerCase()!=="template"&&kt("x-teleport can only be used on a <template> tag",t);let s=Fo(i),c=t.content.cloneNode(!0).firstElementChild;t._x_teleport=c,c._x_teleportBack=t,t.setAttribute("data-teleport-template",!0),c.setAttribute("data-teleport-target",!0),t._x_forwardEvents&&t._x_forwardEvents.forEach(h=>{c.addEventListener(h,m=>{m.stopPropagation(),t.dispatchEvent(new m.constructor(m.type,m))})}),dn(c,{},t);let d=(h,m,S)=>{S.includes("prepend")?m.parentNode.insertBefore(h,m):S.includes("append")?m.parentNode.insertBefore(h,m.nextSibling):m.appendChild(h)};st(()=>{d(c,s,e),Zt(()=>{Kt(c)})()}),t._x_teleportPutBack=()=>{let h=Fo(i);st(()=>{d(t._x_teleport,h,e)})},o(()=>st(()=>{c.remove(),Ne(c)}))});var Vc=document.createElement("div");function Fo(t){let e=Zt(()=>document.querySelector(t),()=>Vc)();return e||kt(`Cannot find x-teleport element for selector: "${t}"`),e}var os=()=>{};os.inline=(t,{modifiers:e},{cleanup:i})=>{e.includes("self")?t._x_ignoreSelf=!0:t._x_ignore=!0,i(()=>{e.includes("self")?delete t._x_ignoreSelf:delete t._x_ignore})};dt("ignore",os);dt("effect",Zt((t,{expression:e},{effect:i})=>{i(_t(t,e))}));function bi(t,e,i,o){let s=t,c=m=>o(m),d={},h=(m,S)=>O=>S(m,O);if(i.includes("dot")&&(e=zc(e)),i.includes("camel")&&(e=Jc(e)),i.includes("passive")&&(d.passive=!0),i.includes("capture")&&(d.capture=!0),i.includes("window")&&(s=window),i.includes("document")&&(s=document),i.includes("debounce")){let m=i[i.indexOf("debounce")+1]||"invalid-wait",S=er(m.split("ms")[0])?Number(m.split("ms")[0]):250;c=ja(c,S)}if(i.includes("throttle")){let m=i[i.indexOf("throttle")+1]||"invalid-wait",S=er(m.split("ms")[0])?Number(m.split("ms")[0]):250;c=Na(c,S)}return i.includes("prevent")&&(c=h(c,(m,S)=>{S.preventDefault(),m(S)})),i.includes("stop")&&(c=h(c,(m,S)=>{S.stopPropagation(),m(S)})),i.includes("once")&&(c=h(c,(m,S)=>{m(S),s.removeEventListener(e,c,d)})),(i.includes("away")||i.includes("outside"))&&(s=document,c=h(c,(m,S)=>{t.contains(S.target)||S.target.isConnected!==!1&&(t.offsetWidth<1&&t.offsetHeight<1||t._x_isShown!==!1&&m(S))})),i.includes("self")&&(c=h(c,(m,S)=>{S.target===t&&m(S)})),(Gc(e)||as(e))&&(c=h(c,(m,S)=>{Qc(S,i)||m(S)})),s.addEventListener(e,c,d),()=>{s.removeEventListener(e,c,d)}}function zc(t){return t.replace(/-/g,".")}function Jc(t){return t.toLowerCase().replace(/-(\w)/g,(e,i)=>i.toUpperCase())}function er(t){return!Array.isArray(t)&&!isNaN(t)}function Yc(t){return[" ","_"].includes(t)?t:t.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[_\s]/,"-").toLowerCase()}function Gc(t){return["keydown","keyup"].includes(t)}function as(t){return["contextmenu","click","mouse"].some(e=>t.includes(e))}function Qc(t,e){let i=e.filter(c=>!["window","document","prevent","stop","once","capture","self","away","outside","passive"].includes(c));if(i.includes("debounce")){let c=i.indexOf("debounce");i.splice(c,er((i[c+1]||"invalid-wait").split("ms")[0])?2:1)}if(i.includes("throttle")){let c=i.indexOf("throttle");i.splice(c,er((i[c+1]||"invalid-wait").split("ms")[0])?2:1)}if(i.length===0||i.length===1&&Lo(t.key).includes(i[0]))return!1;const s=["ctrl","shift","alt","meta","cmd","super"].filter(c=>i.includes(c));return i=i.filter(c=>!s.includes(c)),!(s.length>0&&s.filter(d=>((d==="cmd"||d==="super")&&(d="meta"),t[`${d}Key`])).length===s.length&&(as(t.type)||Lo(t.key).includes(i[0])))}function Lo(t){if(!t)return[];t=Yc(t);let e={ctrl:"control",slash:"/",space:" ",spacebar:" ",cmd:"meta",esc:"escape",up:"arrow-up",down:"arrow-down",left:"arrow-left",right:"arrow-right",period:".",comma:",",equal:"=",minus:"-",underscore:"_"};return e[t]=t,Object.keys(e).map(i=>{if(e[i]===t)return i}).filter(i=>i)}dt("model",(t,{modifiers:e,expression:i},{effect:o,cleanup:s})=>{let c=t;e.includes("parent")&&(c=t.parentNode);let d=_t(c,i),h;typeof i=="string"?h=_t(c,`${i} = __placeholder`):typeof i=="function"&&typeof i()=="string"?h=_t(c,`${i()} = __placeholder`):h=()=>{};let m=()=>{let $;return d(K=>$=K),jo($)?$.get():$},S=$=>{let K;d(V=>K=V),jo(K)?K.set($):h(()=>{},{scope:{__placeholder:$}})};typeof i=="string"&&t.type==="radio"&&st(()=>{t.hasAttribute("name")||t.setAttribute("name",i)});var O=t.tagName.toLowerCase()==="select"||["checkbox","radio"].includes(t.type)||e.includes("lazy")?"change":"input";let C=Qt?()=>{}:bi(t,O,e,$=>{S(ei(t,e,$,m()))});if(e.includes("fill")&&([void 0,null,""].includes(m())||Ri(t)&&Array.isArray(m())||t.tagName.toLowerCase()==="select"&&t.multiple)&&S(ei(t,e,{target:t},m())),t._x_removeModelListeners||(t._x_removeModelListeners={}),t._x_removeModelListeners.default=C,s(()=>t._x_removeModelListeners.default()),t.form){let $=bi(t.form,"reset",[],K=>{$i(()=>t._x_model&&t._x_model.set(ei(t,e,{target:t},m())))});s(()=>$())}t._x_model={get(){return m()},set($){S($)}},t._x_forceModelUpdate=$=>{$===void 0&&typeof i=="string"&&i.match(/\./)&&($=""),window.fromModel=!0,st(()=>$a(t,"value",$)),delete window.fromModel},o(()=>{let $=m();e.includes("unintrusive")&&document.activeElement.isSameNode(t)||t._x_forceModelUpdate($)})});function ei(t,e,i,o){return st(()=>{if(i instanceof CustomEvent&&i.detail!==void 0)return i.detail!==null&&i.detail!==void 0?i.detail:i.target.value;if(Ri(t))if(Array.isArray(o)){let s=null;return e.includes("number")?s=ni(i.target.value):e.includes("boolean")?s=Gn(i.target.value):s=i.target.value,i.target.checked?o.includes(s)?o:o.concat([s]):o.filter(c=>!Xc(c,s))}else return i.target.checked;else{if(t.tagName.toLowerCase()==="select"&&t.multiple)return e.includes("number")?Array.from(i.target.selectedOptions).map(s=>{let c=s.value||s.text;return ni(c)}):e.includes("boolean")?Array.from(i.target.selectedOptions).map(s=>{let c=s.value||s.text;return Gn(c)}):Array.from(i.target.selectedOptions).map(s=>s.value||s.text);{let s;return La(t)?i.target.checked?s=i.target.value:s=o:s=i.target.value,e.includes("number")?ni(s):e.includes("boolean")?Gn(s):e.includes("trim")?s.trim():s}}})}function ni(t){let e=t?parseFloat(t):null;return Zc(e)?e:t}function Xc(t,e){return t==e}function Zc(t){return!Array.isArray(t)&&!isNaN(t)}function jo(t){return t!==null&&typeof t=="object"&&typeof t.get=="function"&&typeof t.set=="function"}dt("cloak",t=>queueMicrotask(()=>st(()=>t.removeAttribute(Le("cloak")))));Aa(()=>`[${Le("init")}]`);dt("init",Zt((t,{expression:e},{evaluate:i})=>typeof e=="string"?!!e.trim()&&i(e,{},!1):i(e,{},!1)));dt("text",(t,{expression:e},{effect:i,evaluateLater:o})=>{let s=o(e);i(()=>{s(c=>{st(()=>{t.textContent=c})})})});dt("html",(t,{expression:e},{effect:i,evaluateLater:o})=>{let s=o(e);i(()=>{s(c=>{st(()=>{t.innerHTML=c,t._x_ignoreSelf=!0,Kt(t),delete t._x_ignoreSelf})})})});Pi(ya(":",va(Le("bind:"))));var ss=(t,{value:e,modifiers:i,expression:o,original:s},{effect:c,cleanup:d})=>{if(!e){let m={};ic(m),_t(t,o)(O=>{qa(t,O,s)},{scope:m});return}if(e==="key")return tl(t,o);if(t._x_inlineBindings&&t._x_inlineBindings[e]&&t._x_inlineBindings[e].extract)return;let h=_t(t,o);c(()=>h(m=>{m===void 0&&typeof o=="string"&&o.match(/\./)&&(m=""),st(()=>$a(t,e,m,i))})),d(()=>{t._x_undoAddedClasses&&t._x_undoAddedClasses(),t._x_undoAddedStyles&&t._x_undoAddedStyles()})};ss.inline=(t,{value:e,modifiers:i,expression:o})=>{e&&(t._x_inlineBindings||(t._x_inlineBindings={}),t._x_inlineBindings[e]={expression:o,extract:!1})};dt("bind",ss);function tl(t,e){t._x_keyExpression=e}ka(()=>`[${Le("data")}]`);dt("data",(t,{expression:e},{cleanup:i})=>{if(el(t))return;e=e===""?"{}":e;let o={};ci(o,t);let s={};ac(s,o);let c=ye(t,e,{scope:s});(c===void 0||c===!0)&&(c={}),ci(c,t);let d=Re(c);ua(d);let h=dn(t,d);d.init&&ye(t,d.init),i(()=>{d.destroy&&ye(t,d.destroy),h()})});or((t,e)=>{t._x_dataStack&&(e._x_dataStack=t._x_dataStack,e.setAttribute("data-has-alpine-state",!0))});function el(t){return Qt?mi?!0:t.hasAttribute("data-has-alpine-state"):!1}dt("show",(t,{modifiers:e,expression:i},{effect:o})=>{let s=_t(t,i);t._x_doHide||(t._x_doHide=()=>{st(()=>{t.style.setProperty("display","none",e.includes("important")?"important":void 0)})}),t._x_doShow||(t._x_doShow=()=>{st(()=>{t.style.length===1&&t.style.display==="none"?t.removeAttribute("style"):t.style.removeProperty("display")})});let c=()=>{t._x_doHide(),t._x_isShown=!1},d=()=>{t._x_doShow(),t._x_isShown=!0},h=()=>setTimeout(d),m=pi(C=>C?d():c(),C=>{typeof t._x_toggleAndCascadeWithTransitions=="function"?t._x_toggleAndCascadeWithTransitions(t,C,d,c):C?h():c()}),S,O=!0;o(()=>s(C=>{!O&&C===S||(e.includes("immediate")&&(C?h():c()),m(C),S=C,O=!1)}))});dt("for",(t,{expression:e},{effect:i,cleanup:o})=>{let s=rl(e),c=_t(t,s.items),d=_t(t,t._x_keyExpression||"index");t._x_prevKeys=[],t._x_lookup={},i(()=>nl(t,s,c,d)),o(()=>{Object.values(t._x_lookup).forEach(h=>st(()=>{Ne(h),h.remove()})),delete t._x_prevKeys,delete t._x_lookup})});function nl(t,e,i,o){let s=d=>typeof d=="object"&&!Array.isArray(d),c=t;i(d=>{il(d)&&d>=0&&(d=Array.from(Array(d).keys(),H=>H+1)),d===void 0&&(d=[]);let h=t._x_lookup,m=t._x_prevKeys,S=[],O=[];if(s(d))d=Object.entries(d).map(([H,Y])=>{let Z=No(e,Y,H,d);o(ot=>{O.includes(ot)&&kt("Duplicate key on x-for",t),O.push(ot)},{scope:{index:H,...Z}}),S.push(Z)});else for(let H=0;H<d.length;H++){let Y=No(e,d[H],H,d);o(Z=>{O.includes(Z)&&kt("Duplicate key on x-for",t),O.push(Z)},{scope:{index:H,...Y}}),S.push(Y)}let C=[],$=[],K=[],V=[];for(let H=0;H<m.length;H++){let Y=m[H];O.indexOf(Y)===-1&&K.push(Y)}m=m.filter(H=>!K.includes(H));let et="template";for(let H=0;H<O.length;H++){let Y=O[H],Z=m.indexOf(Y);if(Z===-1)m.splice(H,0,Y),C.push([et,H]);else if(Z!==H){let ot=m.splice(H,1)[0],lt=m.splice(Z-1,1)[0];m.splice(H,0,lt),m.splice(Z,0,ot),$.push([ot,lt])}else V.push(Y);et=Y}for(let H=0;H<K.length;H++){let Y=K[H];Y in h&&(st(()=>{Ne(h[Y]),h[Y].remove()}),delete h[Y])}for(let H=0;H<$.length;H++){let[Y,Z]=$[H],ot=h[Y],lt=h[Z],Mt=document.createElement("div");st(()=>{lt||kt('x-for ":key" is undefined or invalid',c,Z,h),lt.after(Mt),ot.after(lt),lt._x_currentIfEl&&lt.after(lt._x_currentIfEl),Mt.before(ot),ot._x_currentIfEl&&ot.after(ot._x_currentIfEl),Mt.remove()}),lt._x_refreshXForScope(S[O.indexOf(Z)])}for(let H=0;H<C.length;H++){let[Y,Z]=C[H],ot=Y==="template"?c:h[Y];ot._x_currentIfEl&&(ot=ot._x_currentIfEl);let lt=S[Z],Mt=O[Z],wt=document.importNode(c.content,!0).firstElementChild,gt=Re(lt);dn(wt,gt,c),wt._x_refreshXForScope=pn=>{Object.entries(pn).forEach(([dr,gn])=>{gt[dr]=gn})},st(()=>{ot.after(wt),Zt(()=>Kt(wt))()}),typeof Mt=="object"&&kt("x-for key cannot be an object, it must be a string or an integer",c),h[Mt]=wt}for(let H=0;H<V.length;H++)h[V[H]]._x_refreshXForScope(S[O.indexOf(V[H])]);c._x_prevKeys=O})}function rl(t){let e=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,i=/^\s*\(|\)\s*$/g,o=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,s=t.match(o);if(!s)return;let c={};c.items=s[2].trim();let d=s[1].replace(i,"").trim(),h=d.match(e);return h?(c.item=d.replace(e,"").trim(),c.index=h[1].trim(),h[2]&&(c.collection=h[2].trim())):c.item=d,c}function No(t,e,i,o){let s={};return/^\[.*\]$/.test(t.item)&&Array.isArray(e)?t.item.replace("[","").replace("]","").split(",").map(d=>d.trim()).forEach((d,h)=>{s[d]=e[h]}):/^\{.*\}$/.test(t.item)&&!Array.isArray(e)&&typeof e=="object"?t.item.replace("{","").replace("}","").split(",").map(d=>d.trim()).forEach(d=>{s[d]=e[d]}):s[t.item]=e,t.index&&(s[t.index]=i),t.collection&&(s[t.collection]=o),s}function il(t){return!Array.isArray(t)&&!isNaN(t)}function us(){}us.inline=(t,{expression:e},{cleanup:i})=>{let o=rr(t);o._x_refs||(o._x_refs={}),o._x_refs[e]=t,i(()=>delete o._x_refs[e])};dt("ref",us);dt("if",(t,{expression:e},{effect:i,cleanup:o})=>{t.tagName.toLowerCase()!=="template"&&kt("x-if can only be used on a <template> tag",t);let s=_t(t,e),c=()=>{if(t._x_currentIfEl)return t._x_currentIfEl;let h=t.content.cloneNode(!0).firstElementChild;return dn(h,{},t),st(()=>{t.after(h),Zt(()=>Kt(h))()}),t._x_currentIfEl=h,t._x_undoIf=()=>{st(()=>{Ne(h),h.remove()}),delete t._x_currentIfEl},h},d=()=>{t._x_undoIf&&(t._x_undoIf(),delete t._x_undoIf)};i(()=>s(h=>{h?c():d()})),o(()=>t._x_undoIf&&t._x_undoIf())});dt("id",(t,{expression:e},{evaluate:i})=>{i(e).forEach(s=>Uc(t,s))});or((t,e)=>{t._x_ids&&(e._x_ids=t._x_ids)});Pi(ya("@",va(Le("on:"))));dt("on",Zt((t,{value:e,modifiers:i,expression:o},{cleanup:s})=>{let c=o?_t(t,o):()=>{};t.tagName.toLowerCase()==="template"&&(t._x_forwardEvents||(t._x_forwardEvents=[]),t._x_forwardEvents.includes(e)||t._x_forwardEvents.push(e));let d=bi(t,e,i,h=>{c(()=>{},{scope:{$event:h},params:[h]})});s(()=>d())}));cr("Collapse","collapse","collapse");cr("Intersect","intersect","intersect");cr("Focus","trap","focus");cr("Mask","mask","mask");function cr(t,e,i){dt(e,o=>kt(`You can't use [x-${e}] without first installing the "${t}" plugin here: https://alpinejs.dev/plugins/${i}`,o))}hn.setEvaluator(ha);hn.setReactivityEngine({reactive:qi,effect:mc,release:yc,raw:it});var ol=hn,Ot=ol;function al(){return{currentPage:"timer",init(){const t=window.Alpine.store("theme");t?.init&&t.init(),this.initRouting()},initRouting(){this.currentPage=this.getPageFromHash(),window.addEventListener("hashchange",()=>{const t=this.getPageFromHash();this.currentPage=t,window.dispatchEvent(new CustomEvent("pageChanged",{detail:{page:t}}))}),this.$watch("currentPage",t=>{this.updateHash(t)})},getPageFromHash(){const t=window.location.hash.slice(1);return["timer","timeline","insights","settings"].includes(t)?t:"timer"},updateHash(t){const e=`#${t}`;window.location.hash!==e&&(window.location.hash=e)},navigateTo(t){this.currentPage=t,window.dispatchEvent(new CustomEvent("pageChanged",{detail:{page:t}}))},toggleTheme(){window.Alpine.store("theme").toggle()},applyTheme(){window.Alpine.store("theme").apply()}}}var sl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ul(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Qn={exports:{}},cl=Qn.exports,Bo;function ll(){return Bo||(Bo=1,(function(t,e){(function(i,o){t.exports=o()})(cl,function(){var i=function(n,r){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var l in u)Object.prototype.hasOwnProperty.call(u,l)&&(a[l]=u[l])})(n,r)},o=function(){return(o=Object.assign||function(n){for(var r,a=1,u=arguments.length;a<u;a++)for(var l in r=arguments[a])Object.prototype.hasOwnProperty.call(r,l)&&(n[l]=r[l]);return n}).apply(this,arguments)};function s(n,r,a){for(var u,l=0,f=r.length;l<f;l++)!u&&l in r||((u=u||Array.prototype.slice.call(r,0,l))[l]=r[l]);return n.concat(u||Array.prototype.slice.call(r))}var c=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:sl,d=Object.keys,h=Array.isArray;function m(n,r){return typeof r!="object"||d(r).forEach(function(a){n[a]=r[a]}),n}typeof Promise>"u"||c.Promise||(c.Promise=Promise);var S=Object.getPrototypeOf,O={}.hasOwnProperty;function C(n,r){return O.call(n,r)}function $(n,r){typeof r=="function"&&(r=r(S(n))),(typeof Reflect>"u"?d:Reflect.ownKeys)(r).forEach(function(a){V(n,a,r[a])})}var K=Object.defineProperty;function V(n,r,a,u){K(n,r,m(a&&C(a,"get")&&typeof a.get=="function"?{get:a.get,set:a.set,configurable:!0}:{value:a,configurable:!0,writable:!0},u))}function et(n){return{from:function(r){return n.prototype=Object.create(r.prototype),V(n.prototype,"constructor",n),{extend:$.bind(null,n.prototype)}}}}var H=Object.getOwnPropertyDescriptor,Y=[].slice;function Z(n,r,a){return Y.call(n,r,a)}function ot(n,r){return r(n)}function lt(n){if(!n)throw new Error("Assertion Failed")}function Mt(n){c.setImmediate?setImmediate(n):setTimeout(n,0)}function wt(n,r){if(typeof r=="string"&&C(n,r))return n[r];if(!r)return n;if(typeof r!="string"){for(var a=[],u=0,l=r.length;u<l;++u){var f=wt(n,r[u]);a.push(f)}return a}var p=r.indexOf(".");if(p!==-1){var g=n[r.substr(0,p)];return g==null?void 0:wt(g,r.substr(p+1))}}function gt(n,r,a){if(n&&r!==void 0&&!("isFrozen"in Object&&Object.isFrozen(n)))if(typeof r!="string"&&"length"in r){lt(typeof a!="string"&&"length"in a);for(var u=0,l=r.length;u<l;++u)gt(n,r[u],a[u])}else{var f,p,g=r.indexOf(".");g!==-1?(f=r.substr(0,g),(p=r.substr(g+1))===""?a===void 0?h(n)&&!isNaN(parseInt(f))?n.splice(f,1):delete n[f]:n[f]=a:gt(g=!(g=n[f])||!C(n,f)?n[f]={}:g,p,a)):a===void 0?h(n)&&!isNaN(parseInt(r))?n.splice(r,1):delete n[r]:n[r]=a}}function pn(n){var r,a={};for(r in n)C(n,r)&&(a[r]=n[r]);return a}var dr=[].concat;function gn(n){return dr.apply([],n)}var re="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(gn([8,16,32,64].map(function(n){return["Int","Uint","Float"].map(function(r){return r+n+"Array"})}))).filter(function(n){return c[n]}),Hi=new Set(re.map(function(n){return c[n]})),Be=null;function te(n){return Be=new WeakMap,n=(function r(a){if(!a||typeof a!="object")return a;var u=Be.get(a);if(u)return u;if(h(a)){u=[],Be.set(a,u);for(var l=0,f=a.length;l<f;++l)u.push(r(a[l]))}else if(Hi.has(a.constructor))u=a;else{var p,g=S(a);for(p in u=g===Object.prototype?{}:Object.create(g),Be.set(a,u),a)C(a,p)&&(u[p]=r(a[p]))}return u})(n),Be=null,n}var gs={}.toString;function fr(n){return gs.call(n).slice(8,-1)}var hr=typeof Symbol<"u"?Symbol.iterator:"@@iterator",ms=typeof hr=="symbol"?function(n){var r;return n!=null&&(r=n[hr])&&r.apply(n)}:function(){return null};function ee(n,r){return r=n.indexOf(r),0<=r&&n.splice(r,1),0<=r}var Se={};function Rt(n){var r,a,u,l;if(arguments.length===1){if(h(n))return n.slice();if(this===Se&&typeof n=="string")return[n];if(l=ms(n)){for(a=[];!(u=l.next()).done;)a.push(u.value);return a}if(n==null)return[n];if(typeof(r=n.length)!="number")return[n];for(a=new Array(r);r--;)a[r]=n[r];return a}for(r=arguments.length,a=new Array(r);r--;)a[r]=arguments[r];return a}var pr=typeof Symbol<"u"?function(n){return n[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},He=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Et=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(He),ys={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function xe(n,r){this.name=n,this.message=r}function Ui(n,r){return n+". Errors: "+Object.keys(r).map(function(a){return r[a].toString()}).filter(function(a,u,l){return l.indexOf(a)===u}).join(`
`)}function mn(n,r,a,u){this.failures=r,this.failedKeys=u,this.successCount=a,this.message=Ui(n,r)}function Te(n,r){this.name="BulkError",this.failures=Object.keys(r).map(function(a){return r[a]}),this.failuresByPos=r,this.message=Ui(n,this.failures)}et(xe).from(Error).extend({toString:function(){return this.name+": "+this.message}}),et(mn).from(xe),et(Te).from(xe);var gr=Et.reduce(function(n,r){return n[r]=r+"Error",n},{}),vs=xe,W=Et.reduce(function(n,r){var a=r+"Error";function u(l,f){this.name=a,l?typeof l=="string"?(this.message="".concat(l).concat(f?`
 `+f:""),this.inner=f||null):typeof l=="object"&&(this.message="".concat(l.name," ").concat(l.message),this.inner=l):(this.message=ys[r]||a,this.inner=null)}return et(u).from(vs),n[r]=u,n},{});W.Syntax=SyntaxError,W.Type=TypeError,W.Range=RangeError;var Wi=He.reduce(function(n,r){return n[r+"Error"]=W[r],n},{}),yn=Et.reduce(function(n,r){return["Syntax","Type","Range"].indexOf(r)===-1&&(n[r+"Error"]=W[r]),n},{});function nt(){}function Ke(n){return n}function ws(n,r){return n==null||n===Ke?r:function(a){return r(n(a))}}function ne(n,r){return function(){n.apply(this,arguments),r.apply(this,arguments)}}function bs(n,r){return n===nt?r:function(){var a=n.apply(this,arguments);a!==void 0&&(arguments[0]=a);var u=this.onsuccess,l=this.onerror;this.onsuccess=null,this.onerror=null;var f=r.apply(this,arguments);return u&&(this.onsuccess=this.onsuccess?ne(u,this.onsuccess):u),l&&(this.onerror=this.onerror?ne(l,this.onerror):l),f!==void 0?f:a}}function _s(n,r){return n===nt?r:function(){n.apply(this,arguments);var a=this.onsuccess,u=this.onerror;this.onsuccess=this.onerror=null,r.apply(this,arguments),a&&(this.onsuccess=this.onsuccess?ne(a,this.onsuccess):a),u&&(this.onerror=this.onerror?ne(u,this.onerror):u)}}function Ss(n,r){return n===nt?r:function(a){var u=n.apply(this,arguments);m(a,u);var l=this.onsuccess,f=this.onerror;return this.onsuccess=null,this.onerror=null,a=r.apply(this,arguments),l&&(this.onsuccess=this.onsuccess?ne(l,this.onsuccess):l),f&&(this.onerror=this.onerror?ne(f,this.onerror):f),u===void 0?a===void 0?void 0:a:m(u,a)}}function xs(n,r){return n===nt?r:function(){return r.apply(this,arguments)!==!1&&n.apply(this,arguments)}}function mr(n,r){return n===nt?r:function(){var a=n.apply(this,arguments);if(a&&typeof a.then=="function"){for(var u=this,l=arguments.length,f=new Array(l);l--;)f[l]=arguments[l];return a.then(function(){return r.apply(u,f)})}return r.apply(this,arguments)}}yn.ModifyError=mn,yn.DexieError=xe,yn.BulkError=Te;var Pt=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Vi(n){Pt=n}var qe={},zi=100,re=typeof Promise>"u"?[]:(function(){var n=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[n,S(n),n];var r=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[r,S(r),n]})(),He=re[0],Et=re[1],re=re[2],Et=Et&&Et.then,ie=He&&He.constructor,yr=!!re,Ue=function(n,r){We.push([n,r]),vn&&(queueMicrotask(Es),vn=!1)},vr=!0,vn=!0,oe=[],wn=[],wr=Ke,qt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:nt,pgp:!1,env:{},finalize:nt},U=qt,We=[],ae=0,bn=[];function B(n){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var r=this._PSD=U;if(typeof n!="function"){if(n!==qe)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&_r(this,this._value))}this._state=null,this._value=null,++r.ref,(function a(u,l){try{l(function(f){if(u._state===null){if(f===u)throw new TypeError("A promise cannot be resolved with itself.");var p=u._lib&&Ee();f&&typeof f.then=="function"?a(u,function(g,v){f instanceof B?f._then(g,v):f.then(g,v)}):(u._state=!0,u._value=f,Yi(u)),p&&ke()}},_r.bind(null,u))}catch(f){_r(u,f)}})(this,n)}var br={get:function(){var n=U,r=Tn;function a(u,l){var f=this,p=!n.global&&(n!==U||r!==Tn),g=p&&!Ut(),v=new B(function(b,T){Sr(f,new Ji(Qi(u,n,p,g),Qi(l,n,p,g),b,T,n))});return this._consoleTask&&(v._consoleTask=this._consoleTask),v}return a.prototype=qe,a},set:function(n){V(this,"then",n&&n.prototype===qe?br:{get:function(){return n},set:br.set})}};function Ji(n,r,a,u,l){this.onFulfilled=typeof n=="function"?n:null,this.onRejected=typeof r=="function"?r:null,this.resolve=a,this.reject=u,this.psd=l}function _r(n,r){var a,u;wn.push(r),n._state===null&&(a=n._lib&&Ee(),r=wr(r),n._state=!1,n._value=r,u=n,oe.some(function(l){return l._value===u._value})||oe.push(u),Yi(n),a&&ke())}function Yi(n){var r=n._listeners;n._listeners=[];for(var a=0,u=r.length;a<u;++a)Sr(n,r[a]);var l=n._PSD;--l.ref||l.finalize(),ae===0&&(++ae,Ue(function(){--ae==0&&xr()},[]))}function Sr(n,r){if(n._state!==null){var a=n._state?r.onFulfilled:r.onRejected;if(a===null)return(n._state?r.resolve:r.reject)(n._value);++r.psd.ref,++ae,Ue(Ts,[a,n,r])}else n._listeners.push(r)}function Ts(n,r,a){try{var u,l=r._value;!r._state&&wn.length&&(wn=[]),u=Pt&&r._consoleTask?r._consoleTask.run(function(){return n(l)}):n(l),r._state||wn.indexOf(l)!==-1||(function(f){for(var p=oe.length;p;)if(oe[--p]._value===f._value)return oe.splice(p,1)})(r),a.resolve(u)}catch(f){a.reject(f)}finally{--ae==0&&xr(),--a.psd.ref||a.psd.finalize()}}function Es(){se(qt,function(){Ee()&&ke()})}function Ee(){var n=vr;return vn=vr=!1,n}function ke(){var n,r,a;do for(;0<We.length;)for(n=We,We=[],a=n.length,r=0;r<a;++r){var u=n[r];u[0].apply(null,u[1])}while(0<We.length);vn=vr=!0}function xr(){var n=oe;oe=[],n.forEach(function(u){u._PSD.onunhandled.call(null,u._value,u)});for(var r=bn.slice(0),a=r.length;a;)r[--a]()}function _n(n){return new B(qe,!1,n)}function at(n,r){var a=U;return function(){var u=Ee(),l=U;try{return Wt(a,!0),n.apply(this,arguments)}catch(f){r&&r(f)}finally{Wt(l,!1),u&&ke()}}}$(B.prototype,{then:br,_then:function(n,r){Sr(this,new Ji(null,null,n,r,U))},catch:function(n){if(arguments.length===1)return this.then(null,n);var r=n,a=arguments[1];return typeof r=="function"?this.then(null,function(u){return(u instanceof r?a:_n)(u)}):this.then(null,function(u){return(u&&u.name===r?a:_n)(u)})},finally:function(n){return this.then(function(r){return B.resolve(n()).then(function(){return r})},function(r){return B.resolve(n()).then(function(){return _n(r)})})},timeout:function(n,r){var a=this;return n<1/0?new B(function(u,l){var f=setTimeout(function(){return l(new W.Timeout(r))},n);a.then(u,l).finally(clearTimeout.bind(null,f))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&V(B.prototype,Symbol.toStringTag,"Dexie.Promise"),qt.env=Gi(),$(B,{all:function(){var n=Rt.apply(null,arguments).map(En);return new B(function(r,a){n.length===0&&r([]);var u=n.length;n.forEach(function(l,f){return B.resolve(l).then(function(p){n[f]=p,--u||r(n)},a)})})},resolve:function(n){return n instanceof B?n:n&&typeof n.then=="function"?new B(function(r,a){n.then(r,a)}):new B(qe,!0,n)},reject:_n,race:function(){var n=Rt.apply(null,arguments).map(En);return new B(function(r,a){n.map(function(u){return B.resolve(u).then(r,a)})})},PSD:{get:function(){return U},set:function(n){return U=n}},totalEchoes:{get:function(){return Tn}},newPSD:Ht,usePSD:se,scheduler:{get:function(){return Ue},set:function(n){Ue=n}},rejectionMapper:{get:function(){return wr},set:function(n){wr=n}},follow:function(n,r){return new B(function(a,u){return Ht(function(l,f){var p=U;p.unhandleds=[],p.onunhandled=f,p.finalize=ne(function(){var g,v=this;g=function(){v.unhandleds.length===0?l():f(v.unhandleds[0])},bn.push(function b(){g(),bn.splice(bn.indexOf(b),1)}),++ae,Ue(function(){--ae==0&&xr()},[])},p.finalize),n()},r,a,u)})}}),ie&&(ie.allSettled&&V(B,"allSettled",function(){var n=Rt.apply(null,arguments).map(En);return new B(function(r){n.length===0&&r([]);var a=n.length,u=new Array(a);n.forEach(function(l,f){return B.resolve(l).then(function(p){return u[f]={status:"fulfilled",value:p}},function(p){return u[f]={status:"rejected",reason:p}}).then(function(){return--a||r(u)})})})}),ie.any&&typeof AggregateError<"u"&&V(B,"any",function(){var n=Rt.apply(null,arguments).map(En);return new B(function(r,a){n.length===0&&a(new AggregateError([]));var u=n.length,l=new Array(u);n.forEach(function(f,p){return B.resolve(f).then(function(g){return r(g)},function(g){l[p]=g,--u||a(new AggregateError(l))})})})}),ie.withResolvers&&(B.withResolvers=ie.withResolvers));var ft={awaits:0,echoes:0,id:0},ks=0,Sn=[],xn=0,Tn=0,As=0;function Ht(n,r,a,u){var l=U,f=Object.create(l);return f.parent=l,f.ref=0,f.global=!1,f.id=++As,qt.env,f.env=yr?{Promise:B,PromiseProp:{value:B,configurable:!0,writable:!0},all:B.all,race:B.race,allSettled:B.allSettled,any:B.any,resolve:B.resolve,reject:B.reject}:{},r&&m(f,r),++l.ref,f.finalize=function(){--this.parent.ref||this.parent.finalize()},u=se(f,n,a,u),f.ref===0&&f.finalize(),u}function Ae(){return ft.id||(ft.id=++ks),++ft.awaits,ft.echoes+=zi,ft.id}function Ut(){return!!ft.awaits&&(--ft.awaits==0&&(ft.id=0),ft.echoes=ft.awaits*zi,!0)}function En(n){return ft.echoes&&n&&n.constructor===ie?(Ae(),n.then(function(r){return Ut(),r},function(r){return Ut(),ut(r)})):n}function Ds(){var n=Sn[Sn.length-1];Sn.pop(),Wt(n,!1)}function Wt(n,r){var a,u=U;(r?!ft.echoes||xn++&&n===U:!xn||--xn&&n===U)||queueMicrotask(r?function(l){++Tn,ft.echoes&&--ft.echoes!=0||(ft.echoes=ft.awaits=ft.id=0),Sn.push(U),Wt(l,!0)}.bind(null,n):Ds),n!==U&&(U=n,u===qt&&(qt.env=Gi()),yr&&(a=qt.env.Promise,r=n.env,(u.global||n.global)&&(Object.defineProperty(c,"Promise",r.PromiseProp),a.all=r.all,a.race=r.race,a.resolve=r.resolve,a.reject=r.reject,r.allSettled&&(a.allSettled=r.allSettled),r.any&&(a.any=r.any))))}function Gi(){var n=c.Promise;return yr?{Promise:n,PromiseProp:Object.getOwnPropertyDescriptor(c,"Promise"),all:n.all,race:n.race,allSettled:n.allSettled,any:n.any,resolve:n.resolve,reject:n.reject}:{}}function se(n,r,a,u,l){var f=U;try{return Wt(n,!0),r(a,u,l)}finally{Wt(f,!1)}}function Qi(n,r,a,u){return typeof n!="function"?n:function(){var l=U;a&&Ae(),Wt(r,!0);try{return n.apply(this,arguments)}finally{Wt(l,!1),u&&queueMicrotask(Ut)}}}function Tr(n){Promise===ie&&ft.echoes===0?xn===0?n():enqueueNativeMicroTask(n):setTimeout(n,0)}(""+Et).indexOf("[native code]")===-1&&(Ae=Ut=nt);var ut=B.reject,ue="",Ft="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Xi="String expected.",De=[],kn="__dbnames",Er="readonly",kr="readwrite";function ce(n,r){return n?r?function(){return n.apply(this,arguments)&&r.apply(this,arguments)}:n:r}var Zi={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function An(n){return typeof n!="string"||/\./.test(n)?function(r){return r}:function(r){return r[n]===void 0&&n in r&&delete(r=te(r))[n],r}}function to(){throw W.Type()}function X(n,r){try{var a=eo(n),u=eo(r);if(a!==u)return a==="Array"?1:u==="Array"?-1:a==="binary"?1:u==="binary"?-1:a==="string"?1:u==="string"?-1:a==="Date"?1:u!=="Date"?NaN:-1;switch(a){case"number":case"Date":case"string":return r<n?1:n<r?-1:0;case"binary":return(function(l,f){for(var p=l.length,g=f.length,v=p<g?p:g,b=0;b<v;++b)if(l[b]!==f[b])return l[b]<f[b]?-1:1;return p===g?0:p<g?-1:1})(no(n),no(r));case"Array":return(function(l,f){for(var p=l.length,g=f.length,v=p<g?p:g,b=0;b<v;++b){var T=X(l[b],f[b]);if(T!==0)return T}return p===g?0:p<g?-1:1})(n,r)}}catch{}return NaN}function eo(n){var r=typeof n;return r!="object"?r:ArrayBuffer.isView(n)?"binary":(n=fr(n),n==="ArrayBuffer"?"binary":n)}function no(n){return n instanceof Uint8Array?n:ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n)}var ro=(rt.prototype._trans=function(n,r,a){var u=this._tx||U.trans,l=this.name,f=Pt&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(n==="readonly"?"read":"write"," ").concat(this.name));function p(b,T,y){if(!y.schema[l])throw new W.NotFound("Table "+l+" not part of transaction");return r(y.idbtrans,y)}var g=Ee();try{var v=u&&u.db._novip===this.db._novip?u===U.trans?u._promise(n,p,a):Ht(function(){return u._promise(n,p,a)},{trans:u,transless:U.transless||U}):(function b(T,y,k,w){if(T.idbdb&&(T._state.openComplete||U.letThrough||T._vip)){var x=T._createTransaction(y,k,T._dbSchema);try{x.create(),T._state.PR1398_maxLoop=3}catch(E){return E.name===gr.InvalidState&&T.isOpen()&&0<--T._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),T.close({disableAutoOpen:!1}),T.open().then(function(){return b(T,y,k,w)})):ut(E)}return x._promise(y,function(E,_){return Ht(function(){return U.trans=x,w(E,_,x)})}).then(function(E){if(y==="readwrite")try{x.idbtrans.commit()}catch{}return y==="readonly"?E:x._completion.then(function(){return E})})}if(T._state.openComplete)return ut(new W.DatabaseClosed(T._state.dbOpenError));if(!T._state.isBeingOpened){if(!T._state.autoOpen)return ut(new W.DatabaseClosed);T.open().catch(nt)}return T._state.dbReadyPromise.then(function(){return b(T,y,k,w)})})(this.db,n,[this.name],p);return f&&(v._consoleTask=f,v=v.catch(function(b){return console.trace(b),ut(b)})),v}finally{g&&ke()}},rt.prototype.get=function(n,r){var a=this;return n&&n.constructor===Object?this.where(n).first(r):n==null?ut(new W.Type("Invalid argument to Table.get()")):this._trans("readonly",function(u){return a.core.get({trans:u,key:n}).then(function(l){return a.hook.reading.fire(l)})}).then(r)},rt.prototype.where=function(n){if(typeof n=="string")return new this.db.WhereClause(this,n);if(h(n))return new this.db.WhereClause(this,"[".concat(n.join("+"),"]"));var r=d(n);if(r.length===1)return this.where(r[0]).equals(n[r[0]]);var a=this.schema.indexes.concat(this.schema.primKey).filter(function(g){if(g.compound&&r.every(function(b){return 0<=g.keyPath.indexOf(b)})){for(var v=0;v<r.length;++v)if(r.indexOf(g.keyPath[v])===-1)return!1;return!0}return!1}).sort(function(g,v){return g.keyPath.length-v.keyPath.length})[0];if(a&&this.db._maxKey!==ue){var f=a.keyPath.slice(0,r.length);return this.where(f).equals(f.map(function(v){return n[v]}))}!a&&Pt&&console.warn("The query ".concat(JSON.stringify(n)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(r.join("+"),"]"));var u=this.schema.idxByName;function l(g,v){return X(g,v)===0}var p=r.reduce(function(y,v){var b=y[0],T=y[1],y=u[v],k=n[v];return[b||y,b||!y?ce(T,y&&y.multi?function(w){return w=wt(w,v),h(w)&&w.some(function(x){return l(k,x)})}:function(w){return l(k,wt(w,v))}):T]},[null,null]),f=p[0],p=p[1];return f?this.where(f.name).equals(n[f.keyPath]).filter(p):a?this.filter(p):this.where(r).equals("")},rt.prototype.filter=function(n){return this.toCollection().and(n)},rt.prototype.count=function(n){return this.toCollection().count(n)},rt.prototype.offset=function(n){return this.toCollection().offset(n)},rt.prototype.limit=function(n){return this.toCollection().limit(n)},rt.prototype.each=function(n){return this.toCollection().each(n)},rt.prototype.toArray=function(n){return this.toCollection().toArray(n)},rt.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},rt.prototype.orderBy=function(n){return new this.db.Collection(new this.db.WhereClause(this,h(n)?"[".concat(n.join("+"),"]"):n))},rt.prototype.reverse=function(){return this.toCollection().reverse()},rt.prototype.mapToClass=function(n){var r,a=this.db,u=this.name;function l(){return r!==null&&r.apply(this,arguments)||this}(this.schema.mappedClass=n).prototype instanceof to&&((function(v,b){if(typeof b!="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function T(){this.constructor=v}i(v,b),v.prototype=b===null?Object.create(b):(T.prototype=b.prototype,new T)})(l,r=n),Object.defineProperty(l.prototype,"db",{get:function(){return a},enumerable:!1,configurable:!0}),l.prototype.table=function(){return u},n=l);for(var f=new Set,p=n.prototype;p;p=S(p))Object.getOwnPropertyNames(p).forEach(function(v){return f.add(v)});function g(v){if(!v)return v;var b,T=Object.create(n.prototype);for(b in v)if(!f.has(b))try{T[b]=v[b]}catch{}return T}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=g,this.hook("reading",g),n},rt.prototype.defineClass=function(){return this.mapToClass(function(n){m(this,n)})},rt.prototype.add=function(n,r){var a=this,u=this.schema.primKey,l=u.auto,f=u.keyPath,p=n;return f&&l&&(p=An(f)(n)),this._trans("readwrite",function(g){return a.core.mutate({trans:g,type:"add",keys:r!=null?[r]:null,values:[p]})}).then(function(g){return g.numFailures?B.reject(g.failures[0]):g.lastResult}).then(function(g){if(f)try{gt(n,f,g)}catch{}return g})},rt.prototype.update=function(n,r){return typeof n!="object"||h(n)?this.where(":id").equals(n).modify(r):(n=wt(n,this.schema.primKey.keyPath),n===void 0?ut(new W.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(n).modify(r))},rt.prototype.put=function(n,r){var a=this,u=this.schema.primKey,l=u.auto,f=u.keyPath,p=n;return f&&l&&(p=An(f)(n)),this._trans("readwrite",function(g){return a.core.mutate({trans:g,type:"put",values:[p],keys:r!=null?[r]:null})}).then(function(g){return g.numFailures?B.reject(g.failures[0]):g.lastResult}).then(function(g){if(f)try{gt(n,f,g)}catch{}return g})},rt.prototype.delete=function(n){var r=this;return this._trans("readwrite",function(a){return r.core.mutate({trans:a,type:"delete",keys:[n]})}).then(function(a){return a.numFailures?B.reject(a.failures[0]):void 0})},rt.prototype.clear=function(){var n=this;return this._trans("readwrite",function(r){return n.core.mutate({trans:r,type:"deleteRange",range:Zi})}).then(function(r){return r.numFailures?B.reject(r.failures[0]):void 0})},rt.prototype.bulkGet=function(n){var r=this;return this._trans("readonly",function(a){return r.core.getMany({keys:n,trans:a}).then(function(u){return u.map(function(l){return r.hook.reading.fire(l)})})})},rt.prototype.bulkAdd=function(n,r,a){var u=this,l=Array.isArray(r)?r:void 0,f=(a=a||(l?void 0:r))?a.allKeys:void 0;return this._trans("readwrite",function(p){var b=u.schema.primKey,g=b.auto,b=b.keyPath;if(b&&l)throw new W.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(l&&l.length!==n.length)throw new W.InvalidArgument("Arguments objects and keys must have the same length");var v=n.length,b=b&&g?n.map(An(b)):n;return u.core.mutate({trans:p,type:"add",keys:l,values:b,wantResults:f}).then(function(x){var y=x.numFailures,k=x.results,w=x.lastResult,x=x.failures;if(y===0)return f?k:w;throw new Te("".concat(u.name,".bulkAdd(): ").concat(y," of ").concat(v," operations failed"),x)})})},rt.prototype.bulkPut=function(n,r,a){var u=this,l=Array.isArray(r)?r:void 0,f=(a=a||(l?void 0:r))?a.allKeys:void 0;return this._trans("readwrite",function(p){var b=u.schema.primKey,g=b.auto,b=b.keyPath;if(b&&l)throw new W.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(l&&l.length!==n.length)throw new W.InvalidArgument("Arguments objects and keys must have the same length");var v=n.length,b=b&&g?n.map(An(b)):n;return u.core.mutate({trans:p,type:"put",keys:l,values:b,wantResults:f}).then(function(x){var y=x.numFailures,k=x.results,w=x.lastResult,x=x.failures;if(y===0)return f?k:w;throw new Te("".concat(u.name,".bulkPut(): ").concat(y," of ").concat(v," operations failed"),x)})})},rt.prototype.bulkUpdate=function(n){var r=this,a=this.core,u=n.map(function(p){return p.key}),l=n.map(function(p){return p.changes}),f=[];return this._trans("readwrite",function(p){return a.getMany({trans:p,keys:u,cache:"clone"}).then(function(g){var v=[],b=[];n.forEach(function(y,k){var w=y.key,x=y.changes,E=g[k];if(E){for(var _=0,A=Object.keys(x);_<A.length;_++){var D=A[_],P=x[D];if(D===r.schema.primKey.keyPath){if(X(P,w)!==0)throw new W.Constraint("Cannot update primary key in bulkUpdate()")}else gt(E,D,P)}f.push(k),v.push(w),b.push(E)}});var T=v.length;return a.mutate({trans:p,type:"put",keys:v,values:b,updates:{keys:u,changeSpecs:l}}).then(function(y){var k=y.numFailures,w=y.failures;if(k===0)return T;for(var x=0,E=Object.keys(w);x<E.length;x++){var _,A=E[x],D=f[Number(A)];D!=null&&(_=w[A],delete w[A],w[D]=_)}throw new Te("".concat(r.name,".bulkUpdate(): ").concat(k," of ").concat(T," operations failed"),w)})})})},rt.prototype.bulkDelete=function(n){var r=this,a=n.length;return this._trans("readwrite",function(u){return r.core.mutate({trans:u,type:"delete",keys:n})}).then(function(p){var l=p.numFailures,f=p.lastResult,p=p.failures;if(l===0)return f;throw new Te("".concat(r.name,".bulkDelete(): ").concat(l," of ").concat(a," operations failed"),p)})},rt);function rt(){}function Ve(n){function r(p,g){if(g){for(var v=arguments.length,b=new Array(v-1);--v;)b[v-1]=arguments[v];return a[p].subscribe.apply(null,b),n}if(typeof p=="string")return a[p]}var a={};r.addEventType=f;for(var u=1,l=arguments.length;u<l;++u)f(arguments[u]);return r;function f(p,g,v){if(typeof p!="object"){var b;g=g||xs;var T={subscribers:[],fire:v=v||nt,subscribe:function(y){T.subscribers.indexOf(y)===-1&&(T.subscribers.push(y),T.fire=g(T.fire,y))},unsubscribe:function(y){T.subscribers=T.subscribers.filter(function(k){return k!==y}),T.fire=T.subscribers.reduce(g,v)}};return a[p]=r[p]=T}d(b=p).forEach(function(y){var k=b[y];if(h(k))f(y,b[y][0],b[y][1]);else{if(k!=="asap")throw new W.InvalidArgument("Invalid event config");var w=f(y,Ke,function(){for(var x=arguments.length,E=new Array(x);x--;)E[x]=arguments[x];w.subscribers.forEach(function(_){Mt(function(){_.apply(null,E)})})})}})}}function ze(n,r){return et(r).from({prototype:n}),r}function Oe(n,r){return!(n.filter||n.algorithm||n.or)&&(r?n.justLimit:!n.replayFilter)}function Ar(n,r){n.filter=ce(n.filter,r)}function Dr(n,r,a){var u=n.replayFilter;n.replayFilter=u?function(){return ce(u(),r())}:r,n.justLimit=a&&!u}function Dn(n,r){if(n.isPrimKey)return r.primaryKey;var a=r.getIndexByKeyPath(n.index);if(!a)throw new W.Schema("KeyPath "+n.index+" on object store "+r.name+" is not indexed");return a}function io(n,r,a){var u=Dn(n,r.schema);return r.openCursor({trans:a,values:!n.keysOnly,reverse:n.dir==="prev",unique:!!n.unique,query:{index:u,range:n.range}})}function On(n,r,a,u){var l=n.replayFilter?ce(n.filter,n.replayFilter()):n.filter;if(n.or){var f={},p=function(g,v,b){var T,y;l&&!l(v,b,function(k){return v.stop(k)},function(k){return v.fail(k)})||((y=""+(T=v.primaryKey))=="[object ArrayBuffer]"&&(y=""+new Uint8Array(T)),C(f,y)||(f[y]=!0,r(g,v,b)))};return Promise.all([n.or._iterate(p,a),oo(io(n,u,a),n.algorithm,p,!n.keysOnly&&n.valueMapper)])}return oo(io(n,u,a),ce(n.algorithm,l),r,!n.keysOnly&&n.valueMapper)}function oo(n,r,a,u){var l=at(u?function(f,p,g){return a(u(f),p,g)}:a);return n.then(function(f){if(f)return f.start(function(){var p=function(){return f.continue()};r&&!r(f,function(g){return p=g},function(g){f.stop(g),p=nt},function(g){f.fail(g),p=nt})||l(f.value,f,function(g){return p=g}),p()})})}var Je=(ao.prototype.execute=function(n){var r=this["@@propmod"];if(r.add!==void 0){var a=r.add;if(h(a))return s(s([],h(n)?n:[],!0),a).sort();if(typeof a=="number")return(Number(n)||0)+a;if(typeof a=="bigint")try{return BigInt(n)+a}catch{return BigInt(0)+a}throw new TypeError("Invalid term ".concat(a))}if(r.remove!==void 0){var u=r.remove;if(h(u))return h(n)?n.filter(function(l){return!u.includes(l)}).sort():[];if(typeof u=="number")return Number(n)-u;if(typeof u=="bigint")try{return BigInt(n)-u}catch{return BigInt(0)-u}throw new TypeError("Invalid subtrahend ".concat(u))}return a=(a=r.replacePrefix)===null||a===void 0?void 0:a[0],a&&typeof n=="string"&&n.startsWith(a)?r.replacePrefix[1]+n.substring(a.length):n},ao);function ao(n){this["@@propmod"]=n}var Os=(tt.prototype._read=function(n,r){var a=this._ctx;return a.error?a.table._trans(null,ut.bind(null,a.error)):a.table._trans("readonly",n).then(r)},tt.prototype._write=function(n){var r=this._ctx;return r.error?r.table._trans(null,ut.bind(null,r.error)):r.table._trans("readwrite",n,"locked")},tt.prototype._addAlgorithm=function(n){var r=this._ctx;r.algorithm=ce(r.algorithm,n)},tt.prototype._iterate=function(n,r){return On(this._ctx,n,r,this._ctx.table.core)},tt.prototype.clone=function(n){var r=Object.create(this.constructor.prototype),a=Object.create(this._ctx);return n&&m(a,n),r._ctx=a,r},tt.prototype.raw=function(){return this._ctx.valueMapper=null,this},tt.prototype.each=function(n){var r=this._ctx;return this._read(function(a){return On(r,n,a,r.table.core)})},tt.prototype.count=function(n){var r=this;return this._read(function(a){var u=r._ctx,l=u.table.core;if(Oe(u,!0))return l.count({trans:a,query:{index:Dn(u,l.schema),range:u.range}}).then(function(p){return Math.min(p,u.limit)});var f=0;return On(u,function(){return++f,!1},a,l).then(function(){return f})}).then(n)},tt.prototype.sortBy=function(n,r){var a=n.split(".").reverse(),u=a[0],l=a.length-1;function f(v,b){return b?f(v[a[b]],b-1):v[u]}var p=this._ctx.dir==="next"?1:-1;function g(v,b){return X(f(v,l),f(b,l))*p}return this.toArray(function(v){return v.sort(g)}).then(r)},tt.prototype.toArray=function(n){var r=this;return this._read(function(a){var u=r._ctx;if(u.dir==="next"&&Oe(u,!0)&&0<u.limit){var l=u.valueMapper,f=Dn(u,u.table.core.schema);return u.table.core.query({trans:a,limit:u.limit,values:!0,query:{index:f,range:u.range}}).then(function(g){return g=g.result,l?g.map(l):g})}var p=[];return On(u,function(g){return p.push(g)},a,u.table.core).then(function(){return p})},n)},tt.prototype.offset=function(n){var r=this._ctx;return n<=0||(r.offset+=n,Oe(r)?Dr(r,function(){var a=n;return function(u,l){return a===0||(a===1?--a:l(function(){u.advance(a),a=0}),!1)}}):Dr(r,function(){var a=n;return function(){return--a<0}})),this},tt.prototype.limit=function(n){return this._ctx.limit=Math.min(this._ctx.limit,n),Dr(this._ctx,function(){var r=n;return function(a,u,l){return--r<=0&&u(l),0<=r}},!0),this},tt.prototype.until=function(n,r){return Ar(this._ctx,function(a,u,l){return!n(a.value)||(u(l),r)}),this},tt.prototype.first=function(n){return this.limit(1).toArray(function(r){return r[0]}).then(n)},tt.prototype.last=function(n){return this.reverse().first(n)},tt.prototype.filter=function(n){var r;return Ar(this._ctx,function(a){return n(a.value)}),(r=this._ctx).isMatch=ce(r.isMatch,n),this},tt.prototype.and=function(n){return this.filter(n)},tt.prototype.or=function(n){return new this.db.WhereClause(this._ctx.table,n,this)},tt.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},tt.prototype.desc=function(){return this.reverse()},tt.prototype.eachKey=function(n){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(a,u){n(u.key,u)})},tt.prototype.eachUniqueKey=function(n){return this._ctx.unique="unique",this.eachKey(n)},tt.prototype.eachPrimaryKey=function(n){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(a,u){n(u.primaryKey,u)})},tt.prototype.keys=function(n){var r=this._ctx;r.keysOnly=!r.isMatch;var a=[];return this.each(function(u,l){a.push(l.key)}).then(function(){return a}).then(n)},tt.prototype.primaryKeys=function(n){var r=this._ctx;if(r.dir==="next"&&Oe(r,!0)&&0<r.limit)return this._read(function(u){var l=Dn(r,r.table.core.schema);return r.table.core.query({trans:u,values:!1,limit:r.limit,query:{index:l,range:r.range}})}).then(function(u){return u.result}).then(n);r.keysOnly=!r.isMatch;var a=[];return this.each(function(u,l){a.push(l.primaryKey)}).then(function(){return a}).then(n)},tt.prototype.uniqueKeys=function(n){return this._ctx.unique="unique",this.keys(n)},tt.prototype.firstKey=function(n){return this.limit(1).keys(function(r){return r[0]}).then(n)},tt.prototype.lastKey=function(n){return this.reverse().firstKey(n)},tt.prototype.distinct=function(){var n=this._ctx,n=n.index&&n.table.schema.idxByName[n.index];if(!n||!n.multi)return this;var r={};return Ar(this._ctx,function(l){var u=l.primaryKey.toString(),l=C(r,u);return r[u]=!0,!l}),this},tt.prototype.modify=function(n){var r=this,a=this._ctx;return this._write(function(u){var l,f,p;p=typeof n=="function"?n:(l=d(n),f=l.length,function(_){for(var A=!1,D=0;D<f;++D){var P=l[D],I=n[P],M=wt(_,P);I instanceof Je?(gt(_,P,I.execute(M)),A=!0):M!==I&&(gt(_,P,I),A=!0)}return A});var g=a.table.core,y=g.schema.primaryKey,v=y.outbound,b=y.extractKey,T=200,y=r.db._options.modifyChunkSize;y&&(T=typeof y=="object"?y[g.name]||y["*"]||200:y);function k(_,P){var D=P.failures,P=P.numFailures;x+=_-P;for(var I=0,M=d(D);I<M.length;I++){var j=M[I];w.push(D[j])}}var w=[],x=0,E=[];return r.clone().primaryKeys().then(function(_){function A(P){var I=Math.min(T,_.length-P);return g.getMany({trans:u,keys:_.slice(P,P+I),cache:"immutable"}).then(function(M){for(var j=[],R=[],F=v?[]:null,N=[],L=0;L<I;++L){var q=M[L],J={value:te(q),primKey:_[P+L]};p.call(J,J.value,J)!==!1&&(J.value==null?N.push(_[P+L]):v||X(b(q),b(J.value))===0?(R.push(J.value),v&&F.push(_[P+L])):(N.push(_[P+L]),j.push(J.value)))}return Promise.resolve(0<j.length&&g.mutate({trans:u,type:"add",values:j}).then(function(G){for(var Q in G.failures)N.splice(parseInt(Q),1);k(j.length,G)})).then(function(){return(0<R.length||D&&typeof n=="object")&&g.mutate({trans:u,type:"put",keys:F,values:R,criteria:D,changeSpec:typeof n!="function"&&n,isAdditionalChunk:0<P}).then(function(G){return k(R.length,G)})}).then(function(){return(0<N.length||D&&n===Or)&&g.mutate({trans:u,type:"delete",keys:N,criteria:D,isAdditionalChunk:0<P}).then(function(G){return k(N.length,G)})}).then(function(){return _.length>P+I&&A(P+T)})})}var D=Oe(a)&&a.limit===1/0&&(typeof n!="function"||n===Or)&&{index:a.index,range:a.range};return A(0).then(function(){if(0<w.length)throw new mn("Error modifying one or more objects",w,x,E);return _.length})})})},tt.prototype.delete=function(){var n=this._ctx,r=n.range;return Oe(n)&&(n.isPrimKey||r.type===3)?this._write(function(a){var u=n.table.core.schema.primaryKey,l=r;return n.table.core.count({trans:a,query:{index:u,range:l}}).then(function(f){return n.table.core.mutate({trans:a,type:"deleteRange",range:l}).then(function(p){var g=p.failures;if(p.lastResult,p.results,p=p.numFailures,p)throw new mn("Could not delete some values",Object.keys(g).map(function(v){return g[v]}),f-p);return f-p})})}):this.modify(Or)},tt);function tt(){}var Or=function(n,r){return r.value=null};function Ps(n,r){return n<r?-1:n===r?0:1}function Cs(n,r){return r<n?-1:n===r?0:1}function xt(n,r,a){return n=n instanceof uo?new n.Collection(n):n,n._ctx.error=new(a||TypeError)(r),n}function Pe(n){return new n.Collection(n,function(){return so("")}).limit(0)}function Pn(n,r,a,u){var l,f,p,g,v,b,T,y=a.length;if(!a.every(function(x){return typeof x=="string"}))return xt(n,Xi);function k(x){l=x==="next"?function(_){return _.toUpperCase()}:function(_){return _.toLowerCase()},f=x==="next"?function(_){return _.toLowerCase()}:function(_){return _.toUpperCase()},p=x==="next"?Ps:Cs;var E=a.map(function(_){return{lower:f(_),upper:l(_)}}).sort(function(_,A){return p(_.lower,A.lower)});g=E.map(function(_){return _.upper}),v=E.map(function(_){return _.lower}),T=(b=x)==="next"?"":u}k("next"),n=new n.Collection(n,function(){return Vt(g[0],v[y-1]+u)}),n._ondirectionchange=function(x){k(x)};var w=0;return n._addAlgorithm(function(x,E,_){var A=x.key;if(typeof A!="string")return!1;var D=f(A);if(r(D,v,w))return!0;for(var P=null,I=w;I<y;++I){var M=(function(j,R,F,N,L,q){for(var J=Math.min(j.length,N.length),G=-1,Q=0;Q<J;++Q){var Tt=R[Q];if(Tt!==N[Q])return L(j[Q],F[Q])<0?j.substr(0,Q)+F[Q]+F.substr(Q+1):L(j[Q],N[Q])<0?j.substr(0,Q)+N[Q]+F.substr(Q+1):0<=G?j.substr(0,G)+R[G]+F.substr(G+1):null;L(j[Q],Tt)<0&&(G=Q)}return J<N.length&&q==="next"?j+F.substr(j.length):J<j.length&&q==="prev"?j.substr(0,F.length):G<0?null:j.substr(0,G)+N[G]+F.substr(G+1)})(A,D,g[I],v[I],p,b);M===null&&P===null?w=I+1:(P===null||0<p(P,M))&&(P=M)}return E(P!==null?function(){x.continue(P+T)}:_),!1}),n}function Vt(n,r,a,u){return{type:2,lower:n,upper:r,lowerOpen:a,upperOpen:u}}function so(n){return{type:1,lower:n,upper:n}}var uo=(Object.defineProperty(ht.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),ht.prototype.between=function(n,r,a,u){a=a!==!1,u=u===!0;try{return 0<this._cmp(n,r)||this._cmp(n,r)===0&&(a||u)&&(!a||!u)?Pe(this):new this.Collection(this,function(){return Vt(n,r,!a,!u)})}catch{return xt(this,Ft)}},ht.prototype.equals=function(n){return n==null?xt(this,Ft):new this.Collection(this,function(){return so(n)})},ht.prototype.above=function(n){return n==null?xt(this,Ft):new this.Collection(this,function(){return Vt(n,void 0,!0)})},ht.prototype.aboveOrEqual=function(n){return n==null?xt(this,Ft):new this.Collection(this,function(){return Vt(n,void 0,!1)})},ht.prototype.below=function(n){return n==null?xt(this,Ft):new this.Collection(this,function(){return Vt(void 0,n,!1,!0)})},ht.prototype.belowOrEqual=function(n){return n==null?xt(this,Ft):new this.Collection(this,function(){return Vt(void 0,n)})},ht.prototype.startsWith=function(n){return typeof n!="string"?xt(this,Xi):this.between(n,n+ue,!0,!0)},ht.prototype.startsWithIgnoreCase=function(n){return n===""?this.startsWith(n):Pn(this,function(r,a){return r.indexOf(a[0])===0},[n],ue)},ht.prototype.equalsIgnoreCase=function(n){return Pn(this,function(r,a){return r===a[0]},[n],"")},ht.prototype.anyOfIgnoreCase=function(){var n=Rt.apply(Se,arguments);return n.length===0?Pe(this):Pn(this,function(r,a){return a.indexOf(r)!==-1},n,"")},ht.prototype.startsWithAnyOfIgnoreCase=function(){var n=Rt.apply(Se,arguments);return n.length===0?Pe(this):Pn(this,function(r,a){return a.some(function(u){return r.indexOf(u)===0})},n,ue)},ht.prototype.anyOf=function(){var n=this,r=Rt.apply(Se,arguments),a=this._cmp;try{r.sort(a)}catch{return xt(this,Ft)}if(r.length===0)return Pe(this);var u=new this.Collection(this,function(){return Vt(r[0],r[r.length-1])});u._ondirectionchange=function(f){a=f==="next"?n._ascending:n._descending,r.sort(a)};var l=0;return u._addAlgorithm(function(f,p,g){for(var v=f.key;0<a(v,r[l]);)if(++l===r.length)return p(g),!1;return a(v,r[l])===0||(p(function(){f.continue(r[l])}),!1)}),u},ht.prototype.notEqual=function(n){return this.inAnyRange([[-1/0,n],[n,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},ht.prototype.noneOf=function(){var n=Rt.apply(Se,arguments);if(n.length===0)return new this.Collection(this);try{n.sort(this._ascending)}catch{return xt(this,Ft)}var r=n.reduce(function(a,u){return a?a.concat([[a[a.length-1][1],u]]):[[-1/0,u]]},null);return r.push([n[n.length-1],this.db._maxKey]),this.inAnyRange(r,{includeLowers:!1,includeUppers:!1})},ht.prototype.inAnyRange=function(A,r){var a=this,u=this._cmp,l=this._ascending,f=this._descending,p=this._min,g=this._max;if(A.length===0)return Pe(this);if(!A.every(function(D){return D[0]!==void 0&&D[1]!==void 0&&l(D[0],D[1])<=0}))return xt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",W.InvalidArgument);var v=!r||r.includeLowers!==!1,b=r&&r.includeUppers===!0,T,y=l;function k(D,P){return y(D[0],P[0])}try{(T=A.reduce(function(D,P){for(var I=0,M=D.length;I<M;++I){var j=D[I];if(u(P[0],j[1])<0&&0<u(P[1],j[0])){j[0]=p(j[0],P[0]),j[1]=g(j[1],P[1]);break}}return I===M&&D.push(P),D},[])).sort(k)}catch{return xt(this,Ft)}var w=0,x=b?function(D){return 0<l(D,T[w][1])}:function(D){return 0<=l(D,T[w][1])},E=v?function(D){return 0<f(D,T[w][0])}:function(D){return 0<=f(D,T[w][0])},_=x,A=new this.Collection(this,function(){return Vt(T[0][0],T[T.length-1][1],!v,!b)});return A._ondirectionchange=function(D){y=D==="next"?(_=x,l):(_=E,f),T.sort(k)},A._addAlgorithm(function(D,P,I){for(var M,j=D.key;_(j);)if(++w===T.length)return P(I),!1;return!x(M=j)&&!E(M)||(a._cmp(j,T[w][1])===0||a._cmp(j,T[w][0])===0||P(function(){y===l?D.continue(T[w][0]):D.continue(T[w][1])}),!1)}),A},ht.prototype.startsWithAnyOf=function(){var n=Rt.apply(Se,arguments);return n.every(function(r){return typeof r=="string"})?n.length===0?Pe(this):this.inAnyRange(n.map(function(r){return[r,r+ue]})):xt(this,"startsWithAnyOf() only works with strings")},ht);function ht(){}function Ct(n){return at(function(r){return Ye(r),n(r.target.error),!1})}function Ye(n){n.stopPropagation&&n.stopPropagation(),n.preventDefault&&n.preventDefault()}var Ge="storagemutated",Pr="x-storagemutated-1",zt=Ve(null,Ge),Is=(It.prototype._lock=function(){return lt(!U.global),++this._reculock,this._reculock!==1||U.global||(U.lockOwnerFor=this),this},It.prototype._unlock=function(){if(lt(!U.global),--this._reculock==0)for(U.global||(U.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var n=this._blockedFuncs.shift();try{se(n[1],n[0])}catch{}}return this},It.prototype._locked=function(){return this._reculock&&U.lockOwnerFor!==this},It.prototype.create=function(n){var r=this;if(!this.mode)return this;var a=this.db.idbdb,u=this.db._state.dbOpenError;if(lt(!this.idbtrans),!n&&!a)switch(u&&u.name){case"DatabaseClosedError":throw new W.DatabaseClosed(u);case"MissingAPIError":throw new W.MissingAPI(u.message,u);default:throw new W.OpenFailed(u)}if(!this.active)throw new W.TransactionInactive;return lt(this._completion._state===null),(n=this.idbtrans=n||(this.db.core||a).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=at(function(l){Ye(l),r._reject(n.error)}),n.onabort=at(function(l){Ye(l),r.active&&r._reject(new W.Abort(n.error)),r.active=!1,r.on("abort").fire(l)}),n.oncomplete=at(function(){r.active=!1,r._resolve(),"mutatedParts"in n&&zt.storagemutated.fire(n.mutatedParts)}),this},It.prototype._promise=function(n,r,a){var u=this;if(n==="readwrite"&&this.mode!=="readwrite")return ut(new W.ReadOnly("Transaction is readonly"));if(!this.active)return ut(new W.TransactionInactive);if(this._locked())return new B(function(f,p){u._blockedFuncs.push([function(){u._promise(n,r,a).then(f,p)},U])});if(a)return Ht(function(){var f=new B(function(p,g){u._lock();var v=r(p,g,u);v&&v.then&&v.then(p,g)});return f.finally(function(){return u._unlock()}),f._lib=!0,f});var l=new B(function(f,p){var g=r(f,p,u);g&&g.then&&g.then(f,p)});return l._lib=!0,l},It.prototype._root=function(){return this.parent?this.parent._root():this},It.prototype.waitFor=function(n){var r,a=this._root(),u=B.resolve(n);a._waitingFor?a._waitingFor=a._waitingFor.then(function(){return u}):(a._waitingFor=u,a._waitingQueue=[],r=a.idbtrans.objectStore(a.storeNames[0]),(function f(){for(++a._spinCount;a._waitingQueue.length;)a._waitingQueue.shift()();a._waitingFor&&(r.get(-1/0).onsuccess=f)})());var l=a._waitingFor;return new B(function(f,p){u.then(function(g){return a._waitingQueue.push(at(f.bind(null,g)))},function(g){return a._waitingQueue.push(at(p.bind(null,g)))}).finally(function(){a._waitingFor===l&&(a._waitingFor=null)})})},It.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new W.Abort))},It.prototype.table=function(n){var r=this._memoizedTables||(this._memoizedTables={});if(C(r,n))return r[n];var a=this.schema[n];if(!a)throw new W.NotFound("Table "+n+" not part of transaction");return a=new this.db.Table(n,a,this),a.core=this.db.core.table(n),r[n]=a},It);function It(){}function Cr(n,r,a,u,l,f,p){return{name:n,keyPath:r,unique:a,multi:u,auto:l,compound:f,src:(a&&!p?"&":"")+(u?"*":"")+(l?"++":"")+co(r)}}function co(n){return typeof n=="string"?n:n?"["+[].join.call(n,"+")+"]":""}function Ir(n,r,a){return{name:n,primKey:r,indexes:a,mappedClass:null,idxByName:(u=function(l){return[l.name,l]},a.reduce(function(l,f,p){return p=u(f,p),p&&(l[p[0]]=p[1]),l},{}))};var u}var Qe=function(n){try{return n.only([[]]),Qe=function(){return[[]]},[[]]}catch{return Qe=function(){return ue},ue}};function $r(n){return n==null?function(){}:typeof n=="string"?(r=n).split(".").length===1?function(a){return a[r]}:function(a){return wt(a,r)}:function(a){return wt(a,n)};var r}function lo(n){return[].slice.call(n)}var $s=0;function Xe(n){return n==null?":id":typeof n=="string"?n:"[".concat(n.join("+"),"]")}function Ms(n,r,v){function u(_){if(_.type===3)return null;if(_.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var w=_.lower,x=_.upper,E=_.lowerOpen,_=_.upperOpen;return w===void 0?x===void 0?null:r.upperBound(x,!!_):x===void 0?r.lowerBound(w,!!E):r.bound(w,x,!!E,!!_)}function l(k){var w,x=k.name;return{name:x,schema:k,mutate:function(E){var _=E.trans,A=E.type,D=E.keys,P=E.values,I=E.range;return new Promise(function(M,j){M=at(M);var R=_.objectStore(x),F=R.keyPath==null,N=A==="put"||A==="add";if(!N&&A!=="delete"&&A!=="deleteRange")throw new Error("Invalid operation type: "+A);var L,q=(D||P||{length:1}).length;if(D&&P&&D.length!==P.length)throw new Error("Given keys array must have same length as given values array.");if(q===0)return M({numFailures:0,failures:{},results:[],lastResult:void 0});function J(bt){++Tt,Ye(bt)}var G=[],Q=[],Tt=0;if(A==="deleteRange"){if(I.type===4)return M({numFailures:Tt,failures:Q,results:[],lastResult:void 0});I.type===3?G.push(L=R.clear()):G.push(L=R.delete(u(I)))}else{var F=N?F?[P,D]:[P,null]:[D,null],z=F[0],yt=F[1];if(N)for(var vt=0;vt<q;++vt)G.push(L=yt&&yt[vt]!==void 0?R[A](z[vt],yt[vt]):R[A](z[vt])),L.onerror=J;else for(vt=0;vt<q;++vt)G.push(L=R[A](z[vt])),L.onerror=J}function Hn(bt){bt=bt.target.result,G.forEach(function(fe,Qr){return fe.error!=null&&(Q[Qr]=fe.error)}),M({numFailures:Tt,failures:Q,results:A==="delete"?D:G.map(function(fe){return fe.result}),lastResult:bt})}L.onerror=function(bt){J(bt),Hn(bt)},L.onsuccess=Hn})},getMany:function(E){var _=E.trans,A=E.keys;return new Promise(function(D,P){D=at(D);for(var I,M=_.objectStore(x),j=A.length,R=new Array(j),F=0,N=0,L=function(G){G=G.target,R[G._pos]=G.result,++N===F&&D(R)},q=Ct(P),J=0;J<j;++J)A[J]!=null&&((I=M.get(A[J]))._pos=J,I.onsuccess=L,I.onerror=q,++F);F===0&&D(R)})},get:function(E){var _=E.trans,A=E.key;return new Promise(function(D,P){D=at(D);var I=_.objectStore(x).get(A);I.onsuccess=function(M){return D(M.target.result)},I.onerror=Ct(P)})},query:(w=b,function(E){return new Promise(function(_,A){_=at(_);var D,P,I,F=E.trans,M=E.values,j=E.limit,L=E.query,R=j===1/0?void 0:j,N=L.index,L=L.range,F=F.objectStore(x),N=N.isPrimaryKey?F:F.index(N.name),L=u(L);if(j===0)return _({result:[]});w?((R=M?N.getAll(L,R):N.getAllKeys(L,R)).onsuccess=function(q){return _({result:q.target.result})},R.onerror=Ct(A)):(D=0,P=!M&&"openKeyCursor"in N?N.openKeyCursor(L):N.openCursor(L),I=[],P.onsuccess=function(q){var J=P.result;return J?(I.push(M?J.value:J.primaryKey),++D===j?_({result:I}):void J.continue()):_({result:I})},P.onerror=Ct(A))})}),openCursor:function(E){var _=E.trans,A=E.values,D=E.query,P=E.reverse,I=E.unique;return new Promise(function(M,j){M=at(M);var N=D.index,R=D.range,F=_.objectStore(x),F=N.isPrimaryKey?F:F.index(N.name),N=P?I?"prevunique":"prev":I?"nextunique":"next",L=!A&&"openKeyCursor"in F?F.openKeyCursor(u(R),N):F.openCursor(u(R),N);L.onerror=Ct(j),L.onsuccess=at(function(q){var J,G,Q,Tt,z=L.result;z?(z.___id=++$s,z.done=!1,J=z.continue.bind(z),G=(G=z.continuePrimaryKey)&&G.bind(z),Q=z.advance.bind(z),Tt=function(){throw new Error("Cursor not stopped")},z.trans=_,z.stop=z.continue=z.continuePrimaryKey=z.advance=function(){throw new Error("Cursor not started")},z.fail=at(j),z.next=function(){var yt=this,vt=1;return this.start(function(){return vt--?yt.continue():yt.stop()}).then(function(){return yt})},z.start=function(yt){function vt(){if(L.result)try{yt()}catch(bt){z.fail(bt)}else z.done=!0,z.start=function(){throw new Error("Cursor behind last entry")},z.stop()}var Hn=new Promise(function(bt,fe){bt=at(bt),L.onerror=Ct(fe),z.fail=fe,z.stop=function(Qr){z.stop=z.continue=z.continuePrimaryKey=z.advance=Tt,bt(Qr)}});return L.onsuccess=at(function(bt){L.onsuccess=vt,vt()}),z.continue=J,z.continuePrimaryKey=G,z.advance=Q,vt(),Hn},M(z)):M(null)},j)})},count:function(E){var _=E.query,A=E.trans,D=_.index,P=_.range;return new Promise(function(I,M){var j=A.objectStore(x),R=D.isPrimaryKey?j:j.index(D.name),j=u(P),R=j?R.count(j):R.count();R.onsuccess=at(function(F){return I(F.target.result)}),R.onerror=Ct(M)})}}}var f,p,g,T=(p=v,g=lo((f=n).objectStoreNames),{schema:{name:f.name,tables:g.map(function(k){return p.objectStore(k)}).map(function(k){var w=k.keyPath,_=k.autoIncrement,x=h(w),E={},_={name:k.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:w==null,compound:x,keyPath:w,autoIncrement:_,unique:!0,extractKey:$r(w)},indexes:lo(k.indexNames).map(function(A){return k.index(A)}).map(function(I){var D=I.name,P=I.unique,M=I.multiEntry,I=I.keyPath,M={name:D,compound:h(I),keyPath:I,unique:P,multiEntry:M,extractKey:$r(I)};return E[Xe(I)]=M}),getIndexByKeyPath:function(A){return E[Xe(A)]}};return E[":id"]=_.primaryKey,w!=null&&(E[Xe(w)]=_.primaryKey),_})},hasGetAll:0<g.length&&"getAll"in p.objectStore(g[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),v=T.schema,b=T.hasGetAll,T=v.tables.map(l),y={};return T.forEach(function(k){return y[k.name]=k}),{stack:"dbcore",transaction:n.transaction.bind(n),table:function(k){if(!y[k])throw new Error("Table '".concat(k,"' not found"));return y[k]},MIN_KEY:-1/0,MAX_KEY:Qe(r),schema:v}}function Rs(n,r,a,u){var l=a.IDBKeyRange;return a.indexedDB,{dbcore:(u=Ms(r,l,u),n.dbcore.reduce(function(f,p){return p=p.create,o(o({},f),p(f))},u))}}function Cn(n,u){var a=u.db,u=Rs(n._middlewares,a,n._deps,u);n.core=u.dbcore,n.tables.forEach(function(l){var f=l.name;n.core.schema.tables.some(function(p){return p.name===f})&&(l.core=n.core.table(f),n[f]instanceof n.Table&&(n[f].core=l.core))})}function In(n,r,a,u){a.forEach(function(l){var f=u[l];r.forEach(function(p){var g=(function v(b,T){return H(b,T)||(b=S(b))&&v(b,T)})(p,l);(!g||"value"in g&&g.value===void 0)&&(p===n.Transaction.prototype||p instanceof n.Transaction?V(p,l,{get:function(){return this.table(l)},set:function(v){K(this,l,{value:v,writable:!0,configurable:!0,enumerable:!0})}}):p[l]=new n.Table(l,f))})})}function Mr(n,r){r.forEach(function(a){for(var u in a)a[u]instanceof n.Table&&delete a[u]})}function Fs(n,r){return n._cfg.version-r._cfg.version}function Ls(n,r,a,u){var l=n._dbSchema;a.objectStoreNames.contains("$meta")&&!l.$meta&&(l.$meta=Ir("$meta",ho("")[0],[]),n._storeNames.push("$meta"));var f=n._createTransaction("readwrite",n._storeNames,l);f.create(a),f._completion.catch(u);var p=f._reject.bind(f),g=U.transless||U;Ht(function(){return U.trans=f,U.transless=g,r!==0?(Cn(n,a),b=r,((v=f).storeNames.includes("$meta")?v.table("$meta").get("version").then(function(T){return T??b}):B.resolve(b)).then(function(T){return k=T,w=f,x=a,E=[],T=(y=n)._versions,_=y._dbSchema=Mn(0,y.idbdb,x),(T=T.filter(function(A){return A._cfg.version>=k})).length!==0?(T.forEach(function(A){E.push(function(){var D=_,P=A._cfg.dbschema;Rn(y,D,x),Rn(y,P,x),_=y._dbSchema=P;var I=Rr(D,P);I.add.forEach(function(N){Fr(x,N[0],N[1].primKey,N[1].indexes)}),I.change.forEach(function(N){if(N.recreate)throw new W.Upgrade("Not yet support for changing primary key");var L=x.objectStore(N.name);N.add.forEach(function(q){return $n(L,q)}),N.change.forEach(function(q){L.deleteIndex(q.name),$n(L,q)}),N.del.forEach(function(q){return L.deleteIndex(q)})});var M=A._cfg.contentUpgrade;if(M&&A._cfg.version>k){Cn(y,x),w._memoizedTables={};var j=pn(P);I.del.forEach(function(N){j[N]=D[N]}),Mr(y,[y.Transaction.prototype]),In(y,[y.Transaction.prototype],d(j),j),w.schema=j;var R,F=pr(M);return F&&Ae(),I=B.follow(function(){var N;(R=M(w))&&F&&(N=Ut.bind(null,null),R.then(N,N))}),R&&typeof R.then=="function"?B.resolve(R):I.then(function(){return R})}}),E.push(function(D){var P,I,M=A._cfg.dbschema;P=M,I=D,[].slice.call(I.db.objectStoreNames).forEach(function(j){return P[j]==null&&I.db.deleteObjectStore(j)}),Mr(y,[y.Transaction.prototype]),In(y,[y.Transaction.prototype],y._storeNames,y._dbSchema),w.schema=y._dbSchema}),E.push(function(D){y.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(y.idbdb.version/10)===A._cfg.version?(y.idbdb.deleteObjectStore("$meta"),delete y._dbSchema.$meta,y._storeNames=y._storeNames.filter(function(P){return P!=="$meta"})):D.objectStore("$meta").put(A._cfg.version,"version"))})}),(function A(){return E.length?B.resolve(E.shift()(w.idbtrans)).then(A):B.resolve()})().then(function(){fo(_,x)})):B.resolve();var y,k,w,x,E,_}).catch(p)):(d(l).forEach(function(T){Fr(a,T,l[T].primKey,l[T].indexes)}),Cn(n,a),void B.follow(function(){return n.on.populate.fire(f)}).catch(p));var v,b})}function js(n,r){fo(n._dbSchema,r),r.db.version%10!=0||r.objectStoreNames.contains("$meta")||r.db.createObjectStore("$meta").add(Math.ceil(r.db.version/10-1),"version");var a=Mn(0,n.idbdb,r);Rn(n,n._dbSchema,r);for(var u=0,l=Rr(a,n._dbSchema).change;u<l.length;u++){var f=(function(p){if(p.change.length||p.recreate)return console.warn("Unable to patch indexes of table ".concat(p.name," because it has changes on the type of index or primary key.")),{value:void 0};var g=r.objectStore(p.name);p.add.forEach(function(v){Pt&&console.debug("Dexie upgrade patch: Creating missing index ".concat(p.name,".").concat(v.src)),$n(g,v)})})(l[u]);if(typeof f=="object")return f.value}}function Rr(n,r){var a,u={del:[],add:[],change:[]};for(a in n)r[a]||u.del.push(a);for(a in r){var l=n[a],f=r[a];if(l){var p={name:a,def:f,recreate:!1,del:[],add:[],change:[]};if(""+(l.primKey.keyPath||"")!=""+(f.primKey.keyPath||"")||l.primKey.auto!==f.primKey.auto)p.recreate=!0,u.change.push(p);else{var g=l.idxByName,v=f.idxByName,b=void 0;for(b in g)v[b]||p.del.push(b);for(b in v){var T=g[b],y=v[b];T?T.src!==y.src&&p.change.push(y):p.add.push(y)}(0<p.del.length||0<p.add.length||0<p.change.length)&&u.change.push(p)}}else u.add.push([a,f])}return u}function Fr(n,r,a,u){var l=n.db.createObjectStore(r,a.keyPath?{keyPath:a.keyPath,autoIncrement:a.auto}:{autoIncrement:a.auto});return u.forEach(function(f){return $n(l,f)}),l}function fo(n,r){d(n).forEach(function(a){r.db.objectStoreNames.contains(a)||(Pt&&console.debug("Dexie: Creating missing table",a),Fr(r,a,n[a].primKey,n[a].indexes))})}function $n(n,r){n.createIndex(r.name,r.keyPath,{unique:r.unique,multiEntry:r.multi})}function Mn(n,r,a){var u={};return Z(r.objectStoreNames,0).forEach(function(l){for(var f=a.objectStore(l),p=Cr(co(b=f.keyPath),b||"",!0,!1,!!f.autoIncrement,b&&typeof b!="string",!0),g=[],v=0;v<f.indexNames.length;++v){var T=f.index(f.indexNames[v]),b=T.keyPath,T=Cr(T.name,b,!!T.unique,!!T.multiEntry,!1,b&&typeof b!="string",!1);g.push(T)}u[l]=Ir(l,p,g)}),u}function Rn(n,r,a){for(var u=a.db.objectStoreNames,l=0;l<u.length;++l){var f=u[l],p=a.objectStore(f);n._hasGetAll="getAll"in p;for(var g=0;g<p.indexNames.length;++g){var v=p.indexNames[g],b=p.index(v).keyPath,T=typeof b=="string"?b:"["+Z(b).join("+")+"]";!r[f]||(b=r[f].idxByName[T])&&(b.name=v,delete r[f].idxByName[T],r[f].idxByName[v]=b)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&c.WorkerGlobalScope&&c instanceof c.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(n._hasGetAll=!1)}function ho(n){return n.split(",").map(function(r,a){var u=(r=r.trim()).replace(/([&*]|\+\+)/g,""),l=/^\[/.test(u)?u.match(/^\[(.*)\]$/)[1].split("+"):u;return Cr(u,l||null,/\&/.test(r),/\*/.test(r),/\+\+/.test(r),h(l),a===0)})}var Ns=(Fn.prototype._parseStoresSpec=function(n,r){d(n).forEach(function(a){if(n[a]!==null){var u=ho(n[a]),l=u.shift();if(l.unique=!0,l.multi)throw new W.Schema("Primary key cannot be multi-valued");u.forEach(function(f){if(f.auto)throw new W.Schema("Only primary key can be marked as autoIncrement (++)");if(!f.keyPath)throw new W.Schema("Index must have a name and cannot be an empty string")}),r[a]=Ir(a,l,u)}})},Fn.prototype.stores=function(a){var r=this.db;this._cfg.storesSource=this._cfg.storesSource?m(this._cfg.storesSource,a):a;var a=r._versions,u={},l={};return a.forEach(function(f){m(u,f._cfg.storesSource),l=f._cfg.dbschema={},f._parseStoresSpec(u,l)}),r._dbSchema=l,Mr(r,[r._allTables,r,r.Transaction.prototype]),In(r,[r._allTables,r,r.Transaction.prototype,this._cfg.tables],d(l),l),r._storeNames=d(l),this},Fn.prototype.upgrade=function(n){return this._cfg.contentUpgrade=mr(this._cfg.contentUpgrade||nt,n),this},Fn);function Fn(){}function Lr(n,r){var a=n._dbNamesDB;return a||(a=n._dbNamesDB=new Lt(kn,{addons:[],indexedDB:n,IDBKeyRange:r})).version(1).stores({dbnames:"name"}),a.table("dbnames")}function jr(n){return n&&typeof n.databases=="function"}function Nr(n){return Ht(function(){return U.letThrough=!0,n()})}function Br(n){return!("from"in n)}var mt=function(n,r){if(!this){var a=new mt;return n&&"d"in n&&m(a,n),a}m(this,arguments.length?{d:1,from:n,to:1<arguments.length?r:n}:{d:0})};function Ze(n,r,a){var u=X(r,a);if(!isNaN(u)){if(0<u)throw RangeError();if(Br(n))return m(n,{from:r,to:a,d:1});var l=n.l,u=n.r;if(X(a,n.from)<0)return l?Ze(l,r,a):n.l={from:r,to:a,d:1,l:null,r:null},go(n);if(0<X(r,n.to))return u?Ze(u,r,a):n.r={from:r,to:a,d:1,l:null,r:null},go(n);X(r,n.from)<0&&(n.from=r,n.l=null,n.d=u?u.d+1:1),0<X(a,n.to)&&(n.to=a,n.r=null,n.d=n.l?n.l.d+1:1),a=!n.r,l&&!n.l&&tn(n,l),u&&a&&tn(n,u)}}function tn(n,r){Br(r)||(function a(u,v){var f=v.from,p=v.to,g=v.l,v=v.r;Ze(u,f,p),g&&a(u,g),v&&a(u,v)})(n,r)}function po(n,r){var a=Ln(r),u=a.next();if(u.done)return!1;for(var l=u.value,f=Ln(n),p=f.next(l.from),g=p.value;!u.done&&!p.done;){if(X(g.from,l.to)<=0&&0<=X(g.to,l.from))return!0;X(l.from,g.from)<0?l=(u=a.next(g.from)).value:g=(p=f.next(l.from)).value}return!1}function Ln(n){var r=Br(n)?null:{s:0,n};return{next:function(a){for(var u=0<arguments.length;r;)switch(r.s){case 0:if(r.s=1,u)for(;r.n.l&&X(a,r.n.from)<0;)r={up:r,n:r.n.l,s:1};else for(;r.n.l;)r={up:r,n:r.n.l,s:1};case 1:if(r.s=2,!u||X(a,r.n.to)<=0)return{value:r.n,done:!1};case 2:if(r.n.r){r.s=3,r={up:r,n:r.n.r,s:0};continue}case 3:r=r.up}return{done:!0}}}}function go(n){var r,a,u=(((r=n.r)===null||r===void 0?void 0:r.d)||0)-(((a=n.l)===null||a===void 0?void 0:a.d)||0),l=1<u?"r":u<-1?"l":"";l&&(r=l=="r"?"l":"r",a=o({},n),u=n[l],n.from=u.from,n.to=u.to,n[l]=u[l],a[l]=u[r],(n[r]=a).d=mo(a)),n.d=mo(n)}function mo(a){var r=a.r,a=a.l;return(r?a?Math.max(r.d,a.d):r.d:a?a.d:0)+1}function jn(n,r){return d(r).forEach(function(a){n[a]?tn(n[a],r[a]):n[a]=(function u(l){var f,p,g={};for(f in l)C(l,f)&&(p=l[f],g[f]=!p||typeof p!="object"||Hi.has(p.constructor)?p:u(p));return g})(r[a])}),n}function Kr(n,r){return n.all||r.all||Object.keys(n).some(function(a){return r[a]&&po(r[a],n[a])})}$(mt.prototype,((Et={add:function(n){return tn(this,n),this},addKey:function(n){return Ze(this,n,n),this},addKeys:function(n){var r=this;return n.forEach(function(a){return Ze(r,a,a)}),this},hasKey:function(n){var r=Ln(this).next(n).value;return r&&X(r.from,n)<=0&&0<=X(r.to,n)}})[hr]=function(){return Ln(this)},Et));var le={},qr={},Hr=!1;function Nn(n){jn(qr,n),Hr||(Hr=!0,setTimeout(function(){Hr=!1,Ur(qr,!(qr={}))},0))}function Ur(n,r){r===void 0&&(r=!1);var a=new Set;if(n.all)for(var u=0,l=Object.values(le);u<l.length;u++)yo(p=l[u],n,a,r);else for(var f in n){var p,g=/^idb\:\/\/(.*)\/(.*)\//.exec(f);g&&(f=g[1],g=g[2],(p=le["idb://".concat(f,"/").concat(g)])&&yo(p,n,a,r))}a.forEach(function(v){return v()})}function yo(n,r,a,u){for(var l=[],f=0,p=Object.entries(n.queries.query);f<p.length;f++){for(var g=p[f],v=g[0],b=[],T=0,y=g[1];T<y.length;T++){var k=y[T];Kr(r,k.obsSet)?k.subscribers.forEach(function(_){return a.add(_)}):u&&b.push(k)}u&&l.push([v,b])}if(u)for(var w=0,x=l;w<x.length;w++){var E=x[w],v=E[0],b=E[1];n.queries.query[v]=b}}function Bs(n){var r=n._state,a=n._deps.indexedDB;if(r.isBeingOpened||n.idbdb)return r.dbReadyPromise.then(function(){return r.dbOpenError?ut(r.dbOpenError):n});r.isBeingOpened=!0,r.dbOpenError=null,r.openComplete=!1;var u=r.openCanceller,l=Math.round(10*n.verno),f=!1;function p(){if(r.openCanceller!==u)throw new W.DatabaseClosed("db.open() was cancelled")}function g(){return new B(function(k,w){if(p(),!a)throw new W.MissingAPI;var x=n.name,E=r.autoSchema||!l?a.open(x):a.open(x,l);if(!E)throw new W.MissingAPI;E.onerror=Ct(w),E.onblocked=at(n._fireOnBlocked),E.onupgradeneeded=at(function(_){var A;T=E.transaction,r.autoSchema&&!n._options.allowEmptyDB?(E.onerror=Ye,T.abort(),E.result.close(),(A=a.deleteDatabase(x)).onsuccess=A.onerror=at(function(){w(new W.NoSuchDatabase("Database ".concat(x," doesnt exist")))})):(T.onerror=Ct(w),_=_.oldVersion>Math.pow(2,62)?0:_.oldVersion,y=_<1,n.idbdb=E.result,f&&js(n,T),Ls(n,_/10,T,w))},w),E.onsuccess=at(function(){T=null;var _,A,D,P,I,M=n.idbdb=E.result,j=Z(M.objectStoreNames);if(0<j.length)try{var R=M.transaction((P=j).length===1?P[0]:P,"readonly");if(r.autoSchema)A=M,D=R,(_=n).verno=A.version/10,D=_._dbSchema=Mn(0,A,D),_._storeNames=Z(A.objectStoreNames,0),In(_,[_._allTables],d(D),D);else if(Rn(n,n._dbSchema,R),((I=Rr(Mn(0,(I=n).idbdb,R),I._dbSchema)).add.length||I.change.some(function(F){return F.add.length||F.change.length}))&&!f)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),M.close(),l=M.version+1,f=!0,k(g());Cn(n,R)}catch{}De.push(n),M.onversionchange=at(function(F){r.vcFired=!0,n.on("versionchange").fire(F)}),M.onclose=at(function(F){n.on("close").fire(F)}),y&&(I=n._deps,R=x,M=I.indexedDB,I=I.IDBKeyRange,jr(M)||R===kn||Lr(M,I).put({name:R}).catch(nt)),k()},w)}).catch(function(k){switch(k?.name){case"UnknownError":if(0<r.PR1398_maxLoop)return r.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),g();break;case"VersionError":if(0<l)return l=0,g()}return B.reject(k)})}var v,b=r.dbReadyResolve,T=null,y=!1;return B.race([u,(typeof navigator>"u"?B.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(k){function w(){return indexedDB.databases().finally(k)}v=setInterval(w,100),w()}).finally(function(){return clearInterval(v)}):Promise.resolve()).then(g)]).then(function(){return p(),r.onReadyBeingFired=[],B.resolve(Nr(function(){return n.on.ready.fire(n.vip)})).then(function k(){if(0<r.onReadyBeingFired.length){var w=r.onReadyBeingFired.reduce(mr,nt);return r.onReadyBeingFired=[],B.resolve(Nr(function(){return w(n.vip)})).then(k)}})}).finally(function(){r.openCanceller===u&&(r.onReadyBeingFired=null,r.isBeingOpened=!1)}).catch(function(k){r.dbOpenError=k;try{T&&T.abort()}catch{}return u===r.openCanceller&&n._close(),ut(k)}).finally(function(){r.openComplete=!0,b()}).then(function(){var k;return y&&(k={},n.tables.forEach(function(w){w.schema.indexes.forEach(function(x){x.name&&(k["idb://".concat(n.name,"/").concat(w.name,"/").concat(x.name)]=new mt(-1/0,[[[]]]))}),k["idb://".concat(n.name,"/").concat(w.name,"/")]=k["idb://".concat(n.name,"/").concat(w.name,"/:dels")]=new mt(-1/0,[[[]]])}),zt(Ge).fire(k),Ur(k,!0)),n})}function Wr(n){function r(f){return n.next(f)}var a=l(r),u=l(function(f){return n.throw(f)});function l(f){return function(v){var g=f(v),v=g.value;return g.done?v:v&&typeof v.then=="function"?v.then(a,u):h(v)?Promise.all(v).then(a,u):a(v)}}return l(r)()}function Bn(n,r,a){for(var u=h(n)?n.slice():[n],l=0;l<a;++l)u.push(r);return u}var Ks={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(n){return o(o({},n),{table:function(r){var a=n.table(r),u=a.schema,l={},f=[];function p(y,k,w){var x=Xe(y),E=l[x]=l[x]||[],_=y==null?0:typeof y=="string"?1:y.length,A=0<k,A=o(o({},w),{name:A?"".concat(x,"(virtual-from:").concat(w.name,")"):w.name,lowLevelIndex:w,isVirtual:A,keyTail:k,keyLength:_,extractKey:$r(y),unique:!A&&w.unique});return E.push(A),A.isPrimaryKey||f.push(A),1<_&&p(_===2?y[0]:y.slice(0,_-1),k+1,w),E.sort(function(D,P){return D.keyTail-P.keyTail}),A}r=p(u.primaryKey.keyPath,0,u.primaryKey),l[":id"]=[r];for(var g=0,v=u.indexes;g<v.length;g++){var b=v[g];p(b.keyPath,0,b)}function T(y){var k,w=y.query.index;return w.isVirtual?o(o({},y),{query:{index:w.lowLevelIndex,range:(k=y.query.range,w=w.keyTail,{type:k.type===1?2:k.type,lower:Bn(k.lower,k.lowerOpen?n.MAX_KEY:n.MIN_KEY,w),lowerOpen:!0,upper:Bn(k.upper,k.upperOpen?n.MIN_KEY:n.MAX_KEY,w),upperOpen:!0})}}):y}return o(o({},a),{schema:o(o({},u),{primaryKey:r,indexes:f,getIndexByKeyPath:function(y){return(y=l[Xe(y)])&&y[0]}}),count:function(y){return a.count(T(y))},query:function(y){return a.query(T(y))},openCursor:function(y){var k=y.query.index,w=k.keyTail,x=k.isVirtual,E=k.keyLength;return x?a.openCursor(T(y)).then(function(A){return A&&_(A)}):a.openCursor(y);function _(A){return Object.create(A,{continue:{value:function(D){D!=null?A.continue(Bn(D,y.reverse?n.MAX_KEY:n.MIN_KEY,w)):y.unique?A.continue(A.key.slice(0,E).concat(y.reverse?n.MIN_KEY:n.MAX_KEY,w)):A.continue()}},continuePrimaryKey:{value:function(D,P){A.continuePrimaryKey(Bn(D,n.MAX_KEY,w),P)}},primaryKey:{get:function(){return A.primaryKey}},key:{get:function(){var D=A.key;return E===1?D[0]:D.slice(0,E)}},value:{get:function(){return A.value}}})}}})}})}};function Vr(n,r,a,u){return a=a||{},u=u||"",d(n).forEach(function(l){var f,p,g;C(r,l)?(f=n[l],p=r[l],typeof f=="object"&&typeof p=="object"&&f&&p?(g=fr(f))!==fr(p)?a[u+l]=r[l]:g==="Object"?Vr(f,p,a,u+l+"."):f!==p&&(a[u+l]=r[l]):f!==p&&(a[u+l]=r[l])):a[u+l]=void 0}),d(r).forEach(function(l){C(n,l)||(a[u+l]=r[l])}),a}function zr(n,r){return r.type==="delete"?r.keys:r.keys||r.values.map(n.extractKey)}var qs={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(n){return o(o({},n),{table:function(r){var a=n.table(r),u=a.schema.primaryKey;return o(o({},a),{mutate:function(l){var f=U.trans,p=f.table(r).hook,g=p.deleting,v=p.creating,b=p.updating;switch(l.type){case"add":if(v.fire===nt)break;return f._promise("readwrite",function(){return T(l)},!0);case"put":if(v.fire===nt&&b.fire===nt)break;return f._promise("readwrite",function(){return T(l)},!0);case"delete":if(g.fire===nt)break;return f._promise("readwrite",function(){return T(l)},!0);case"deleteRange":if(g.fire===nt)break;return f._promise("readwrite",function(){return(function y(k,w,x){return a.query({trans:k,values:!1,query:{index:u,range:w},limit:x}).then(function(E){var _=E.result;return T({type:"delete",keys:_,trans:k}).then(function(A){return 0<A.numFailures?Promise.reject(A.failures[0]):_.length<x?{failures:[],numFailures:0,lastResult:void 0}:y(k,o(o({},w),{lower:_[_.length-1],lowerOpen:!0}),x)})})})(l.trans,l.range,1e4)},!0)}return a.mutate(l);function T(y){var k,w,x,E=U.trans,_=y.keys||zr(u,y);if(!_)throw new Error("Keys missing");return(y=y.type==="add"||y.type==="put"?o(o({},y),{keys:_}):o({},y)).type!=="delete"&&(y.values=s([],y.values)),y.keys&&(y.keys=s([],y.keys)),k=a,x=_,((w=y).type==="add"?Promise.resolve([]):k.getMany({trans:w.trans,keys:x,cache:"immutable"})).then(function(A){var D=_.map(function(P,I){var M,j,R,F=A[I],N={onerror:null,onsuccess:null};return y.type==="delete"?g.fire.call(N,P,F,E):y.type==="add"||F===void 0?(M=v.fire.call(N,P,y.values[I],E),P==null&&M!=null&&(y.keys[I]=P=M,u.outbound||gt(y.values[I],u.keyPath,P))):(M=Vr(F,y.values[I]),(j=b.fire.call(N,M,P,F,E))&&(R=y.values[I],Object.keys(j).forEach(function(L){C(R,L)?R[L]=j[L]:gt(R,L,j[L])}))),N});return a.mutate(y).then(function(P){for(var I=P.failures,M=P.results,j=P.numFailures,P=P.lastResult,R=0;R<_.length;++R){var F=(M||_)[R],N=D[R];F==null?N.onerror&&N.onerror(I[R]):N.onsuccess&&N.onsuccess(y.type==="put"&&A[R]?y.values[R]:F)}return{failures:I,results:M,numFailures:j,lastResult:P}}).catch(function(P){return D.forEach(function(I){return I.onerror&&I.onerror(P)}),Promise.reject(P)})})}}})}})}};function vo(n,r,a){try{if(!r||r.keys.length<n.length)return null;for(var u=[],l=0,f=0;l<r.keys.length&&f<n.length;++l)X(r.keys[l],n[f])===0&&(u.push(a?te(r.values[l]):r.values[l]),++f);return u.length===n.length?u:null}catch{return null}}var Hs={stack:"dbcore",level:-1,create:function(n){return{table:function(r){var a=n.table(r);return o(o({},a),{getMany:function(u){if(!u.cache)return a.getMany(u);var l=vo(u.keys,u.trans._cache,u.cache==="clone");return l?B.resolve(l):a.getMany(u).then(function(f){return u.trans._cache={keys:u.keys,values:u.cache==="clone"?te(f):f},f})},mutate:function(u){return u.type!=="add"&&(u.trans._cache=null),a.mutate(u)}})}}}};function wo(n,r){return n.trans.mode==="readonly"&&!!n.subscr&&!n.trans.explicit&&n.trans.db._options.cache!=="disabled"&&!r.schema.primaryKey.outbound}function bo(n,r){switch(n){case"query":return r.values&&!r.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Us={stack:"dbcore",level:0,name:"Observability",create:function(n){var r=n.schema.name,a=new mt(n.MIN_KEY,n.MAX_KEY);return o(o({},n),{transaction:function(u,l,f){if(U.subscr&&l!=="readonly")throw new W.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(U.querier));return n.transaction(u,l,f)},table:function(u){var l=n.table(u),f=l.schema,p=f.primaryKey,y=f.indexes,g=p.extractKey,v=p.outbound,b=p.autoIncrement&&y.filter(function(w){return w.compound&&w.keyPath.includes(p.keyPath)}),T=o(o({},l),{mutate:function(w){function x(L){return L="idb://".concat(r,"/").concat(u,"/").concat(L),P[L]||(P[L]=new mt)}var E,_,A,D=w.trans,P=w.mutatedParts||(w.mutatedParts={}),I=x(""),M=x(":dels"),j=w.type,N=w.type==="deleteRange"?[w.range]:w.type==="delete"?[w.keys]:w.values.length<50?[zr(p,w).filter(function(L){return L}),w.values]:[],R=N[0],F=N[1],N=w.trans._cache;return h(R)?(I.addKeys(R),(N=j==="delete"||R.length===F.length?vo(R,N):null)||M.addKeys(R),(N||F)&&(E=x,_=N,A=F,f.indexes.forEach(function(L){var q=E(L.name||"");function J(Q){return Q!=null?L.extractKey(Q):null}function G(Q){return L.multiEntry&&h(Q)?Q.forEach(function(Tt){return q.addKey(Tt)}):q.addKey(Q)}(_||A).forEach(function(Q,yt){var z=_&&J(_[yt]),yt=A&&J(A[yt]);X(z,yt)!==0&&(z!=null&&G(z),yt!=null&&G(yt))})}))):R?(F={from:(F=R.lower)!==null&&F!==void 0?F:n.MIN_KEY,to:(F=R.upper)!==null&&F!==void 0?F:n.MAX_KEY},M.add(F),I.add(F)):(I.add(a),M.add(a),f.indexes.forEach(function(L){return x(L.name).add(a)})),l.mutate(w).then(function(L){return!R||w.type!=="add"&&w.type!=="put"||(I.addKeys(L.results),b&&b.forEach(function(q){for(var J=w.values.map(function(z){return q.extractKey(z)}),G=q.keyPath.findIndex(function(z){return z===p.keyPath}),Q=0,Tt=L.results.length;Q<Tt;++Q)J[Q][G]=L.results[Q];x(q.name).addKeys(J)})),D.mutatedParts=jn(D.mutatedParts||{},P),L})}}),y=function(x){var E=x.query,x=E.index,E=E.range;return[x,new mt((x=E.lower)!==null&&x!==void 0?x:n.MIN_KEY,(E=E.upper)!==null&&E!==void 0?E:n.MAX_KEY)]},k={get:function(w){return[p,new mt(w.key)]},getMany:function(w){return[p,new mt().addKeys(w.keys)]},count:y,query:y,openCursor:y};return d(k).forEach(function(w){T[w]=function(x){var E=U.subscr,_=!!E,A=wo(U,l)&&bo(w,x)?x.obsSet={}:E;if(_){var D=function(F){return F="idb://".concat(r,"/").concat(u,"/").concat(F),A[F]||(A[F]=new mt)},P=D(""),I=D(":dels"),E=k[w](x),_=E[0],E=E[1];if((w==="query"&&_.isPrimaryKey&&!x.values?I:D(_.name||"")).add(E),!_.isPrimaryKey){if(w!=="count"){var M=w==="query"&&v&&x.values&&l.query(o(o({},x),{values:!1}));return l[w].apply(this,arguments).then(function(F){if(w==="query"){if(v&&x.values)return M.then(function(J){return J=J.result,P.addKeys(J),F});var N=x.values?F.result.map(g):F.result;(x.values?P:I).addKeys(N)}else if(w==="openCursor"){var L=F,q=x.values;return L&&Object.create(L,{key:{get:function(){return I.addKey(L.primaryKey),L.key}},primaryKey:{get:function(){var J=L.primaryKey;return I.addKey(J),J}},value:{get:function(){return q&&P.addKey(L.primaryKey),L.value}}})}return F})}I.add(a)}}return l[w].apply(this,arguments)}}),T}})}};function _o(n,r,a){if(a.numFailures===0)return r;if(r.type==="deleteRange")return null;var u=r.keys?r.keys.length:"values"in r&&r.values?r.values.length:1;return a.numFailures===u?null:(r=o({},r),h(r.keys)&&(r.keys=r.keys.filter(function(l,f){return!(f in a.failures)})),"values"in r&&h(r.values)&&(r.values=r.values.filter(function(l,f){return!(f in a.failures)})),r)}function Jr(n,r){return a=n,((u=r).lower===void 0||(u.lowerOpen?0<X(a,u.lower):0<=X(a,u.lower)))&&(n=n,(r=r).upper===void 0||(r.upperOpen?X(n,r.upper)<0:X(n,r.upper)<=0));var a,u}function So(n,r,k,u,l,f){if(!k||k.length===0)return n;var p=r.query.index,g=p.multiEntry,v=r.query.range,b=u.schema.primaryKey.extractKey,T=p.extractKey,y=(p.lowLevelIndex||p).extractKey,k=k.reduce(function(w,x){var E=w,_=[];if(x.type==="add"||x.type==="put")for(var A=new mt,D=x.values.length-1;0<=D;--D){var P,I=x.values[D],M=b(I);A.hasKey(M)||(P=T(I),(g&&h(P)?P.some(function(L){return Jr(L,v)}):Jr(P,v))&&(A.addKey(M),_.push(I)))}switch(x.type){case"add":var j=new mt().addKeys(r.values?w.map(function(q){return b(q)}):w),E=w.concat(r.values?_.filter(function(q){return q=b(q),!j.hasKey(q)&&(j.addKey(q),!0)}):_.map(function(q){return b(q)}).filter(function(q){return!j.hasKey(q)&&(j.addKey(q),!0)}));break;case"put":var R=new mt().addKeys(x.values.map(function(q){return b(q)}));E=w.filter(function(q){return!R.hasKey(r.values?b(q):q)}).concat(r.values?_:_.map(function(q){return b(q)}));break;case"delete":var F=new mt().addKeys(x.keys);E=w.filter(function(q){return!F.hasKey(r.values?b(q):q)});break;case"deleteRange":var N=x.range;E=w.filter(function(q){return!Jr(b(q),N)})}return E},n);return k===n?n:(k.sort(function(w,x){return X(y(w),y(x))||X(b(w),b(x))}),r.limit&&r.limit<1/0&&(k.length>r.limit?k.length=r.limit:n.length===r.limit&&k.length<r.limit&&(l.dirty=!0)),f?Object.freeze(k):k)}function xo(n,r){return X(n.lower,r.lower)===0&&X(n.upper,r.upper)===0&&!!n.lowerOpen==!!r.lowerOpen&&!!n.upperOpen==!!r.upperOpen}function Ws(n,r){return(function(a,u,l,f){if(a===void 0)return u!==void 0?-1:0;if(u===void 0)return 1;if((u=X(a,u))===0){if(l&&f)return 0;if(l)return 1;if(f)return-1}return u})(n.lower,r.lower,n.lowerOpen,r.lowerOpen)<=0&&0<=(function(a,u,l,f){if(a===void 0)return u!==void 0?1:0;if(u===void 0)return-1;if((u=X(a,u))===0){if(l&&f)return 0;if(l)return-1;if(f)return 1}return u})(n.upper,r.upper,n.upperOpen,r.upperOpen)}function Vs(n,r,a,u){n.subscribers.add(a),u.addEventListener("abort",function(){var l,f;n.subscribers.delete(a),n.subscribers.size===0&&(l=n,f=r,setTimeout(function(){l.subscribers.size===0&&ee(f,l)},3e3))})}var zs={stack:"dbcore",level:0,name:"Cache",create:function(n){var r=n.schema.name;return o(o({},n),{transaction:function(a,u,l){var f,p,g=n.transaction(a,u,l);return u==="readwrite"&&(p=(f=new AbortController).signal,l=function(v){return function(){if(f.abort(),u==="readwrite"){for(var b=new Set,T=0,y=a;T<y.length;T++){var k=y[T],w=le["idb://".concat(r,"/").concat(k)];if(w){var x=n.table(k),E=w.optimisticOps.filter(function(q){return q.trans===g});if(g._explicit&&v&&g.mutatedParts)for(var _=0,A=Object.values(w.queries.query);_<A.length;_++)for(var D=0,P=(j=A[_]).slice();D<P.length;D++)Kr((R=P[D]).obsSet,g.mutatedParts)&&(ee(j,R),R.subscribers.forEach(function(q){return b.add(q)}));else if(0<E.length){w.optimisticOps=w.optimisticOps.filter(function(q){return q.trans!==g});for(var I=0,M=Object.values(w.queries.query);I<M.length;I++)for(var j,R,F,N=0,L=(j=M[I]).slice();N<L.length;N++)(R=L[N]).res!=null&&g.mutatedParts&&(v&&!R.dirty?(F=Object.isFrozen(R.res),F=So(R.res,R.req,E,x,R,F),R.dirty?(ee(j,R),R.subscribers.forEach(function(q){return b.add(q)})):F!==R.res&&(R.res=F,R.promise=B.resolve({result:F}))):(R.dirty&&ee(j,R),R.subscribers.forEach(function(q){return b.add(q)})))}}}b.forEach(function(q){return q()})}}},g.addEventListener("abort",l(!1),{signal:p}),g.addEventListener("error",l(!1),{signal:p}),g.addEventListener("complete",l(!0),{signal:p})),g},table:function(a){var u=n.table(a),l=u.schema.primaryKey;return o(o({},u),{mutate:function(f){var p=U.trans;if(l.outbound||p.db._options.cache==="disabled"||p.explicit||p.idbtrans.mode!=="readwrite")return u.mutate(f);var g=le["idb://".concat(r,"/").concat(a)];return g?(p=u.mutate(f),f.type!=="add"&&f.type!=="put"||!(50<=f.values.length||zr(l,f).some(function(v){return v==null}))?(g.optimisticOps.push(f),f.mutatedParts&&Nn(f.mutatedParts),p.then(function(v){0<v.numFailures&&(ee(g.optimisticOps,f),(v=_o(0,f,v))&&g.optimisticOps.push(v),f.mutatedParts&&Nn(f.mutatedParts))}),p.catch(function(){ee(g.optimisticOps,f),f.mutatedParts&&Nn(f.mutatedParts)})):p.then(function(v){var b=_o(0,o(o({},f),{values:f.values.map(function(T,y){var k;return v.failures[y]?T:(T=(k=l.keyPath)!==null&&k!==void 0&&k.includes(".")?te(T):o({},T),gt(T,l.keyPath,v.results[y]),T)})}),v);g.optimisticOps.push(b),queueMicrotask(function(){return f.mutatedParts&&Nn(f.mutatedParts)})}),p):u.mutate(f)},query:function(f){if(!wo(U,u)||!bo("query",f))return u.query(f);var p=((b=U.trans)===null||b===void 0?void 0:b.db._options.cache)==="immutable",y=U,g=y.requery,v=y.signal,b=(function(x,E,_,A){var D=le["idb://".concat(x,"/").concat(E)];if(!D)return[];if(!(E=D.queries[_]))return[null,!1,D,null];var P=E[(A.query?A.query.index.name:null)||""];if(!P)return[null,!1,D,null];switch(_){case"query":var I=P.find(function(M){return M.req.limit===A.limit&&M.req.values===A.values&&xo(M.req.query.range,A.query.range)});return I?[I,!0,D,P]:[P.find(function(M){return("limit"in M.req?M.req.limit:1/0)>=A.limit&&(!A.values||M.req.values)&&Ws(M.req.query.range,A.query.range)}),!1,D,P];case"count":return I=P.find(function(M){return xo(M.req.query.range,A.query.range)}),[I,!!I,D,P]}})(r,a,"query",f),T=b[0],y=b[1],k=b[2],w=b[3];return T&&y?T.obsSet=f.obsSet:(y=u.query(f).then(function(x){var E=x.result;if(T&&(T.res=E),p){for(var _=0,A=E.length;_<A;++_)Object.freeze(E[_]);Object.freeze(E)}else x.result=te(E);return x}).catch(function(x){return w&&T&&ee(w,T),Promise.reject(x)}),T={obsSet:f.obsSet,promise:y,subscribers:new Set,type:"query",req:f,dirty:!1},w?w.push(T):(w=[T],(k=k||(le["idb://".concat(r,"/").concat(a)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[f.query.index.name||""]=w)),Vs(T,w,g,v),T.promise.then(function(x){return{result:So(x.result,f,k?.optimisticOps,u,T,p)}})}})}})}};function Kn(n,r){return new Proxy(n,{get:function(a,u,l){return u==="db"?r:Reflect.get(a,u,l)}})}var Lt=(ct.prototype.version=function(n){if(isNaN(n)||n<.1)throw new W.Type("Given version is not a positive number");if(n=Math.round(10*n)/10,this.idbdb||this._state.isBeingOpened)throw new W.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,n);var r=this._versions,a=r.filter(function(u){return u._cfg.version===n})[0];return a||(a=new this.Version(n),r.push(a),r.sort(Fs),a.stores({}),this._state.autoSchema=!1,a)},ct.prototype._whenReady=function(n){var r=this;return this.idbdb&&(this._state.openComplete||U.letThrough||this._vip)?n():new B(function(a,u){if(r._state.openComplete)return u(new W.DatabaseClosed(r._state.dbOpenError));if(!r._state.isBeingOpened){if(!r._state.autoOpen)return void u(new W.DatabaseClosed);r.open().catch(nt)}r._state.dbReadyPromise.then(a,u)}).then(n)},ct.prototype.use=function(n){var r=n.stack,a=n.create,u=n.level,l=n.name;return l&&this.unuse({stack:r,name:l}),n=this._middlewares[r]||(this._middlewares[r]=[]),n.push({stack:r,create:a,level:u??10,name:l}),n.sort(function(f,p){return f.level-p.level}),this},ct.prototype.unuse=function(n){var r=n.stack,a=n.name,u=n.create;return r&&this._middlewares[r]&&(this._middlewares[r]=this._middlewares[r].filter(function(l){return u?l.create!==u:!!a&&l.name!==a})),this},ct.prototype.open=function(){var n=this;return se(qt,function(){return Bs(n)})},ct.prototype._close=function(){var n=this._state,r=De.indexOf(this);if(0<=r&&De.splice(r,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}n.isBeingOpened||(n.dbReadyPromise=new B(function(a){n.dbReadyResolve=a}),n.openCanceller=new B(function(a,u){n.cancelOpen=u}))},ct.prototype.close=function(a){var r=(a===void 0?{disableAutoOpen:!0}:a).disableAutoOpen,a=this._state;r?(a.isBeingOpened&&a.cancelOpen(new W.DatabaseClosed),this._close(),a.autoOpen=!1,a.dbOpenError=new W.DatabaseClosed):(this._close(),a.autoOpen=this._options.autoOpen||a.isBeingOpened,a.openComplete=!1,a.dbOpenError=null)},ct.prototype.delete=function(n){var r=this;n===void 0&&(n={disableAutoOpen:!0});var a=0<arguments.length&&typeof arguments[0]!="object",u=this._state;return new B(function(l,f){function p(){r.close(n);var g=r._deps.indexedDB.deleteDatabase(r.name);g.onsuccess=at(function(){var v,b,T;v=r._deps,b=r.name,T=v.indexedDB,v=v.IDBKeyRange,jr(T)||b===kn||Lr(T,v).delete(b).catch(nt),l()}),g.onerror=Ct(f),g.onblocked=r._fireOnBlocked}if(a)throw new W.InvalidArgument("Invalid closeOptions argument to db.delete()");u.isBeingOpened?u.dbReadyPromise.then(p):p()})},ct.prototype.backendDB=function(){return this.idbdb},ct.prototype.isOpen=function(){return this.idbdb!==null},ct.prototype.hasBeenClosed=function(){var n=this._state.dbOpenError;return n&&n.name==="DatabaseClosed"},ct.prototype.hasFailed=function(){return this._state.dbOpenError!==null},ct.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(ct.prototype,"tables",{get:function(){var n=this;return d(this._allTables).map(function(r){return n._allTables[r]})},enumerable:!1,configurable:!0}),ct.prototype.transaction=function(){var n=function(r,a,u){var l=arguments.length;if(l<2)throw new W.InvalidArgument("Too few arguments");for(var f=new Array(l-1);--l;)f[l-1]=arguments[l];return u=f.pop(),[r,gn(f),u]}.apply(this,arguments);return this._transaction.apply(this,n)},ct.prototype._transaction=function(n,r,a){var u=this,l=U.trans;l&&l.db===this&&n.indexOf("!")===-1||(l=null);var f,p,g=n.indexOf("?")!==-1;n=n.replace("!","").replace("?","");try{if(p=r.map(function(b){if(b=b instanceof u.Table?b.name:b,typeof b!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return b}),n=="r"||n===Er)f=Er;else{if(n!="rw"&&n!=kr)throw new W.InvalidArgument("Invalid transaction mode: "+n);f=kr}if(l){if(l.mode===Er&&f===kr){if(!g)throw new W.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");l=null}l&&p.forEach(function(b){if(l&&l.storeNames.indexOf(b)===-1){if(!g)throw new W.SubTransaction("Table "+b+" not included in parent transaction.");l=null}}),g&&l&&!l.active&&(l=null)}}catch(b){return l?l._promise(null,function(T,y){y(b)}):ut(b)}var v=function b(T,y,k,w,x){return B.resolve().then(function(){var E=U.transless||U,_=T._createTransaction(y,k,T._dbSchema,w);if(_.explicit=!0,E={trans:_,transless:E},w)_.idbtrans=w.idbtrans;else try{_.create(),_.idbtrans._explicit=!0,T._state.PR1398_maxLoop=3}catch(P){return P.name===gr.InvalidState&&T.isOpen()&&0<--T._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),T.close({disableAutoOpen:!1}),T.open().then(function(){return b(T,y,k,null,x)})):ut(P)}var A,D=pr(x);return D&&Ae(),E=B.follow(function(){var P;(A=x.call(_,_))&&(D?(P=Ut.bind(null,null),A.then(P,P)):typeof A.next=="function"&&typeof A.throw=="function"&&(A=Wr(A)))},E),(A&&typeof A.then=="function"?B.resolve(A).then(function(P){return _.active?P:ut(new W.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):E.then(function(){return A})).then(function(P){return w&&_._resolve(),_._completion.then(function(){return P})}).catch(function(P){return _._reject(P),ut(P)})})}.bind(null,this,f,p,l,a);return l?l._promise(f,v,"lock"):U.trans?se(U.transless,function(){return u._whenReady(v)}):this._whenReady(v)},ct.prototype.table=function(n){if(!C(this._allTables,n))throw new W.InvalidTable("Table ".concat(n," does not exist"));return this._allTables[n]},ct);function ct(n,r){var a=this;this._middlewares={},this.verno=0;var u=ct.dependencies;this._options=r=o({addons:ct.addons,autoOpen:!0,indexedDB:u.indexedDB,IDBKeyRange:u.IDBKeyRange,cache:"cloned"},r),this._deps={indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange},u=r.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var l,f,p,g,v,b={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:nt,dbReadyPromise:null,cancelOpen:nt,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:r.autoOpen};b.dbReadyPromise=new B(function(y){b.dbReadyResolve=y}),b.openCanceller=new B(function(y,k){b.cancelOpen=k}),this._state=b,this.name=n,this.on=Ve(this,"populate","blocked","versionchange","close",{ready:[mr,nt]}),this.on.ready.subscribe=ot(this.on.ready.subscribe,function(y){return function(k,w){ct.vip(function(){var x,E=a._state;E.openComplete?(E.dbOpenError||B.resolve().then(k),w&&y(k)):E.onReadyBeingFired?(E.onReadyBeingFired.push(k),w&&y(k)):(y(k),x=a,w||y(function _(){x.on.ready.unsubscribe(k),x.on.ready.unsubscribe(_)}))})}}),this.Collection=(l=this,ze(Os.prototype,function(A,_){this.db=l;var w=Zi,x=null;if(_)try{w=_()}catch(D){x=D}var E=A._ctx,_=E.table,A=_.hook.reading.fire;this._ctx={table:_,index:E.index,isPrimKey:!E.index||_.schema.primKey.keyPath&&E.index===_.schema.primKey.name,range:w,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:x,or:E.or,valueMapper:A!==Ke?A:null}})),this.Table=(f=this,ze(ro.prototype,function(y,k,w){this.db=f,this._tx=w,this.name=y,this.schema=k,this.hook=f._allTables[y]?f._allTables[y].hook:Ve(null,{creating:[bs,nt],reading:[ws,Ke],updating:[Ss,nt],deleting:[_s,nt]})})),this.Transaction=(p=this,ze(Is.prototype,function(y,k,w,x,E){var _=this;this.db=p,this.mode=y,this.storeNames=k,this.schema=w,this.chromeTransactionDurability=x,this.idbtrans=null,this.on=Ve(this,"complete","error","abort"),this.parent=E||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new B(function(A,D){_._resolve=A,_._reject=D}),this._completion.then(function(){_.active=!1,_.on.complete.fire()},function(A){var D=_.active;return _.active=!1,_.on.error.fire(A),_.parent?_.parent._reject(A):D&&_.idbtrans&&_.idbtrans.abort(),ut(A)})})),this.Version=(g=this,ze(Ns.prototype,function(y){this.db=g,this._cfg={version:y,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(v=this,ze(uo.prototype,function(y,k,w){if(this.db=v,this._ctx={table:y,index:k===":id"?null:k,or:w},this._cmp=this._ascending=X,this._descending=function(x,E){return X(E,x)},this._max=function(x,E){return 0<X(x,E)?x:E},this._min=function(x,E){return X(x,E)<0?x:E},this._IDBKeyRange=v._deps.IDBKeyRange,!this._IDBKeyRange)throw new W.MissingAPI})),this.on("versionchange",function(y){0<y.newVersion?console.warn("Another connection wants to upgrade database '".concat(a.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(a.name,"'. Closing db now to resume the delete request.")),a.close({disableAutoOpen:!1})}),this.on("blocked",function(y){!y.newVersion||y.newVersion<y.oldVersion?console.warn("Dexie.delete('".concat(a.name,"') was blocked")):console.warn("Upgrade '".concat(a.name,"' blocked by other connection holding version ").concat(y.oldVersion/10))}),this._maxKey=Qe(r.IDBKeyRange),this._createTransaction=function(y,k,w,x){return new a.Transaction(y,k,w,a._options.chromeTransactionDurability,x)},this._fireOnBlocked=function(y){a.on("blocked").fire(y),De.filter(function(k){return k.name===a.name&&k!==a&&!k._state.vcFired}).map(function(k){return k.on("versionchange").fire(y)})},this.use(Hs),this.use(zs),this.use(Us),this.use(Ks),this.use(qs);var T=new Proxy(this,{get:function(y,k,w){if(k==="_vip")return!0;if(k==="table")return function(E){return Kn(a.table(E),T)};var x=Reflect.get(y,k,w);return x instanceof ro?Kn(x,T):k==="tables"?x.map(function(E){return Kn(E,T)}):k==="_createTransaction"?function(){return Kn(x.apply(this,arguments),T)}:x}});this.vip=T,u.forEach(function(y){return y(a)})}var qn,Et=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Js=(Yr.prototype.subscribe=function(n,r,a){return this._subscribe(n&&typeof n!="function"?n:{next:n,error:r,complete:a})},Yr.prototype[Et]=function(){return this},Yr);function Yr(n){this._subscribe=n}try{qn={indexedDB:c.indexedDB||c.mozIndexedDB||c.webkitIndexedDB||c.msIndexedDB,IDBKeyRange:c.IDBKeyRange||c.webkitIDBKeyRange}}catch{qn={indexedDB:null,IDBKeyRange:null}}function To(n){var r,a=!1,u=new Js(function(l){var f=pr(n),p,g=!1,v={},b={},T={get closed(){return g},unsubscribe:function(){g||(g=!0,p&&p.abort(),y&&zt.storagemutated.unsubscribe(w))}};l.start&&l.start(T);var y=!1,k=function(){return Tr(x)},w=function(E){jn(v,E),Kr(b,v)&&k()},x=function(){var E,_,A;!g&&qn.indexedDB&&(v={},E={},p&&p.abort(),p=new AbortController,A=(function(D){var P=Ee();try{f&&Ae();var I=Ht(n,D);return I=f?I.finally(Ut):I}finally{P&&ke()}})(_={subscr:E,signal:p.signal,requery:k,querier:n,trans:null}),Promise.resolve(A).then(function(D){a=!0,r=D,g||_.signal.aborted||(v={},(function(P){for(var I in P)if(C(P,I))return;return 1})(b=E)||y||(zt(Ge,w),y=!0),Tr(function(){return!g&&l.next&&l.next(D)}))},function(D){a=!1,["DatabaseClosedError","AbortError"].includes(D?.name)||g||Tr(function(){g||l.error&&l.error(D)})}))};return setTimeout(k,0),T});return u.hasValue=function(){return a},u.getValue=function(){return r},u}var de=Lt;function Gr(n){var r=Jt;try{Jt=!0,zt.storagemutated.fire(n),Ur(n,!0)}finally{Jt=r}}$(de,o(o({},yn),{delete:function(n){return new de(n,{addons:[]}).delete()},exists:function(n){return new de(n,{addons:[]}).open().then(function(r){return r.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(n){try{return r=de.dependencies,a=r.indexedDB,r=r.IDBKeyRange,(jr(a)?Promise.resolve(a.databases()).then(function(u){return u.map(function(l){return l.name}).filter(function(l){return l!==kn})}):Lr(a,r).toCollection().primaryKeys()).then(n)}catch{return ut(new W.MissingAPI)}var r,a},defineClass:function(){return function(n){m(this,n)}},ignoreTransaction:function(n){return U.trans?se(U.transless,n):n()},vip:Nr,async:function(n){return function(){try{var r=Wr(n.apply(this,arguments));return r&&typeof r.then=="function"?r:B.resolve(r)}catch(a){return ut(a)}}},spawn:function(n,r,a){try{var u=Wr(n.apply(a,r||[]));return u&&typeof u.then=="function"?u:B.resolve(u)}catch(l){return ut(l)}},currentTransaction:{get:function(){return U.trans||null}},waitFor:function(n,r){return r=B.resolve(typeof n=="function"?de.ignoreTransaction(n):n).timeout(r||6e4),U.trans?U.trans.waitFor(r):r},Promise:B,debug:{get:function(){return Pt},set:function(n){Vi(n)}},derive:et,extend:m,props:$,override:ot,Events:Ve,on:zt,liveQuery:To,extendObservabilitySet:jn,getByKeyPath:wt,setByKeyPath:gt,delByKeyPath:function(n,r){typeof r=="string"?gt(n,r,void 0):"length"in r&&[].map.call(r,function(a){gt(n,a,void 0)})},shallowClone:pn,deepClone:te,getObjectDiff:Vr,cmp:X,asap:Mt,minKey:-1/0,addons:[],connections:De,errnames:gr,dependencies:qn,cache:le,semVer:"4.0.11",version:"4.0.11".split(".").map(function(n){return parseInt(n)}).reduce(function(n,r,a){return n+r/Math.pow(10,2*a)})})),de.maxKey=Qe(de.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(zt(Ge,function(n){Jt||(n=new CustomEvent(Pr,{detail:n}),Jt=!0,dispatchEvent(n),Jt=!1)}),addEventListener(Pr,function(n){n=n.detail,Jt||Gr(n)}));var Ce,Jt=!1,Eo=function(){};return typeof BroadcastChannel<"u"&&((Eo=function(){(Ce=new BroadcastChannel(Pr)).onmessage=function(n){return n.data&&Gr(n.data)}})(),typeof Ce.unref=="function"&&Ce.unref(),zt(Ge,function(n){Jt||Ce.postMessage(n)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(n){if(!Lt.disableBfCache&&n.persisted){Pt&&console.debug("Dexie: handling persisted pagehide"),Ce?.close();for(var r=0,a=De;r<a.length;r++)a[r].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(n){!Lt.disableBfCache&&n.persisted&&(Pt&&console.debug("Dexie: handling persisted pageshow"),Eo(),Gr({all:new mt(-1/0,[[]])}))})),B.rejectionMapper=function(n,r){return!n||n instanceof xe||n instanceof TypeError||n instanceof SyntaxError||!n.name||!Wi[n.name]?n:(r=new Wi[n.name](r||n.message,n),"stack"in n&&V(r,"stack",{get:function(){return this.inner.stack}}),r)},Vi(Pt),o(Lt,Object.freeze({__proto__:null,Dexie:Lt,liveQuery:To,Entity:to,cmp:X,PropModification:Je,replacePrefix:function(n,r){return new Je({replacePrefix:[n,r]})},add:function(n){return new Je({add:n})},remove:function(n){return new Je({remove:n})},default:Lt,RangeSet:mt,mergeRanges:tn,rangesOverlap:po}),{default:Lt}),Lt})})(Qn)),Qn.exports}var dl=ll();const _i=ul(dl),Ko=Symbol.for("Dexie"),nr=globalThis[Ko]||(globalThis[Ko]=_i);if(_i.semVer!==nr.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${_i.semVer} and ${nr.semVer}`);const{liveQuery:Rl,mergeRanges:Fl,rangesOverlap:Ll,RangeSet:jl,cmp:Nl,Entity:Bl,PropModification:Kl,replacePrefix:ql,add:Hl,remove:Ul}=nr;class cs extends nr{constructor(){super("TimeTrackerDB");Yt(this,"entries");Yt(this,"projects");this.version(1).stores({entries:"id, startTime, endTime, projectId, category, syncStatus, createdAt, deletedAt",projects:"id, name, isActive, syncStatus, createdAt"}),this.version(2).stores({entries:"id, startTime, endTime, projectId, category, syncStatus, createdAt, deletedAt, deletedByEntryId, prototypeId",projects:"id, name, isActive, syncStatus, createdAt"}),this.version(3).stores({entries:"id, startTime, endTime, rawStartTime, rawEndTime, projectId, category, syncStatus, createdAt, deletedAt, deletedByEntryId, prototypeId",projects:"id, name, isActive, syncStatus, createdAt"})}}const pt=new cs;function ge(){return crypto.randomUUID()}const qo=Object.freeze(Object.defineProperty({__proto__:null,TimeTrackerDB:cs,db:pt,generateId:ge},Symbol.toStringTag,{value:"Module"}));function ls(t,e){try{const i=localStorage.getItem(t);return i===null?e:JSON.parse(i)}catch(i){return console.warn(`Failed to parse localStorage item '${t}':`,i),e}}function ds(t,e){try{return localStorage.setItem(t,JSON.stringify(e)),!0}catch(i){return console.error(`Failed to save to localStorage '${t}':`,i),!1}}function lr(){return ls("appSettings",{})}function Wl(t){const i={...lr(),...t};return ds("appSettings",i)}function Ho(){return ls("activeTimer",null)}function Uo(t){return ds("activeTimer",t)}function on(){try{localStorage.removeItem("activeTimer")}catch(t){console.error("Failed to clear active timer:",t)}}const fl=(t=null)=>({currentActivityId:t,activities:[],todayDurations:{},async init(){await this.loadActivitiesFromSettings(),await this.loadTodayDurations(),window.addEventListener("entryAdded",()=>this.loadTodayDurations()),window.addEventListener("entryUpdated",()=>this.loadTodayDurations()),window.addEventListener("entryDeleted",()=>this.loadTodayDurations()),window.addEventListener("activities-updated",async()=>{await this.loadActivitiesFromSettings(),await this.loadTodayDurations()})},async loadActivitiesFromSettings(){try{const e=lr();if(e.categories&&Array.isArray(e.categories)){this.activities=e.categories.map(i=>({id:i.id,label:i.label,icon:i.icon,color:i.color,aliases:[i.label.toLowerCase(),...Array.isArray(i.subcategories)?i.subcategories:[]],subcategories:Array.isArray(i.subcategories)?i.subcategories:[]}));return}}catch(e){console.error("Error loading activities from settings:",e)}this.activities=this.getDefaultActivities()},getDefaultActivities(){return[{id:"work",label:"Work",icon:"",color:"#6366f1",aliases:["working","worked","coding","code","development","dev"],subcategories:["coding","planning","research","review"]},{id:"break",label:"Break",icon:"",color:"#10b981",aliases:["lunch","coffee","rest","pause","eating","break"],subcategories:["lunch","coffee","rest"]},{id:"meeting",label:"Meeting",icon:"",color:"#f59e0b",aliases:["call","standup","sync","meeting","conference","discussion"],subcategories:["standup","planning","review","call"]},{id:"personal",label:"Personal",icon:"",color:"#ec4899",aliases:["home","family","private","personal","life","errands"],subcategories:["planning","reading","family","hobbies"]}]},async loadTodayDurations(){const e={};this.activities.forEach(i=>{e[i.id]=0});try{const i=new Date,o=new Date(i.getFullYear(),i.getMonth(),i.getDate()),s=new Date(i.getFullYear(),i.getMonth(),i.getDate()+1);(await pt.entries.where("startTime").between(o,s).and(d=>!d.deletedAt).toArray()).forEach(d=>{const h=this.findActivityByDescription(d.description);h&&d.duration&&(e[h.id]=(e[h.id]||0)+d.duration)}),this.todayDurations=e}catch(i){console.error("Failed to load today durations:",i),this.todayDurations=e,window.Alpine.store("notifications").showError("Failed to load activity durations")}},findActivity(e){if(!e)return null;const i=e.toLowerCase();for(const o of this.activities)if(o.label.toLowerCase()===i||o.id.toLowerCase()===i||o.aliases.some(s=>i.includes(s)))return o;return null},findActivityByDescription(e){if(!e)return null;const i=e.toLowerCase();for(const o of this.activities)if(o.aliases.some(s=>i.includes(s)))return o;for(const o of this.activities)if(i.includes(o.id.toLowerCase()))return o;return null},formatDurationFromSeconds(e){if(e<60)return`${e}s`;if(e<3600)return`${Math.floor(e/60)}m`;const i=Math.floor(e/3600),o=Math.floor(e%3600/60);return`${i}h${o>0?` ${o}m`:""}`}});function hl(){try{let e=JSON.parse(localStorage.getItem("appSettings")||"{}").timeRounding??300;return typeof e=="string"&&(e=e==="null"?null:Number(e)),e}catch{return 300}}function fs(t,e=null,i="down"){if(e==null&&(e=hl()),e===null||e===0)return new Date(t);const o=new Date(t);if(e===1)return o.setMilliseconds(0),o;const s=o.getHours()*3600+o.getMinutes()*60+o.getSeconds();let c;if(i==="down"?c=Math.floor(s/e)*e:c=Math.ceil(s/e)*e,e===1500){const S=Math.floor(s/60);let O;i==="down"?S<25?O=0:S<30?O=25:S<55?O=30:O=55:S<25?O=25:S<30?O=30:S<55?O=55:O=60,c=O*60}else if(e===2700){const S=Math.floor(s/60);let O;i==="down"?O=S<45?0:45:O=S<45?45:60,c=O*60}else if(e===3300){const S=Math.floor(s/60);let O;i==="down"?O=S<55?0:55:O=S<55?55:60,c=O*60}const d=Math.floor(c/3600)%24,h=Math.floor(c%3600/60),m=c%60;return o.setHours(d,h,m,0),o}function Bt(t,e){return fs(t,e,"down")}function Nt(t,e){return fs(t,e,"up")}class pl{constructor(e){Yt(this,"activities");this.activities=e}async parseNaturalLanguage(e,i=new Date){if(!e.trim())return{entries:[],failedLines:[],successfulLines:[]};const o=e.split(",").map(S=>S.trim()).filter(S=>S.length>0),s=[],c=[],d=[];let h=null;if(o.every(S=>!S.match(/\d{1,2}:?\d{0,2}\s*-\s*\d{1,2}:?\d{0,2}/)&&!S.match(/till|until|to\s+\d/i)&&S.match(/\d+\s*(h|hr|hour|m|min)/i))){const S=new Date;let O=new Date(S);for(let C=o.length-1;C>=0;C--){const $=o[C],K=this.parseSingleEntry($,i,h);if(K&&K.duration){const V=new Date(O),et=new Date(V.getTime()-K.duration*1e3),H=Bt(et),Y=Nt(V),Z=Math.floor((Y.getTime()-H.getTime())/1e3);s.unshift({...K,startTime:H,endTime:Y,rawStartTime:et,rawEndTime:V,duration:Z}),d.unshift($),O=H}else c.unshift($)}}else for(const S of o){const O=this.parseSingleEntry(S,i,h);O?(s.push(O),d.push(S),h=O.endTime||null):c.push(S)}return{entries:s,failedLines:c,successfulLines:d}}parseSingleEntry(e,i,o){let s=null,c=null,d=null,h=null;if(s=this.findActivity(e),!s){const C=e.split(/\s+/);if(s=this.findActivity(C[0]),!s&&C.length>1&&(s=this.findActivity(C[C.length-1])),!s){const $=e.replace(/\d{1,2}:?\d{0,2}\s*-\s*\d{1,2}:?\d{0,2}\s*(am|pm)?/gi,"").replace(/(?:till|until|to)\s+\d{1,2}:?\d{0,2}\s*(am|pm)?/gi,"").replace(/\d+\.?\d*\s*(h|hr|hour|m|min)/gi,"").trim();$&&(s=this.findActivity($))}}if(!s)return null;const m=e.match(/(?:till|until|to)\s+(\d{1,2}):?(\d{0,2})\s*(am|pm)?/i);if(m){c=o||new Date;let C=parseInt(m[1]);const $=parseInt(m[2]||"0"),K=m[3];K?.toLowerCase()==="pm"&&C<12&&(C+=12),K?.toLowerCase()==="am"&&C===12&&(C=0);const V=new Date(i);V.setHours(C,$,0,0),d=Nt(V),h=Math.floor((d.getTime()-c.getTime())/1e3)}const S=e.match(/(\d{1,2}):?(\d{0,2})\s*-\s*(\d{1,2}):?(\d{0,2})\s*(am|pm)?/i);if(S&&!m){let C=parseInt(S[1]);const $=parseInt(S[2]||"0");let K=parseInt(S[3]);const V=parseInt(S[4]||"0"),et=S[5];et?.toLowerCase()==="pm"&&(K<12&&(K+=12),C<K&&C<12&&(C+=12)),et?.toLowerCase()==="am"&&(C===12&&(C=0),K===12&&(K=0));const H=new Date(i);H.setHours(C,$,0,0);const Y=new Date(i);Y.setHours(K,V,0,0),c=Bt(H),d=Nt(Y),h=Math.floor((d.getTime()-c.getTime())/1e3)}const O=e.match(/(\d+\.?\d*)\s*(h|hr|hour|m|min)/i);if(O&&!S&&!m){const C=parseFloat(O[1]);if(O[2].toLowerCase().startsWith("h")?h=Math.floor(C*3600):h=Math.floor(C*60),o){const K=new Date(o),V=new Date(K.getTime()+h*1e3);c=Bt(K),d=Nt(V),h=Math.floor((d.getTime()-c.getTime())/1e3)}}return c&&d||h?{date:i.toDateString(),startTime:c||void 0,endTime:d||void 0,activity:s.label,duration:h||void 0}:null}findActivity(e){if(!e)return null;const i=e.toLowerCase();for(const o of this.activities)if(o.label.toLowerCase()===i||o.id.toLowerCase()===i||o.aliases.some(s=>i.includes(s)))return o;return null}}function gl(t){return new pl(t)}function Wo(){return lr().durationThreshold||15}class ml{async addEntryWithOverlapHandling(e){if(!e.startTime||!e.endTime){const i=ge();try{await pt.entries.add({...e,id:i}),window.dispatchEvent(new CustomEvent("entryAdded",{detail:{...e,id:i}}))}catch(o){throw console.error("Failed to add entry without time range:",o),new Error("Failed to save time entry")}return}try{await pt.transaction("rw",pt.entries,async()=>{const i=await this.findOverlappingEntries(e.startTime,e.endTime);if(i.length===0){const h=ge();await pt.entries.add({...e,id:h}),window.dispatchEvent(new CustomEvent("entryAdded",{detail:{...e,id:h}}));return}const o=this.resolveOverlaps(e,i),s=ge(),c={id:s,description:e.description,startTime:e.startTime,endTime:e.endTime,rawStartTime:e.rawStartTime,rawEndTime:e.rawEndTime,duration:e.duration,projectId:e.projectId,tags:Array.isArray(e.tags)?[...e.tags]:[],category:e.category,subcategory:e.subcategory,syncStatus:e.syncStatus||"local",createdAt:e.createdAt||new Date,updatedAt:e.updatedAt||new Date,prototypeId:e.prototypeId,deletedByEntryId:e.deletedByEntryId};await pt.entries.add(c);const d=[];for(const h of o.entries.filter(m=>m.prototypeId)){const m=ge(),S={...h,id:m};await pt.entries.add(S),d.push(S)}for(const h of o.softDeletedIds)await pt.entries.update(h,{deletedAt:new Date,updatedAt:new Date,deletedByEntryId:s});window.dispatchEvent(new CustomEvent("entryAdded",{detail:c}));for(const h of d)window.dispatchEvent(new CustomEvent("entryAdded",{detail:h}));for(const h of o.softDeletedIds)window.dispatchEvent(new CustomEvent("entryDeleted",{detail:{id:h}}));if(o.discardedCount>0){const h=Wo(),m=window.Alpine?.store?.("notifications");m&&m.showInfo(`${o.discardedCount} remainder entries discarded (< ${h}s threshold)`)}})}catch(i){console.error("Failed to add entry with overlap handling:",i);const o=window.Alpine?.store?.("notifications");throw o&&o.showError("Failed to save time entry"),i}}async findOverlappingEntries(e,i){const o=new Date(e),s=new Date(o.getFullYear(),o.getMonth(),o.getDate()),c=new Date(o.getFullYear(),o.getMonth(),o.getDate()+1);return(await pt.entries.where("startTime").between(s,c).and(h=>!h.deletedAt).toArray()).filter(h=>h.startTime&&h.endTime&&h.startTime<i&&h.endTime>e)}resolveOverlaps(e,i){const o=[],s=i.map(h=>h.id),c=Wo();let d=0;if(!e.startTime||!e.endTime)return o.push(e),{action:i.length>0?"replace":"add",entries:o,softDeletedIds:s,discardedCount:0};for(const h of i){if(!h.startTime||!h.endTime)continue;const m=this.generateGaps(h,e.startTime,e.endTime);for(const S of m)if(S.duration>=c){const O=h.rawStartTime&&h.rawStartTime>=S.startTime&&h.rawStartTime<S.endTime?h.rawStartTime:S.startTime,C=h.rawEndTime&&h.rawEndTime>S.startTime&&h.rawEndTime<=S.endTime?h.rawEndTime:S.endTime,$={...h,startTime:S.startTime,endTime:S.endTime,rawStartTime:O,rawEndTime:C,duration:S.duration,createdAt:new Date,updatedAt:new Date,deletedAt:void 0,prototypeId:h.id,deletedByEntryId:void 0};o.push($)}else d++,console.log(`Gap discarded: ${S.duration}s < ${c}s threshold`)}return{action:i.length>0?"replace":"add",entries:o,softDeletedIds:s,discardedCount:d}}generateGaps(e,i,o){const s=[];if(!e.startTime||!e.endTime)return s;if(e.startTime<i&&e.endTime>e.startTime){const c=i<e.endTime?i:e.endTime,d=Math.floor((c.getTime()-e.startTime.getTime())/1e3);d>0&&s.push({startTime:e.startTime,endTime:c,duration:d})}if(e.endTime>o&&e.startTime<e.endTime){const c=o>e.startTime?o:e.startTime,d=Math.floor((e.endTime.getTime()-c.getTime())/1e3);d>0&&s.push({startTime:c,endTime:e.endTime,duration:d})}return s}static hasOverlap(e,i,o,s){return e<s&&i>o}}const hs=new ml;function jt(t){return t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})}function Vo(t){const e=Math.floor(t/3600),i=Math.floor(t%3600/60),o=t%60;return`${String(e).padStart(2,"0")}:${String(i).padStart(2,"0")}:${String(o).padStart(2,"0")}`}function yl(t){const e=Math.floor(t/3600),i=Math.floor(t%3600/60);return`${String(e).padStart(2,"0")}:${String(i).padStart(2,"0")}`}const vl=()=>({isRunning:!1,startTime:null,elapsed:0,interval:null,currentActivity:null,currentSubcategory:null,showSubcategoryPicker:!1,sessionStartTime:null,pendingSubcategoryEntry:null,naturalInput:"",parsingInProgress:!1,init(){this.validateAndCleanTimerState(),this.checkForActiveTimer(),this.registerEventHandlers()},validateAndCleanTimerState(){const t=Ho();if(t){const e=new Date(t.startTime),i=new Date(t.sessionStartTime);(isNaN(e.getTime())||isNaN(i.getTime())||e.getTime()<0||i.getTime()<0)&&(console.warn("Detected corrupted timer data, clearing all timer storage"),on(),this.clearPreviousTimerState(),this.resetTimerState())}},clearPreviousTimerState(){try{localStorage.removeItem("previousTimerState")}catch(t){console.error("Failed to clear previous timer state:",t)}},resetTimerState(){this.isRunning=!1,this.startTime=null,this.elapsed=0,this.currentActivity=null,this.currentSubcategory=null,this.sessionStartTime=null,this.showSubcategoryPicker=!1,this.interval&&(clearInterval(this.interval),this.interval=null)},registerEventHandlers(){const t=e=>{const i=e;this.handleActivityClick(i.detail)};document.addEventListener("toggle-activity",t)},async handleActivityClick(t){if(this.currentActivity?.id===t.id){this.showSubcategoryPickerForActivity(t);return}await this.transitionToActivity(t,null)},async handleActivityDoubleClick(t){this.showSubcategoryPickerForActivity(t)},async startTrackingDirectly(t){this.currentActivity&&this.currentActivity.id!==t.id&&await this.saveCurrentSession(),await this.startTracking(t),this.startTicking()},async transitionToActivity(t,e){if(this.currentActivity?.id===t.id&&this.currentSubcategory===e)return;if(!this.currentActivity||!this.isRunning){await this.startTracking(t,e||void 0),this.startTicking();return}const i=this.getCurrentSessionDuration(),s=this.getSettings().durationThreshold||15;i>=s?(await this.saveCurrentSession(),await this.startTracking(t,e||void 0),this.startTicking()):this.updateCurrentSessionActivity(t,e)},getCurrentSessionDuration(){return this.sessionStartTime?Math.floor((new Date().getTime()-this.sessionStartTime.getTime())/1e3):0},updateCurrentSessionActivity(t,e){this.currentActivity=t,this.currentSubcategory=e,this.startTime&&this.sessionStartTime&&Uo({startTime:this.startTime,sessionStartTime:this.sessionStartTime,currentActivity:{...t,aliases:t.aliases||[]},currentSubcategory:e||void 0}),this.isRunning||this.startTicking()},showSubcategoryPickerForActivity(t){this.savePreviousTimerState(),t.subcategories&&t.subcategories.length>0?(this.currentActivity=t,this.showSubcategoryPicker=!0):this.transitionToActivity(t,null)},checkForActiveTimer(){const t=Ho();if(t)try{const e=new Date(t.startTime),i=t.sessionStartTime?new Date(t.sessionStartTime):new Date(t.startTime);if(isNaN(e.getTime())||isNaN(i.getTime())){console.warn("Corrupted timer timestamps, clearing timer"),on();return}const o=new Date,s=1440*60*1e3;if(o.getTime()-e.getTime()>s){console.warn("Saved timer too old, clearing timer"),on();return}this.startTime=e,this.sessionStartTime=i,this.currentActivity={...t.currentActivity,aliases:t.currentActivity.aliases||[]},this.currentSubcategory=t.currentSubcategory||null,this.isRunning=!0,this.startTicking()}catch(e){console.error("Failed to restore active timer:",e),on(),window.Alpine.store("notifications").showError("Failed to restore previous timer session")}},async toggleActivity(t){if(this.currentActivity?.id===t.id){t.subcategories&&t.subcategories.length>0&&(this.showSubcategoryPicker=!0);return}this.currentActivity&&await this.stopTracking(),await this.startTracking(t),t.subcategories&&t.subcategories.length>0&&(this.showSubcategoryPicker=!0)},async selectSubcategory(t){this.showSubcategoryPicker=!1,this.currentActivity&&await this.transitionToActivity(this.currentActivity,t)},async resetSubcategory(){this.showSubcategoryPicker=!1,this.currentActivity&&await this.transitionToActivity(this.currentActivity,null)},getPreviousTimerState(){try{const t=localStorage.getItem("previousTimerState");if(t){const e=JSON.parse(t);return{...e,startTime:e.startTime?new Date(e.startTime):null,sessionStartTime:e.sessionStartTime?new Date(e.sessionStartTime):null}}}catch(t){console.error("Error loading previous timer state:",t)}return null},savePreviousTimerState(){const t={startTime:this.startTime,sessionStartTime:this.sessionStartTime,currentActivity:this.currentActivity,currentSubcategory:this.currentSubcategory};localStorage.setItem("previousTimerState",JSON.stringify(t))},async startTracking(t,e){this.currentActivity=t,this.currentSubcategory=e||null;const i=new Date;this.startTime=Bt(i),this.sessionStartTime=this.startTime,this.elapsed=0,this.isRunning=!0,Uo({startTime:this.startTime,sessionStartTime:this.sessionStartTime,currentActivity:{...t,aliases:t.aliases||[]},currentSubcategory:this.currentSubcategory||void 0}),this.startTicking()},async stopTracking(){if(!this.startTime||!this.currentActivity)return;this.isRunning=!1,this.stopTicking();const t=new Date,e=Math.floor((t.getTime()-this.startTime.getTime())/1e3),o=this.getSettings().durationThreshold||15;e<o?window.Alpine.store("notifications").showInfo(`Entry discarded (${e}s < ${o}s threshold)`):await this.saveEntry(this.startTime,t,e,this.currentActivity,this.currentSubcategory),on(),this.reset()},reset(){this.startTime=null,this.sessionStartTime=null,this.elapsed=0,this.currentActivity=null,this.currentSubcategory=null,this.showSubcategoryPicker=!1,this.pendingSubcategoryEntry=null},startTicking(){this.updateElapsed(),this.interval=setInterval(()=>this.updateElapsed(),1e3)},stopTicking(){this.interval&&(clearInterval(this.interval),this.interval=null)},updateElapsed(){if(this.startTime){const t=this.startTime.getTime(),i=Date.now()-t;this.elapsed=Math.floor(i/1e3)}},getSettings(){const t=lr();return{durationThreshold:t.durationThreshold??15,...t}},async saveCurrentSession(){if(!this.currentActivity||!this.sessionStartTime)return;const t=new Date,e=Math.floor((t.getTime()-this.sessionStartTime.getTime())/1e3),o=this.getSettings().durationThreshold||15;e>=o&&await this.saveEntry(this.sessionStartTime,t,e,this.currentActivity,this.currentSubcategory)},async saveEntry(t,e,i,o,s){if(!o)return;const c=s?`${o.label}: ${s}`:o.label,d=Bt(t),h=Nt(e),m=Math.floor((h.getTime()-d.getTime())/1e3),S={description:c,startTime:d,endTime:h,rawStartTime:t,rawEndTime:e,duration:m,category:o.id,subcategory:s||void 0,projectId:o.id,tags:[o.id],syncStatus:"local",createdAt:new Date,updatedAt:new Date};try{const O=ge();await pt.entries.add({...S,id:O}),window.dispatchEvent(new CustomEvent("entryAdded",{detail:{...S,id:O}})),i>=60&&window.Alpine.store("notifications").showSuccess(`Saved ${o.label} session (${Vo(i)})`)}catch(O){console.error("Failed to save entry:",O),window.Alpine.store("notifications").showError("Failed to save time entry")}},async parseNaturalLanguage(){if(this.naturalInput.trim()&&!this.parsingInProgress){this.parsingInProgress=!0;try{const t=document.querySelector('[x-data*="activities"]');if(!t){window.Alpine.store("notifications").showError("Activities component not found");return}const e=window.Alpine.$data(t);if(!e?.activities){window.Alpine.store("notifications").showError("Activities not available for parsing");return}const o=await gl(e.activities).parseNaturalLanguage(this.naturalInput);let s=0;for(const c of o.entries)if(c.startTime&&c.endTime&&c.duration){const d=Bt(c.startTime),h=Nt(c.endTime),m=Math.floor((h.getTime()-d.getTime())/1e3),S=e.activities.find(C=>C.label===c.activity),O={description:c.activity,startTime:d,endTime:h,rawStartTime:c.startTime,rawEndTime:c.endTime,duration:m,category:S?.id,subcategory:void 0,projectId:S?.id,tags:[c.activity],syncStatus:"local",createdAt:new Date,updatedAt:new Date};await hs.addEntryWithOverlapHandling(O),s++}if(o.failedLines.length===0)this.naturalInput="",window.Alpine.store("notifications").showSuccess(` Added ${s} ${s===1?"entry":"entries"}`);else if(s===0)if(o.failedLines.length===0)window.Alpine.store("notifications").showWarning("No entries found in input");else{const c=o.failedLines.length===1?"Try: work 9-12, break 30min, or till 3pm meeting":"Check format for each entry";window.Alpine.store("notifications").showError(` Could not parse ${o.failedLines.length} ${o.failedLines.length===1?"entry":"entries"}. ${c}`)}else this.naturalInput=o.failedLines.join(", "),s>=o.failedLines.length?window.Alpine.store("notifications").showSuccess(` Added ${s} ${s===1?"entry":"entries"}. Please fix remaining ${o.failedLines.length} in input box`):window.Alpine.store("notifications").showWarning(` Added ${s}, but ${o.failedLines.length} failed. Fix remaining entries in input box`)}catch(t){console.error("Failed to parse natural language:",t),window.Alpine.store("notifications").showError("Failed to parse natural language input")}finally{this.parsingInProgress=!1}}},formatTime(t){return Vo(t)},formatStartTime(){return this.startTime?jt(this.startTime):""}});class ps extends Error{constructor(i,o,s="UNKNOWN_ERROR",c="medium",d={}){super(i);Yt(this,"code");Yt(this,"context");Yt(this,"userMessage");Yt(this,"severity");this.name="AppError",this.code=s,this.userMessage=o,this.severity=c,this.context=d}}function an(t,e,i,o,s){return new ps(t,e,i,o,s)}function wl(t,e={}){const i=t instanceof ps,o=i?t.code:"UNKNOWN_ERROR",s=i?t.userMessage:"An unexpected error occurred",c=i?t.severity:"medium",d=i?{...t.context,...e}:e;console.error(`[${o}] ${t.message}`,{stack:t.stack,context:d,severity:c});const h=window.Alpine?.store?.("notifications");if(h)switch(c){case"low":h.showInfo(s);break;case"medium":h.showWarning(s);break;case"high":case"critical":h.showError(s);break}}async function bl(t,e={}){try{return await t()}catch(i){return wl(i,e),null}}const Ie={DATABASE_QUERY:"DATABASE_QUERY",LOCAL_STORAGE_ACCESS:"LOCAL_STORAGE_ACCESS",VALIDATION_FAILED:"VALIDATION_FAILED",FILE_READ:"FILE_READ",FILE_WRITE:"FILE_WRITE",PARSE_ERROR:"PARSE_ERROR"},zo={databaseError:(t,e)=>an(t,"Database operation failed",Ie.DATABASE_QUERY,"high",e),storageError:(t,e)=>an(t,"Failed to save data locally",Ie.LOCAL_STORAGE_ACCESS,"medium",e),validationError:(t,e,i)=>an(t,e,Ie.VALIDATION_FAILED,"low",i),parseError:(t,e)=>an(t,"Failed to parse input",Ie.PARSE_ERROR,"medium",e),fileError:(t,e,i)=>an(t,`Failed to ${e} file`,e==="read"?Ie.FILE_READ:Ie.FILE_WRITE,"medium",i)};function Jo(t,e="time",i={}){if(!t.match(/^\d{2}:\d{2}$/))throw zo.validationError(`Invalid time format for ${e}: ${t}`,`${e} must be in HH:MM format`,{...i,invalidValue:t});const[o,s]=t.split(":").map(Number);if(isNaN(o)||isNaN(s)||o<0||o>23||s<0||s>59)throw zo.validationError(`Invalid time values for ${e}: ${t}`,`${e}: Hours must be 00-23, minutes must be 00-59`,{...i,invalidValue:t})}function _l(){return{entries:[],showFillGapModal:!1,showEditModal:!1,gapStart:null,gapEnd:null,gapNaturalInput:"",editingEntry:null,editStartTime:"",editEndTime:"",selectedPeriod:"today",customStartDate:"",customEndDate:"",async init(){await this.loadEntries(),this.$el.addEventListener("entryAdded",()=>this.loadEntries()),this.$el.addEventListener("entryUpdated",()=>this.loadEntries()),this.$el.addEventListener("entryDeleted",()=>this.loadEntries()),window.addEventListener("pageChanged",t=>{t.detail.page==="timeline"&&this.loadEntries()})},getDateRange(){const t=new Date,e=new Date(t.getFullYear(),t.getMonth(),t.getDate());switch(this.selectedPeriod){case"today":return{start:e,end:new Date(e.getTime()+1440*60*1e3)};case"week":{const i=new Date(e);return i.setDate(e.getDate()-e.getDay()),{start:i,end:new Date(i.getTime()+10080*60*1e3)}}case"2-weeks":{const i=new Date(e);return i.setDate(e.getDate()-e.getDay()),i.setDate(i.getDate()-7),{start:i,end:new Date(i.getTime()+336*60*60*1e3)}}case"custom":return this.customStartDate&&this.customEndDate?{start:new Date(this.customStartDate),end:new Date(new Date(this.customEndDate).getTime()+1440*60*1e3)}:{start:e,end:new Date(e.getTime()+1440*60*1e3)};default:return{start:e,end:new Date(e.getTime()+1440*60*1e3)}}},async loadEntries(){const t=this.getDateRange();this.entries=await pt.entries.where("startTime").between(t.start,t.end).and(e=>!e.deletedAt).toArray()},async loadTodayEntries(){await this.loadEntries()},async selectPeriod(t){this.selectedPeriod=t,await this.loadEntries()},async applyCustomDateRange(){this.customStartDate&&this.customEndDate&&(this.selectedPeriod="custom",await this.loadEntries())},get timelineItems(){const t=[],e=[...this.entries].sort((c,d)=>c.startTime.getTime()-d.startTime.getTime()),i=new Date;if(i.setHours(8,0,0,0),e.length===0){const c=new Date;return c>i&&t.push({type:"gap",start:i,end:c,duration:Math.floor((c.getTime()-i.getTime())/1e3),timeLabel:jt(i)}),t}let o=i;for(const c of e)c.startTime>o&&t.push({type:"gap",start:o,end:c.startTime,duration:Math.floor((c.startTime.getTime()-o.getTime())/1e3),timeLabel:jt(o)}),t.push({type:"entry",entry:c,timeLabel:jt(c.startTime)}),o=c.endTime||c.startTime;const s=new Date;return o<s&&t.push({type:"gap",start:o,end:s,duration:Math.floor((s.getTime()-o.getTime())/1e3),timeLabel:jt(o)}),t},get totalTime(){return this.entries.reduce((t,e)=>t+(e.duration||0),0)},get periodLabel(){switch(this.selectedPeriod){case"today":return"Today's";case"week":return"This Week's";case"2-weeks":return"Last 2 Weeks'";case"custom":return this.customStartDate&&this.customEndDate?`${new Date(this.customStartDate).toLocaleDateString()} - ${new Date(this.customEndDate).toLocaleDateString()}`:"Custom";default:return"Today's"}},get dateRangeText(){const t=this.getDateRange(),e=t.start.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),i=new Date(t.end.getTime()-1).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});return this.selectedPeriod==="today"?e:`${e} - ${i}`},formatDuration(t){if(t<60)return`${t}s`;const e=Math.floor(t/60);if(e<60)return`${e}m`;const i=Math.floor(e/60),o=e%60;return o>0?`${i}h ${o}m`:`${i}h`},openFillGapModal(t){this.gapStart=t.start,this.gapEnd=t.end,this.gapNaturalInput="",this.showFillGapModal=!0},async fillGapWithActivity(t){if(!this.gapStart||!this.gapEnd)return;const e=Bt(this.gapStart),i=Nt(this.gapEnd),o=Math.floor((i.getTime()-e.getTime())/1e3),s={description:t.label,startTime:e,endTime:i,rawStartTime:this.gapStart,rawEndTime:this.gapEnd,duration:o,category:t.id,tags:[],syncStatus:"local",createdAt:new Date,updatedAt:new Date};await pt.entries.add(s),this.showFillGapModal=!1,await this.loadTodayEntries(),this.$el.dispatchEvent(new CustomEvent("entryAdded",{bubbles:!0}))},async fillGapNatural(){if(!this.gapNaturalInput.trim()||!this.gapStart||!this.gapEnd)return;const t=this.gapNaturalInput.trim(),e=this.$store?.activities;let i=null;if(e&&e.all&&(i=e.getByAlias?.(t)||e.all.find(o=>o.label.toLowerCase()===t.toLowerCase())),i)await this.fillGapWithActivity(i);else{const o=Bt(this.gapStart),s=Nt(this.gapEnd),c=Math.floor((s.getTime()-o.getTime())/1e3),d={description:t,startTime:o,endTime:s,rawStartTime:this.gapStart,rawEndTime:this.gapEnd,duration:c,tags:[],syncStatus:"local",createdAt:new Date,updatedAt:new Date};await pt.entries.add(d),this.showFillGapModal=!1,await this.loadTodayEntries(),this.$el.dispatchEvent(new CustomEvent("entryAdded",{bubbles:!0}))}},editEntry(t){this.editingEntry=t;const e=t.rawStartTime||t.startTime,i=t.rawEndTime||t.endTime;this.editStartTime=jt(e),this.editEndTime=i?jt(i):"",this.showEditModal=!0},async saveEntry(){if(!this.editingEntry)return;try{Jo(this.editStartTime,"start time",{component:"Timeline",function:"saveEntry"}),Jo(this.editEndTime,"end time",{component:"Timeline",function:"saveEntry"})}catch{return}const[t,e]=this.editStartTime.split(":").map(Number),[i,o]=this.editEndTime.split(":").map(Number),s=new Date(this.editingEntry.startTime);s.setHours(t,e,0,0);const c=new Date(this.editingEntry.startTime);c.setHours(i,o,0,0),c<=s&&c.setDate(c.getDate()+1);const d=Bt(s),h=Nt(c),m=Math.floor((h.getTime()-d.getTime())/1e3),S={description:this.editingEntry.description,startTime:d,endTime:h,rawStartTime:s,rawEndTime:c,duration:m,projectId:this.editingEntry.projectId,tags:Array.isArray(this.editingEntry.tags)?[...this.editingEntry.tags]:[],category:this.editingEntry.category,subcategory:this.editingEntry.subcategory,syncStatus:"local",createdAt:new Date,updatedAt:new Date,prototypeId:this.editingEntry.id};await pt.entries.update(this.editingEntry.id,{deletedAt:new Date,updatedAt:new Date}),await hs.addEntryWithOverlapHandling(S),this.showEditModal=!1,await this.loadTodayEntries(),this.$el.dispatchEvent(new CustomEvent("entryUpdated",{bubbles:!0}))},async deleteEntry(){if(!this.editingEntry?.id)return;await bl(()=>pt.entries.update(this.editingEntry.id,{deletedAt:new Date,updatedAt:new Date}),{component:"Timeline",function:"deleteEntry",action:"delete_entry"})!==null&&(this.showEditModal=!1,await this.loadTodayEntries(),this.$el.dispatchEvent(new CustomEvent("entryDeleted",{bubbles:!0})))},getActivityColor(t){if(t.category){const e=this.$store?.activities;if(e?.all){const i=e.all.find(o=>o.id===t.category);if(i?.color)return i.color}try{const i=JSON.parse(localStorage.getItem("appSettings")||"{}");if(i.categories){const o=i.categories.find(s=>s.id===t.category);if(o?.color)return o.color}}catch{}}return"#6b7280"},getActivityIcon(t){if(t.category){const e=this.$store?.activities;if(e?.all)return e.all.find(o=>o.id===t.category)?.icon||""}return""},async exportTimeline(){if(this.entries.length===0){window.Alpine.store("notifications").showWarning("No entries to export");return}const t=this.generateTimelineReport(),e=`timetracker-timeline-${this.selectedPeriod}-${new Date().toISOString().split("T")[0]}.md`;await this.saveFileWithPicker(t,e,"text/markdown")},generateTimelineReport(){let t=`# Time Tracker Timeline - ${this.periodLabel.replace("'s","")} Report

`;if(t+=`**Generated:** ${new Date().toLocaleString()}
`,t+=`**Period:** ${this.dateRangeText}

`,t+=`## Summary

`,t+=`- **Total Time Tracked:** ${this.formatDuration(this.totalTime)}
`,t+=`- **Total Entries:** ${this.entries.length}
`,this.entries.length>0){const o=this.totalTime/this.entries.length;t+=`- **Average Entry Duration:** ${this.formatDuration(o)}
`}t+=`
`;const e=this.calculateActivityBreakdown();if(e.length>0){t+=`## Activity Breakdown

`;for(const o of e){const s=this.totalTime>0?(o.totalTime/this.totalTime*100).toFixed(1):"0";t+=`- **${o.icon} ${o.name}:** ${this.formatDuration(o.totalTime)} (${s}%) - ${o.count} ${o.count===1?"entry":"entries"}
`}t+=`
`}const i=this.groupEntriesByDay();for(const[o,s]of i){const c=s.reduce((h,m)=>h+(m.duration||0),0);t+=`## ${this.formatDateHeader(o)}

`,t+=`**Daily Total:** ${this.formatDuration(c)}

`;const d=[...s].sort((h,m)=>h.startTime.getTime()-m.startTime.getTime());for(const h of d){const m=jt(h.rawStartTime||h.startTime),S=h.rawEndTime||h.endTime?jt(h.rawEndTime||h.endTime):"ongoing",O=this.getActivityIcon(h),C=this.formatDuration(h.duration||0);t+=`- **${m} - ${S}:** ${O} ${h.description} _(${C})_
`}t+=`
`}return t+=`## Raw Data

`,t+=`Total entries exported: ${this.entries.length}
`,t+=`Export date: ${new Date().toISOString()}
`,t},calculateActivityBreakdown(){const t=new Map;for(const e of this.entries){const i=e.category||"unknown",o=e.duration||0,s=this.getActivityIcon(e),c=e.description.split(":")[0]||e.description;t.has(i)||t.set(i,{name:c,icon:s,totalTime:0,count:0});const d=t.get(i);d.totalTime+=o,d.count++}return Array.from(t.values()).sort((e,i)=>i.totalTime-e.totalTime)},groupEntriesByDay(){const t=new Map;for(const i of this.entries){const o=i.startTime.toDateString();t.has(o)||t.set(o,[]),t.get(o).push(i)}return new Map([...t.entries()].sort((i,o)=>new Date(i[0]).getTime()-new Date(o[0]).getTime()))},formatDateHeader(t){return new Date(t).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})},async saveFileWithPicker(t,e,i){try{const o=this.getSettings();if(!(o.defaultExportPath&&o.defaultExportHandle)){await this.promptForExportLocation(t,e,i);return}const c=await this.showExportLocationDialog(o.defaultExportPath,e);if(c==="default")try{const h=await(await o.defaultExportHandle.getFileHandle(e,{create:!0})).createWritable();await h.write(t),await h.close(),window.Alpine.store("notifications").showSuccess(`Timeline exported to ${o.defaultExportPath}/${e}`);return}catch(d){console.warn("Default directory failed, falling back to picker:",d),window.Alpine.store("notifications").showWarning("Default folder not accessible, showing file picker"),await this.promptForExportLocation(t,e,i);return}else if(c==="choose"){await this.promptForExportLocation(t,e,i);return}}catch(o){console.error("Export dialog failed:",o),await this.promptForExportLocation(t,e,i)}},async showExportLocationDialog(t,e){return new Promise(i=>{const o=document.createElement("div");o.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",o.innerHTML=`
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md mx-4 shadow-xl">
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Export Location</h3>
          <p class="text-sm text-gray-600 dark:text-gray-400 mb-6">Where would you like to export <strong>${e}</strong>?</p>
          
          <div class="space-y-3 mb-6">
            <button id="exportDefault" class="w-full p-3 text-left border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
              <div class="font-medium text-gray-900 dark:text-white"> Default Folder</div>
              <div class="text-sm text-gray-500 dark:text-gray-400 truncate">${t}</div>
            </button>
            
            <button id="exportChoose" class="w-full p-3 text-left border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
              <div class="font-medium text-gray-900 dark:text-white"> Choose Location</div>
              <div class="text-sm text-gray-500 dark:text-gray-400">Pick a different folder</div>
            </button>
          </div>
          
          <div class="flex justify-end gap-2">
            <button id="exportCancel" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200">Cancel</button>
          </div>
        </div>
      `,document.body.appendChild(o);const s=()=>{document.body.removeChild(o)};o.querySelector("#exportDefault")?.addEventListener("click",()=>{s(),i("default")}),o.querySelector("#exportChoose")?.addEventListener("click",()=>{s(),i("choose")}),o.querySelector("#exportCancel")?.addEventListener("click",()=>{s(),i("cancel")}),o.addEventListener("click",c=>{c.target===o&&(s(),i("cancel"))})})},async promptForExportLocation(t,e,i){if("showSaveFilePicker"in window)try{const s=await(await window.showSaveFilePicker({suggestedName:e,types:[{description:i.includes("json")?"JSON files":"Markdown files",accept:{[i]:[`.${e.split(".").pop()}`]}}]})).createWritable();await s.write(t),await s.close(),window.Alpine.store("notifications").showSuccess(`Timeline exported as ${e}`)}catch(o){o.name!=="AbortError"&&(console.warn("File picker failed, falling back to download:",o),this.downloadFile(t,e,i))}else this.downloadFile(t,e,i)},downloadFile(t,e,i){const o=new Blob([t],{type:i}),s=URL.createObjectURL(o),c=document.createElement("a");c.href=s,c.download=e,c.click(),URL.revokeObjectURL(s)},getSettings(){try{const t=localStorage.getItem("appSettings");return t?JSON.parse(t):{}}catch(t){return console.error("Error loading settings:",t),{}}}}}const Sl=()=>({entries:[],activities:[],loading:!1,selectedPeriod:"week",customStartDate:"",customEndDate:"",summary:null,activityStats:[],dailyStats:[],hourlyStats:[],selectedChart:"activities",async init(){await this.loadSettings(),await this.loadData()},async loadSettings(){try{const t=JSON.parse(localStorage.getItem("appSettings")||"{}");this.activities=t.categories||[]}catch(t){console.error("Failed to load settings:",t),this.activities=[]}},async loadData(){this.loading=!0;try{const t=this.getDateRange();this.entries=await pt.entries.where("startTime").between(t.start,t.end).and(e=>!e.deletedAt).toArray(),await this.calculateAnalytics()}catch(t){console.error("Failed to load insights data:",t)}finally{this.loading=!1}},getDateRange(){const t=new Date,e=new Date(t.getFullYear(),t.getMonth(),t.getDate());switch(this.selectedPeriod){case"today":return{start:e,end:new Date(e.getTime()+1440*60*1e3)};case"week":{const i=new Date(e);return i.setDate(e.getDate()-e.getDay()),{start:i,end:new Date(i.getTime()+10080*60*1e3)}}case"month":{const i=new Date(e.getFullYear(),e.getMonth(),1),o=new Date(e.getFullYear(),e.getMonth()+1,1);return{start:i,end:o}}case"custom":return this.customStartDate&&this.customEndDate?{start:new Date(this.customStartDate),end:new Date(new Date(this.customEndDate).getTime()+1440*60*1e3)}:this.getDateRange();default:return this.getDateRange()}},async calculateAnalytics(){if(!this.entries.length){this.resetAnalytics();return}this.activityStats=this.calculateActivityStats(),this.dailyStats=this.calculateDailyStats(),this.hourlyStats=this.calculateHourlyStats(),this.summary=this.calculateSummary()},resetAnalytics(){this.summary=null,this.activityStats=[],this.dailyStats=[],this.hourlyStats=[]},calculateActivityStats(){const t=new Map;for(const o of this.entries){const s=o.category||"unknown",c=o.duration||0;t.has(s)||t.set(s,{totalSeconds:0,sessions:[],entryCount:0});const d=t.get(s);d.totalSeconds+=c,d.sessions.push(c),d.entryCount++}const e=Array.from(t.values()).reduce((o,s)=>o+s.totalSeconds,0),i=[];for(const[o,s]of t){const c=this.activities.find(d=>d.id===o)||{label:o==="unknown"?"Unknown":o,icon:"",color:"#6b7280"};i.push({id:o,label:c.label,icon:c.icon,color:c.color,totalSeconds:s.totalSeconds,entryCount:s.entryCount,percentage:e>0?s.totalSeconds/e*100:0,avgSessionDuration:s.sessions.length>0?s.totalSeconds/s.sessions.length:0,longestSession:Math.max(...s.sessions,0),shortestSession:Math.min(...s.sessions,0)})}return i.sort((o,s)=>s.totalSeconds-o.totalSeconds)},calculateDailyStats(){const t=new Map;for(const i of this.entries){const o=i.startTime.toDateString(),s=i.category||"unknown",c=i.duration||0;t.has(o)||t.set(o,{totalSeconds:0,entryCount:0,activities:{}});const d=t.get(o);d.totalSeconds+=c,d.entryCount++,d.activities[s]=(d.activities[s]||0)+c}const e=Math.max(...Array.from(t.values()).map(i=>i.totalSeconds),1);return Array.from(t.entries()).map(([i,o])=>({date:i,totalSeconds:o.totalSeconds,entryCount:o.entryCount,activities:o.activities,productivity:o.totalSeconds/e})).sort((i,o)=>new Date(i.date).getTime()-new Date(o.date).getTime())},calculateHourlyStats(){const t=new Map;for(const e of this.entries){const i=e.startTime.getHours(),o=e.category||"unknown",s=e.duration||0;t.has(i)||t.set(i,{totalSeconds:0,activityBreakdown:{}});const c=t.get(i);c.totalSeconds+=s,c.activityBreakdown[o]=(c.activityBreakdown[o]||0)+s}return Array.from({length:24},(e,i)=>({hour:i,totalSeconds:t.get(i)?.totalSeconds||0,activityBreakdown:t.get(i)?.activityBreakdown||{}}))},calculateSummary(){const t=this.entries.reduce((C,$)=>C+($.duration||0),0),e=new Set(this.entries.map(C=>C.startTime.toDateString())).size,i=e>0?t/e:0,s=this.dailyStats.map(C=>({date:C.date,total:C.totalSeconds})).reduce((C,$)=>$.total>C.total?$:C,{date:"",total:0}).date,c=this.activityStats.length>0?this.activityStats[0].label:"None",d=this.dailyStats.sort((C,$)=>new Date(C.date).getTime()-new Date($.date).getTime());let h=0,m=0,S=0;const O=new Date().toDateString();for(let C=0;C<d.length;C++)C===0||new Date(d[C].date).getTime()-new Date(d[C-1].date).getTime()<=1440*60*1e3+36e5?(S++,(d[C].date===O||C===d.length-1)&&(h=S)):(m=Math.max(m,S),S=1);return m=Math.max(m,S),{totalTracked:t,totalDays:e,avgDailyTracking:i,mostProductiveDay:s,favoriteActivity:c,longestStreak:m,currentStreak:h}},async selectPeriod(t){this.selectedPeriod=t,await this.loadData()},async applyCustomDateRange(){this.customStartDate&&this.customEndDate&&(this.selectedPeriod="custom",await this.loadData())},selectChart(t){this.selectedChart=t},formatDuration(t){if(t<60)return`${Math.round(t)}s`;const e=Math.floor(t/60);if(e<60)return`${e}m`;const i=Math.floor(e/60),o=e%60;return o>0?`${i}h ${o}m`:`${i}h`},formatTime(t){return yl(t)},formatDate(t){return new Date(t).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})},formatPercentage(t){return`${Math.round(t)}%`},get insights(){const t=[];if(!this.summary||!this.activityStats.length)return["Start tracking time to see insights"];this.summary.avgDailyTracking>4*3600?t.push(" Great consistency! You're averaging over 4 hours of tracked time per day"):this.summary.avgDailyTracking<2*3600&&t.push(" Try tracking more activities to get better insights into your time usage");const e=this.activityStats[0];e.percentage>60?t.push(` You spend ${Math.round(e.percentage)}% of your time on ${e.label} - consider diversifying`):e.percentage<25&&this.activityStats.length>1&&t.push(" Your time is well-distributed across multiple activities");const i=e.avgSessionDuration;i>2*3600?t.push(" Your sessions tend to be long - consider taking breaks for better focus"):i<1800&&t.push(" Your sessions are short - this can be great for maintaining focus"),this.summary.currentStreak>=7?t.push(` Amazing! You're on a ${this.summary.currentStreak}-day tracking streak!`):this.summary.currentStreak>=3&&t.push(` Good momentum! ${this.summary.currentStreak} days tracked in a row`);const o=this.hourlyStats.slice(9,17).reduce((d,h)=>d+h.totalSeconds,0),s=this.hourlyStats.reduce((d,h)=>d+h.totalSeconds,0),c=s>0?o/s:0;return c>.8?t.push(" Most of your tracked time is during standard working hours"):c<.4&&t.push(" You do a lot of work outside standard business hours"),t.slice(0,4)},async exportInsights(){if(!this.summary){window.Alpine.store("notifications").showError("No data to export");return}const t=this.selectedPeriod==="custom"&&this.customStartDate&&this.customEndDate?`${this.customStartDate} to ${this.customEndDate}`:this.selectedPeriod.charAt(0).toUpperCase()+this.selectedPeriod.slice(1),e=this.generateInsightsReport(t);await this.saveFileWithPicker(e,`timetracker-insights-${this.selectedPeriod}-${new Date().toISOString().split("T")[0]}.md`,"text/markdown")},generateInsightsReport(t){const e=t,i=this.getDateRange();let o=`# Time Tracking Insights - ${e}

`;if(o+=`**Generated:** ${new Date().toLocaleString()}
`,o+=`**Period:** ${i.start.toLocaleDateString()} - ${i.end.toLocaleDateString()}

`,this.summary&&(o+=`## Summary

`,o+=`- **Total Time Tracked:** ${this.formatDuration(this.summary.totalTracked)}
`,o+=`- **Days with Activity:** ${this.summary.totalDays}
`,o+=`- **Average per Day:** ${this.formatDuration(this.summary.avgDailyTracking)}
`,o+=`- **Current Streak:** ${this.summary.currentStreak} days
`,o+=`- **Longest Streak:** ${this.summary.longestStreak} days
`,o+=`- **Favorite Activity:** ${this.summary.favoriteActivity}
`,this.summary.mostProductiveDay&&(o+=`- **Most Productive Day:** ${this.formatDate(this.summary.mostProductiveDay)}
`),o+=`
`),this.activityStats.length>0){o+=`## Activity Breakdown

`;for(const c of this.activityStats)o+=`### ${c.icon} ${c.label}
`,o+=`- **Total Time:** ${this.formatDuration(c.totalSeconds)} (${this.formatPercentage(c.percentage)})
`,o+=`- **Sessions:** ${c.entryCount}
`,o+=`- **Average Session:** ${this.formatDuration(c.avgSessionDuration)}
`,o+=`- **Longest Session:** ${this.formatDuration(c.longestSession)}
`,o+=`- **Shortest Session:** ${this.formatDuration(c.shortestSession)}

`}if(this.dailyStats.length>0){o+=`## Daily Patterns

`;const c=[...this.dailyStats].sort((d,h)=>new Date(d.date).getTime()-new Date(h.date).getTime());for(const d of c){const h=Math.round(d.productivity*100);o+=`- **${this.formatDate(d.date)}:** ${this.formatDuration(d.totalSeconds)} (${d.entryCount} sessions, ${h}% productivity)
`}o+=`
`}if(this.hourlyStats.length>0){const c=this.hourlyStats.filter(d=>d.totalSeconds>0);if(c.length>0){o+=`## Time Distribution

`,o+=`### Most Active Hours

`;const d=[...c].sort((S,O)=>O.totalSeconds-S.totalSeconds).slice(0,5);for(const S of d){const O=`${S.hour.toString().padStart(2,"0")}:00`,C=this.summary?(S.totalSeconds/this.summary.totalTracked*100).toFixed(1):"0";o+=`- **${O}:** ${this.formatDuration(S.totalSeconds)} (${C}%)
`}o+=`
`;const h=this.hourlyStats.slice(9,17).reduce((S,O)=>S+O.totalSeconds,0),m=this.hourlyStats.reduce((S,O)=>S+O.totalSeconds,0);if(m>0){const S=(h/m*100).toFixed(1);o+=`### Working Hours Analysis

`,o+=`- **9 AM - 5 PM:** ${this.formatDuration(h)} (${S}% of total)
`,o+=`- **Outside Hours:** ${this.formatDuration(m-h)} (${(100-parseFloat(S)).toFixed(1)}% of total)

`}}}const s=this.insights;if(s.length>0){o+=`## Key Insights

`;for(const c of s)o+=`- ${c}
`;o+=`
`}if(this.dailyStats.length>1){o+=`## Productivity Analysis

`;const c=this.dailyStats.reduce((h,m)=>h+m.productivity,0)/this.dailyStats.length,d=[...this.dailyStats].sort((h,m)=>m.productivity-h.productivity).slice(0,3);o+=`- **Average Daily Productivity:** ${Math.round(c*100)}%
`,o+=`- **Most Productive Days:**
`;for(const h of d)o+=`  - ${this.formatDate(h.date)}: ${Math.round(h.productivity*100)}% (${this.formatDuration(h.totalSeconds)})
`;o+=`
`}return o+=`## Data Summary

`,o+=`- **Total Entries:** ${this.entries.length}
`,o+=`- **Date Range:** ${i.start.toDateString()} to ${i.end.toDateString()}
`,o+=`- **Export Date:** ${new Date().toISOString()}
`,o+=`- **Period Type:** ${this.selectedPeriod}
`,o},async saveFileWithPicker(t,e,i){try{const o=this.getSettings();if(!(o.defaultExportPath&&o.defaultExportHandle)){await this.promptForExportLocation(t,e,i);return}const c=await this.showExportLocationDialog(o.defaultExportPath,e);if(c==="default")try{const h=await(await o.defaultExportHandle.getFileHandle(e,{create:!0})).createWritable();await h.write(t),await h.close(),window.Alpine.store("notifications").showSuccess(`Insights exported to ${o.defaultExportPath}/${e}`);return}catch(d){console.warn("Default directory failed, falling back to picker:",d),window.Alpine.store("notifications").showWarning("Default folder not accessible, showing file picker"),await this.promptForExportLocation(t,e,i);return}else if(c==="choose"){await this.promptForExportLocation(t,e,i);return}}catch(o){console.error("Export dialog failed:",o),await this.promptForExportLocation(t,e,i)}},async showExportLocationDialog(t,e){return new Promise(i=>{const o=document.createElement("div");o.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",o.innerHTML=`
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md mx-4 shadow-xl">
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Export Location</h3>
          <p class="text-sm text-gray-600 dark:text-gray-400 mb-6">Where would you like to export <strong>${e}</strong>?</p>
          
          <div class="space-y-3 mb-6">
            <button id="exportDefault" class="w-full p-3 text-left border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
              <div class="font-medium text-gray-900 dark:text-white"> Default Folder</div>
              <div class="text-sm text-gray-500 dark:text-gray-400 truncate">${t}</div>
            </button>
            
            <button id="exportChoose" class="w-full p-3 text-left border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
              <div class="font-medium text-gray-900 dark:text-white"> Choose Location</div>
              <div class="text-sm text-gray-500 dark:text-gray-400">Pick a different folder</div>
            </button>
          </div>
          
          <div class="flex justify-end gap-2">
            <button id="exportCancel" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200">Cancel</button>
          </div>
        </div>
      `,document.body.appendChild(o);const s=()=>{document.body.removeChild(o)};o.querySelector("#exportDefault")?.addEventListener("click",()=>{s(),i("default")}),o.querySelector("#exportChoose")?.addEventListener("click",()=>{s(),i("choose")}),o.querySelector("#exportCancel")?.addEventListener("click",()=>{s(),i("cancel")}),o.addEventListener("click",c=>{c.target===o&&(s(),i("cancel"))})})},async promptForExportLocation(t,e,i){if("showSaveFilePicker"in window)try{const s=await(await window.showSaveFilePicker({suggestedName:e,types:[{description:i.includes("json")?"JSON files":"Markdown files",accept:{[i]:[`.${e.split(".").pop()}`]}}]})).createWritable();await s.write(t),await s.close(),window.Alpine.store("notifications").showSuccess(`Insights exported as ${e}`)}catch(o){o.name!=="AbortError"&&(console.warn("File picker failed, falling back to download:",o),this.downloadFile(t,e,i))}else this.downloadFile(t,e,i)},getSettings(){try{const t=localStorage.getItem("appSettings");return t?JSON.parse(t):{}}catch(t){return console.error("Error loading settings:",t),{}}},downloadFile(t,e,i){const o=new Blob([t],{type:i}),s=URL.createObjectURL(o),c=document.createElement("a");c.href=s,c.download=e,c.click(),URL.revokeObjectURL(s)}}),xl="modulepreload",Tl=function(t){return"/"+t},Yo={},St=function(e,i,o){let s=Promise.resolve();if(i&&i.length>0){let m=function(S){return Promise.all(S.map(O=>Promise.resolve(O).then(C=>({status:"fulfilled",value:C}),C=>({status:"rejected",reason:C}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),h=d?.nonce||d?.getAttribute("nonce");s=m(i.map(S=>{if(S=Tl(S),S in Yo)return;Yo[S]=!0;const O=S.endsWith(".css"),C=O?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${S}"]${C}`))return;const $=document.createElement("link");if($.rel=O?"stylesheet":xl,O||($.as="script"),$.crossOrigin="",$.href=S,h&&$.setAttribute("nonce",h),document.head.appendChild($),O)return new Promise((K,V)=>{$.addEventListener("load",K),$.addEventListener("error",()=>V(new Error(`Unable to preload CSS for ${S}`)))})}))}function c(d){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=d,window.dispatchEvent(h),!h.defaultPrevented)throw d}return s.then(d=>{for(const h of d||[])h.status==="rejected"&&c(h.reason);return e().catch(c)})},ri=150,Go=300,El=[{value:2,label:"2s"},{value:5,label:"5s"},{value:10,label:"10s"},{value:15,label:"15s"},{value:20,label:"20s"},{value:30,label:"30s"},{value:60,label:"1m"},{value:90,label:"1.5m"},{value:120,label:"2m"},{value:150,label:"2.5m"},{value:180,label:"3m"},{value:300,label:"5m"},{value:600,label:"10m"},{value:900,label:"15m"}],kl=[{value:null,label:"Inherit default (12h)"},{value:0,label:"Unlimited"},{value:1,label:"1 hour"},{value:2,label:"2 hours"},{value:4,label:"4 hours"},{value:8,label:"8 hours"},{value:12,label:"12 hours"},{value:16,label:"16 hours"},{value:20,label:"20 hours"},{value:24,label:"24 hours"}],Al=[{value:null,label:"Default (no rounding)"},{value:0,label:"No rounding"},{value:1,label:"Round to seconds"},{value:30,label:"Snap to 30s slots (0s, 30s)"},{value:60,label:"Snap to minutes"},{value:300,label:"Snap to 5min slots"},{value:600,label:"Snap to 10min slots"},{value:900,label:"Snap to 15min slots"},{value:1200,label:"Snap to 20min slots"},{value:1500,label:"Snap to 25/30min slots"},{value:1800,label:"Snap to 30min slots"},{value:2700,label:"Snap to 45min slots"},{value:3300,label:"Snap to 55min slots"},{value:3600,label:"Snap to hours"}],Dl=[{name:"Professional",description:"Work-focused categories with meetings and breaks",categories:[{id:"work",label:"Work",icon:"",color:"#6366f1",subcategories:["coding","planning","research","review"],subcategoriesText:"coding, planning, research, review",maxDuration:null},{id:"meeting",label:"Meeting",icon:"",color:"#f59e0b",subcategories:["standup","meeting planning","meeting review","call"],subcategoriesText:"standup, meeting planning, meeting review, call",maxDuration:null},{id:"break",label:"Break",icon:"",color:"#10b981",subcategories:["lunch","coffee","rest"],subcategoriesText:"lunch, coffee, rest",maxDuration:null},{id:"admin",label:"Admin",icon:"",color:"#8b5cf6",subcategories:["email","scheduling","documentation"],subcategoriesText:"email, scheduling, documentation",maxDuration:null}]},{name:"Personal Life",description:"Life balance with work, personal, and health activities",categories:[{id:"work",label:"Work",icon:"",color:"#6366f1",subcategories:["focused work","meetings","work admin"],subcategoriesText:"focused work, meetings, work admin",maxDuration:null},{id:"personal",label:"Personal",icon:"",color:"#ec4899",subcategories:["life planning","personal reading","family","hobbies"],subcategoriesText:"life planning, personal reading, family, hobbies",maxDuration:null},{id:"health",label:"Health",icon:"",color:"#06b6d4",subcategories:["exercise","meditation","meal prep"],subcategoriesText:"exercise, meditation, meal prep",maxDuration:null},{id:"break",label:"Break",icon:"",color:"#10b981",subcategories:["personal lunch","personal rest","social"],subcategoriesText:"personal lunch, personal rest, social",maxDuration:null}]},{name:"Student",description:"Study-focused with classes, homework, and breaks",categories:[{id:"study",label:"Study",icon:"",color:"#6366f1",subcategories:["study reading","notes","practice","study research"],subcategoriesText:"study reading, notes, practice, study research",maxDuration:null},{id:"class",label:"Class",icon:"",color:"#f59e0b",subcategories:["lecture","lab","seminar","discussion"],subcategoriesText:"lecture, lab, seminar, discussion",maxDuration:null},{id:"assignment",label:"Assignment",icon:"",color:"#ef4444",subcategories:["homework","project","essay","presentation"],subcategoriesText:"homework, project, essay, presentation",maxDuration:null},{id:"break",label:"Break",icon:"",color:"#10b981",subcategories:["student lunch","student rest","student social","exercise"],subcategoriesText:"student lunch, student rest, student social, exercise",maxDuration:null}]}],Ol=()=>({durationThreshold:ri,timeRounding:Go,thresholdOptions:El,maxDurationOptions:kl,timeRoundingOptions:Al,exportStartDate:"",exportEndDate:"",exportFormat:"json",exportCompression:"none",settingsExportFormat:"yaml",settingsImportFile:null,settingsImportPreview:null,settingsImportFormat:"",settingsImportValidation:null,showImportPreview:!1,settingsBackups:[],showBackups:!1,defaultExportPath:"",defaultExportHandle:null,categories:[],showAdvanced:!1,currentPreset:"Professional",settingsSnapshot:null,justSaved:!1,presets:Dl,getThresholdLabel(){const t=this.thresholdOptions.find(e=>e.value===this.durationThreshold);return t?t.label:`${this.durationThreshold}s`},getMaxDurationLabel(t){if(t.maxDuration===null)return"Inherit default";if(t.maxDuration===0)return"Unlimited";const e=this.maxDurationOptions.find(i=>i.value===t.maxDuration);return e?e.label:`${t.maxDuration} hours`},getTimeRoundingLabel(){const t=this.timeRoundingOptions.find(e=>e.value===this.timeRounding);return t?t.label:"Custom"},getTimeRoundingSetting(){return this.timeRounding},init(){this.loadSettings(),this.createSnapshot(),this.watchForChanges(),this.loadSettingsBackups()},createSnapshot(){this.settingsSnapshot={durationThreshold:this.durationThreshold,categories:JSON.parse(JSON.stringify(this.categories)),currentPreset:this.currentPreset}},watchForChanges(){this.$watch("durationThreshold",()=>this.autoSave()),this.$watch("categories",()=>this.autoSave(),{deep:!0})},autoSave(){const t=this.validateCategories();if(!t.isValid){window.Alpine.store("notifications").showError(t.message),this.cancelChanges();return}this.currentPreset=this.detectCurrentPreset(),this.saveSettings(!1),this.justSaved=!0,setTimeout(()=>{this.justSaved=!1},1500)},detectCurrentPreset(){for(const t of this.presets)if(this.categoriesMatchPreset(t))return t.name;return"Custom"},categoriesMatchPreset(t){return this.categories.length!==t.categories.length?!1:this.categories.every(e=>{const i=t.categories.find(o=>o.id===e.id);return i?e.label===i.label&&e.icon===i.icon&&e.color===i.color&&JSON.stringify(e.subcategories)===JSON.stringify(i.subcategories):!1})},loadSettings(){try{const t=localStorage.getItem("appSettings");if(t){const e=JSON.parse(t);this.durationThreshold=e.durationThreshold??ri,this.timeRounding=e.timeRounding??Go,this.categories=e.categories??this.getDefaultCategories(),this.categories.forEach(i=>{i.maxDuration===void 0&&(i.maxDuration=null),delete i.subcategoryBehavior,delete i.defaultSubcategory,delete i.lastUsedSubcategory}),this.currentPreset=this.detectCurrentPreset()}else this.applyPreset(this.presets[0])}catch(t){console.error("Error loading settings:",t),this.resetToDefaults()}},getDefaultCategories(){return JSON.parse(JSON.stringify(this.presets[0].categories))},async applyPreset(t){try{const{createSettingsBackup:e}=await St(async()=>{const{createSettingsBackup:o}=await import("./settings-backup-D_tuVzAd.js");return{createSettingsBackup:o}},[]),i={durationThreshold:this.durationThreshold,timeRounding:this.timeRounding,categories:this.categories,currentPreset:this.currentPreset,defaultExportPath:this.defaultExportPath};e(i,`Before applying ${t.name} preset`,"preset")}catch(e){console.warn("Failed to create backup before preset application:",e)}this.categories=JSON.parse(JSON.stringify(t.categories)),this.currentPreset=t.name,this.showAdvanced=!1,this.createSnapshot(),this.saveSettings(!1),this.loadSettingsBackups(),this.notifyActivitiesUpdate(),this.justSaved=!0,setTimeout(()=>{this.justSaved=!1},2e3)},addCategory(){const t={id:`custom_${Date.now()}`,label:"New Category",icon:"",color:"#6b7280",subcategories:[],subcategoriesText:"",maxDuration:null};this.categories.push(t)},removeCategory(t){if(this.categories.length<=1){window.Alpine.store("notifications").showWarning("You must have at least one category");return}this.categories.splice(t,1)},toggleSubcategories(t){const e=this.categories.find(i=>i.id===t);e&&(e.showSub=!e.showSub)},updateSubcategories(t){const e=t.subcategoriesText.split(",").map(c=>c.trim().toLowerCase()).filter(c=>c.length>0),i=this.findDuplicateSubcategories(t.id,e),o=this.findCategoryNameConflicts(e),s=[...i,...o];if(s.length>0){const c=s.map(h=>h.type==="duplicate"?`"${h.name}" (already in ${h.categoryLabel})`:`"${h.name}" (matches category name)`).join(", ");window.Alpine.store("notifications").showError(`Invalid subcategories: ${c}. Subcategory names cannot match category names or be duplicated across categories.`);const d=e.filter(h=>!s.some(m=>m.name===h));t.subcategories=d,t.subcategoriesText=d.join(", ")}else t.subcategories=e},findDuplicateSubcategories(t,e){const i=[];for(const o of e)for(const s of this.categories)if(s.id!==t&&s.subcategories.map(d=>d.toLowerCase()).includes(o.toLowerCase())){i.push({name:o,categoryLabel:s.label,type:"duplicate"});break}return i},findCategoryNameConflicts(t){const e=[];for(const i of t)for(const o of this.categories)if(o.label.toLowerCase()===i.toLowerCase()){e.push({name:i,type:"category"});break}return e},validateCategories(){for(const i of this.categories)for(const o of this.categories)if(i.id!==o.id&&o.subcategories.map(c=>c.toLowerCase()).includes(i.label.toLowerCase()))return{isValid:!1,message:`Category name "${i.label}" conflicts with existing subcategory in ${o.label}. Category names cannot match any subcategory names.`};return this.categories.map(i=>i.label.toLowerCase()).filter((i,o,s)=>s.indexOf(i)!==o&&s.indexOf(i)!==-1).length>0?{isValid:!1,message:"Duplicate category names found. Each category must have a unique name."}:{isValid:!0,message:""}},saveSettings(t=!0){try{const e={durationThreshold:this.durationThreshold,timeRounding:this.timeRounding,categories:this.categories,currentPreset:this.currentPreset,savedAt:new Date().toISOString()};localStorage.setItem("appSettings",JSON.stringify(e)),this.notifyActivitiesUpdate(),t&&window.Alpine.store("notifications").showSuccess("Settings saved successfully")}catch(e){console.error("Error saving settings:",e),t&&window.Alpine.store("notifications").showError("Failed to save settings")}},cancelChanges(){this.settingsSnapshot&&(this.durationThreshold=this.settingsSnapshot.durationThreshold,this.categories=JSON.parse(JSON.stringify(this.settingsSnapshot.categories)),this.currentPreset=this.settingsSnapshot.currentPreset,this.saveSettings(!1),this.notifyActivitiesUpdate(),this.justSaved=!0,setTimeout(()=>{this.justSaved=!1},1500))},hasChanges(){return this.settingsSnapshot?this.durationThreshold!==this.settingsSnapshot.durationThreshold||JSON.stringify(this.categories)!==JSON.stringify(this.settingsSnapshot.categories):!1},async resetToDefaults(){try{const{createSettingsBackup:t}=await St(async()=>{const{createSettingsBackup:i}=await import("./settings-backup-D_tuVzAd.js");return{createSettingsBackup:i}},[]),e={durationThreshold:this.durationThreshold,timeRounding:this.timeRounding,categories:this.categories,currentPreset:this.currentPreset,defaultExportPath:this.defaultExportPath};t(e,"Before resetting to defaults","reset")}catch(t){console.warn("Failed to create backup before reset:",t)}this.durationThreshold=ri,this.categories=JSON.parse(JSON.stringify(this.presets[0].categories)),this.currentPreset=this.presets[0].name,this.showAdvanced=!1,this.createSnapshot(),this.saveSettings(!1),this.loadSettingsBackups(),this.notifyActivitiesUpdate(),this.justSaved=!0,setTimeout(()=>{this.justSaved=!1},2e3)},notifyActivitiesUpdate(){window.dispatchEvent(new CustomEvent("activities-updated",{detail:{categories:this.categories,durationThreshold:this.durationThreshold}}))},async exportData(){try{const{db:t}=await St(async()=>{const{db:m}=await Promise.resolve().then(()=>qo);return{db:m}},void 0);let e=null,i=null;this.exportStartDate&&(e=new Date(this.exportStartDate),e.setHours(0,0,0,0)),this.exportEndDate&&(i=new Date(this.exportEndDate),i.setHours(23,59,59,999));let o=t.entries.orderBy("startTime");e&&i?o=o.and(m=>!m.deletedAt&&m.startTime>=e&&m.startTime<=i):e?o=o.and(m=>!m.deletedAt&&m.startTime>=e):i?o=o.and(m=>!m.deletedAt&&m.startTime<=i):o=o.and(m=>!m.deletedAt);const s=await o.toArray();if(s.length===0){window.Alpine.store("notifications").showWarning("No entries found for selected date range");return}let c,d,h;this.exportFormat==="json"?(c=await this.generateJSONExport(s),d=this.generateFilename("json"),h="application/json"):(c=await this.generateMarkdownExport(s),d=this.generateFilename("md"),h="text/markdown"),await this.saveFileWithPicker(c,d,h)}catch(t){console.error("Export failed:",t),window.Alpine.store("notifications").showError("Failed to export data")}},async generateJSONExport(t){const{db:e}=await St(async()=>{const{db:s}=await Promise.resolve().then(()=>qo);return{db:s}},void 0),i=await e.projects.toArray(),o={metadata:{exportDate:new Date().toISOString(),version:"2.0",appName:"Pragmatic Focus Time Tracker",dateRange:{start:this.exportStartDate||null,end:this.exportEndDate||null},totalEntries:t.length},entries:t,projects:i,settings:{categories:this.categories,durationThreshold:this.durationThreshold}};return JSON.stringify(o,null,2)},async generateMarkdownExport(t){const e={};t.forEach(h=>{const m=h.startTime.toDateString();e[m]||(e[m]=[]),e[m].push(h)});const i=this.getDateRangeString();let o=`# Time Tracking Export${i?` - ${i}`:""}

`;o+=`**Export Date:** ${new Date().toDateString()}
`,o+=`**Total Days:** ${Object.keys(e).length}
`,o+=`**Total Entries:** ${t.length}
`,(this.exportStartDate||this.exportEndDate)&&(o+=`**Date Range:** ${this.exportStartDate||"Beginning"} to ${this.exportEndDate||"End"}
`),o+=`
`;const s=t.reduce((h,m)=>h+(m.duration||0),0);o+=`## Overall Summary
`,o+=`- **Total Tracked Time:** ${this.formatDuration(s)}
`,o+=`- **Average per Day:** ${this.formatDuration(Math.round(s/Object.keys(e).length))}

`;const c={};t.forEach(h=>{let m="unknown",S="";h.category?(m=h.category,S=h.subcategory||this.categories.find(C=>C.id===h.category)?.label||h.category):(m="unknown",S="Unknown"),c[m]||(c[m]={total:0,subcategories:{}});const O=h.duration||0;c[m].total+=O,c[m].subcategories[S]=(c[m].subcategories[S]||0)+O}),o+=`## Overall Activity Breakdown
`;for(const h of this.categories){const m=c[h.id];if(m&&m.total>0){const S=(m.total/s*100).toFixed(1);o+=`- ${h.icon} **${h.label}**: ${this.formatDuration(m.total)} (${S}%)
`;const O=Object.entries(m.subcategories);if(O.length>1||O.length===1&&O[0][0]!==h.label)for(const[C,$]of O){const K=($/s*100).toFixed(1);o+=`  - ${C}: ${this.formatDuration($)} (${K}%)
`}}}if(c.unknown&&c.unknown.total>0){const h=(c.unknown.total/s*100).toFixed(1);o+=`-  **Unknown**: ${this.formatDuration(c.unknown.total)} (${h}%)
`;const m=Object.entries(c.unknown.subcategories);if(m.length>1||m.length===1&&m[0][0]!=="Unknown")for(const[S,O]of m){const C=(O/s*100).toFixed(1);o+=`  - ${S}: ${this.formatDuration(O)} (${C}%)
`}}o+=`
---

`;const d=Object.keys(e).sort((h,m)=>new Date(m).getTime()-new Date(h).getTime());for(const h of d){const m=e[h],S=m.reduce(($,K)=>$+(K.duration||0),0);o+=`## ${h}
`,o+=`**Total:** ${this.formatDuration(S)}  **Entries:** ${m.length}

`;const O={};m.forEach($=>{let K="unknown",V="";$.category?(K=$.category,V=$.subcategory||this.categories.find(H=>H.id===$.category)?.label||$.category):(K="unknown",V="Unknown"),O[K]||(O[K]={total:0,subcategories:{}});const et=$.duration||0;O[K].total+=et,O[K].subcategories[V]=(O[K].subcategories[V]||0)+et}),o+=`### Activities
`;for(const $ of this.categories){const K=O[$.id];if(K&&K.total>0){o+=`- ${$.icon} ${$.label}: ${this.formatDuration(K.total)}
`;const V=Object.entries(K.subcategories);if(V.length>1||V.length===1&&V[0][0]!==$.label)for(const[et,H]of V)o+=`  - ${et}: ${this.formatDuration(H)}
`}}if(O.unknown&&O.unknown.total>0){o+=`-  Unknown: ${this.formatDuration(O.unknown.total)}
`;const $=Object.entries(O.unknown.subcategories);if($.length>1||$.length===1&&$[0][0]!=="Unknown")for(const[K,V]of $)o+=`  - ${K}: ${this.formatDuration(V)}
`}o+=`
### Timeline
`;const C=m.sort(($,K)=>$.startTime.getTime()-K.startTime.getTime());for(const $ of C){const K=this.formatTime($.startTime),V=$.endTime?this.formatTime($.endTime):"ongoing";let et="Unknown";if($.category){const Y=this.categories.find(Z=>Z.id===$.category);Y&&(et=`${Y.icon} ${Y.label}`,$.subcategory&&(et+=` (${$.subcategory})`))}else if($.description){const Y=$.description.toLowerCase();let Z=!1;for(const ot of this.categories)if(Y===ot.label.toLowerCase()||ot.subcategories?.some(lt=>Y===lt.toLowerCase())||Y.includes(ot.label.toLowerCase())){et=`${ot.icon} ${$.description}`,Z=!0;break}Z||(et=$.description)}const H=this.formatDuration($.duration||0);o+=`- ${K} - ${V}: ${et} (${H})
`}o+=`
`}return o},generateFilename(t){const e=new Date().toISOString().split("T")[0],i=this.getDateRangeString();return`${i?`timetracker-${i}`:`timetracker-export-${e}`}.${t}`},async chooseExportDirectory(){try{if(!("showDirectoryPicker"in window)){window.Alpine.store("notifications").showError("Directory picker not supported in this browser. Files will download to default location.");return}const t=await window.showDirectoryPicker({id:"timetracker-export-dir",mode:"readwrite"});this.defaultExportHandle=t,this.defaultExportPath=t.name,this.saveSettings(),window.Alpine.store("notifications").showSuccess(`Default export directory set to: ${t.name}`)}catch(t){t.name!=="AbortError"&&(console.error("Failed to choose directory:",t),window.Alpine.store("notifications").showError("Failed to choose export directory"))}},clearExportDirectory(){this.defaultExportPath="",this.defaultExportHandle=null,this.saveSettings(),window.Alpine.store("notifications").showSuccess("Default export directory cleared")},async saveFileWithPicker(t,e,i){try{if(this.defaultExportHandle&&"showSaveFilePicker"in window)try{const s=await(await this.defaultExportHandle.getFileHandle(e,{create:!0})).createWritable();await s.write(t),await s.close(),window.Alpine.store("notifications").showSuccess(`File saved to ${this.defaultExportPath}/${e}`);return}catch(o){console.warn("Failed to save to default directory, falling back to picker:",o)}if("showSaveFilePicker"in window)try{const s=await(await window.showSaveFilePicker({suggestedName:e,types:[{description:i.includes("json")?"JSON files":"Markdown files",accept:{[i]:[`.${e.split(".").pop()}`]}}]})).createWritable();await s.write(t),await s.close(),window.Alpine.store("notifications").showSuccess(`File saved as ${e}`)}catch(o){o.name!=="AbortError"&&(console.warn("File picker failed, falling back to download:",o),this.downloadFile(t,e,i))}else this.downloadFile(t,e,i)}catch(o){console.error("File saving failed:",o),window.Alpine.store("notifications").showError("Failed to save file")}},getDateRangeString(){return this.exportStartDate&&this.exportEndDate?`${this.exportStartDate}_to_${this.exportEndDate}`:this.exportStartDate?`from_${this.exportStartDate}`:this.exportEndDate?`until_${this.exportEndDate}`:""},async downloadFile(t,e,i){let o=t,s=e,c=i;if(this.exportCompression==="zip")try{const C=(await St(async()=>{const{default:K}=await import("./jszip.min-_lciePGk.js").then(V=>V.j);return{default:K}},[])).default,$=new C;$.file(e,t),o=await $.generateAsync({type:"uint8array",compression:"DEFLATE",compressionOptions:{level:6}}),s=e.replace(/\.(json|md)$/,".zip"),c="application/zip"}catch(C){console.error("ZIP compression failed:",C),window.Alpine.store("notifications").showError("ZIP compression failed - downloading uncompressed")}else if(this.exportCompression==="gzip")try{const $=(await St(()=>import("./pako.esm-CMINtMsn.js"),[])).gzip(t);o=new Uint8Array($),s=e+".gz",c="application/gzip"}catch(C){console.error("GZIP compression failed:",C),window.Alpine.store("notifications").showError("GZIP compression failed - downloading uncompressed")}const d=new Blob([o],{type:c}),h=URL.createObjectURL(d),m=document.createElement("a");m.href=h,m.download=s,m.click(),URL.revokeObjectURL(h);const S=this.exportFormat.toUpperCase(),O=this.exportCompression!=="none"?` (${this.exportCompression.toUpperCase()})`:"";window.Alpine.store("notifications").showSuccess(`Data exported as ${S}${O}`)},async exportSettings(){try{const{exportSettingsAsJSON:t,exportSettingsAsYAML:e,exportSettingsAsTOML:i,exportSettingsAsText:o,getSettingsExportFilename:s,getSettingsExportMimeType:c}=await St(async()=>{const{exportSettingsAsJSON:O,exportSettingsAsYAML:C,exportSettingsAsTOML:$,exportSettingsAsText:K,getSettingsExportFilename:V,getSettingsExportMimeType:et}=await import("./settings-export-Be8bFtR_.js");return{exportSettingsAsJSON:O,exportSettingsAsYAML:C,exportSettingsAsTOML:$,exportSettingsAsText:K,getSettingsExportFilename:V,getSettingsExportMimeType:et}},[]);let d;switch(this.settingsExportFormat){case"json":d=t();break;case"yaml":d=e();break;case"toml":d=i();break;case"txt":d=o();break;default:d=e()}const h=s(this.settingsExportFormat),m=c(this.settingsExportFormat);await this.saveFileWithPicker(d,h,m);const S=this.settingsExportFormat.toUpperCase();window.Alpine.store("notifications").showSuccess(`Settings exported as ${S}`)}catch(t){console.error("Settings export failed:",t),window.Alpine.store("notifications").showError("Failed to export settings")}},async handleImportFileSelection(t){const i=t.target.files?.[0];if(!i){this.resetImportState();return}this.settingsImportFile=i;try{const o=await this.readFileContent(i);await this.previewImportSettings(i.name,o)}catch(o){console.error("Failed to read file:",o),window.Alpine.store("notifications").showError("Failed to read the selected file"),this.resetImportState()}},readFileContent(t){return new Promise((e,i)=>{const o=new FileReader;o.onload=s=>{const c=s.target?.result;typeof c=="string"?e(c):i(new Error("Failed to read file as text"))},o.onerror=()=>i(o.error),o.readAsText(t)})},async previewImportSettings(t,e){try{const{previewSettings:i}=await St(async()=>{const{previewSettings:s}=await import("./settings-import-DppVEF-q.js");return{previewSettings:s}},__vite__mapDeps([0,1])),o=await i(t,e);o.success?(this.settingsImportPreview=o.preview,this.settingsImportFormat=o.format||"Unknown",this.settingsImportValidation=o.validation||{isValid:!0,errors:[],warnings:[]},this.showImportPreview=!0):(window.Alpine.store("notifications").showError(o.message),this.resetImportState())}catch(i){console.error("Preview failed:",i),window.Alpine.store("notifications").showError("Failed to preview settings file"),this.resetImportState()}},async importSettings(t="replace"){if(!this.settingsImportFile){window.Alpine.store("notifications").showError("No file selected for import");return}try{const e=await this.readFileContent(this.settingsImportFile),{importSettings:i}=await St(async()=>{const{importSettings:s}=await import("./settings-import-DppVEF-q.js");return{importSettings:s}},__vite__mapDeps([0,1])),o=await i(this.settingsImportFile.name,e,t);if(o.success){this.loadSettings(),this.createSnapshot(),this.loadSettingsBackups(),this.notifyActivitiesUpdate();let s=`Settings successfully imported from ${this.settingsImportFormat} file`;o.warnings&&o.warnings.length>0&&(s+=` (${o.warnings.length} warning${o.warnings.length>1?"s":""})`),window.Alpine.store("notifications").showSuccess(s),this.resetImportState()}else{let s=o.message;o.errors&&o.errors.length>0&&(s+=`

Errors:
- ${o.errors.join(`
- `)}`),o.warnings&&o.warnings.length>0&&(s+=`

Warnings:
- ${o.warnings.join(`
- `)}`),window.Alpine.store("notifications").showError(s)}}catch(e){console.error("Import failed:",e),window.Alpine.store("notifications").showError("Settings import failed")}},cancelImport(){this.resetImportState(),window.Alpine.store("notifications").showInfo("Import cancelled")},resetImportState(){this.settingsImportFile=null,this.settingsImportPreview=null,this.settingsImportFormat="",this.settingsImportValidation=null,this.showImportPreview=!1;const t=document.getElementById("settings-import-file");t&&(t.value="")},async loadSettingsBackups(){try{const{getSettingsBackups:t}=await St(async()=>{const{getSettingsBackups:e}=await import("./settings-backup-D_tuVzAd.js");return{getSettingsBackups:e}},[]);this.settingsBackups=t()}catch(t){console.error("Failed to load settings backups:",t),this.settingsBackups=[]}},async createManualBackup(){try{const{createSettingsBackup:t}=await St(async()=>{const{createSettingsBackup:o}=await import("./settings-backup-D_tuVzAd.js");return{createSettingsBackup:o}},[]),e={durationThreshold:this.durationThreshold,timeRounding:this.timeRounding,categories:this.categories,currentPreset:this.currentPreset,defaultExportPath:this.defaultExportPath};t(e,"Manual backup","manual")?(this.loadSettingsBackups(),window.Alpine.store("notifications").showSuccess("Settings backup created")):window.Alpine.store("notifications").showError("Failed to create backup")}catch(t){console.error("Failed to create manual backup:",t),window.Alpine.store("notifications").showError("Failed to create backup")}},async restoreFromBackup(t){try{const{restoreFromBackup:e}=await St(async()=>{const{restoreFromBackup:o}=await import("./settings-backup-D_tuVzAd.js");return{restoreFromBackup:o}},[]),i=e(t);i.success?(this.loadSettings(),this.createSnapshot(),this.loadSettingsBackups(),this.notifyActivitiesUpdate(),window.Alpine.store("notifications").showSuccess(i.message)):window.Alpine.store("notifications").showError(i.message)}catch(e){console.error("Failed to restore from backup:",e),window.Alpine.store("notifications").showError("Failed to restore from backup")}},async deleteBackup(t){try{const{deleteBackup:e}=await St(async()=>{const{deleteBackup:o}=await import("./settings-backup-D_tuVzAd.js");return{deleteBackup:o}},[]);e(t)?(this.loadSettingsBackups(),window.Alpine.store("notifications").showSuccess("Backup deleted")):window.Alpine.store("notifications").showError("Failed to delete backup")}catch(e){console.error("Failed to delete backup:",e),window.Alpine.store("notifications").showError("Failed to delete backup")}},async clearAllBackups(){if(confirm("Are you sure you want to delete all settings backups? This cannot be undone."))try{const{clearAllBackups:t}=await St(async()=>{const{clearAllBackups:i}=await import("./settings-backup-D_tuVzAd.js");return{clearAllBackups:i}},[]);t()?(this.loadSettingsBackups(),window.Alpine.store("notifications").showSuccess("All backups cleared")):window.Alpine.store("notifications").showError("Failed to clear backups")}catch(t){console.error("Failed to clear backups:",t),window.Alpine.store("notifications").showError("Failed to clear backups")}},formatBackupDescription(t){try{const e=new Date(t.timestamp).toLocaleDateString(),i=new Date(t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return`${t.description} (${e} ${i})`}catch{return t.description||"Unknown backup"}},getBackupSourceIcon(t){switch(t){case"import":return"";case"reset":return"";case"preset":return"";case"manual":return"";default:return""}},formatTime(t){return t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})},formatDuration(t){if(t<60)return`${t}s`;const e=Math.floor(t/60);if(e<60)return`${e}m`;const i=Math.floor(e/60),o=e%60;return o>0?`${i}h ${o}m`:`${i}h`}});let Qo=!1;const Pl=()=>({notifications:[],init(){if(Qo)return;Qo=!0;const t=e=>{const i=e,{type:o,message:s,importance:c="medium"}=i.detail;this.show(o,s,c)};window.addEventListener("show-notification",t)},show(t,e,i="medium",o){const s={id:ge(),type:t,message:e,timestamp:new Date,importance:i,duration:o};this.notifications.push(s);const c=o??this.getAutoDuration(t,i);setTimeout(()=>{this.remove(s.id)},c)},showError(t,e="high"){this.show("error",t,e)},showSuccess(t,e="medium"){this.show("success",t,e)},showWarning(t,e="medium"){this.show("warning",t,e)},showInfo(t,e="low"){this.show("info",t,e)},get visibleNotifications(){return this.notifications.filter(t=>t.importance==="medium"||t.importance==="high"||t.importance==="critical")},getAutoDuration(t,e){return e==="critical"?8e3:e==="high"?6e3:e==="medium"?4e3:t==="success"?2e3:3e3},remove(t){this.notifications=this.notifications.filter(e=>e.id!==t)},clear(){this.notifications=[]},getTypeIcon(t){switch(t){case"success":return"";case"error":return"";case"warning":return"!";case"info":return"i";default:return"i"}},getTypeClasses(t){switch(t){case"success":return"border-green-200 bg-green-50/50 text-green-700 dark:border-green-800 dark:bg-green-950/30 dark:text-green-300";case"error":return"border-red-200 bg-red-50/50 text-red-700 dark:border-red-800 dark:bg-red-950/30 dark:text-red-300";case"warning":return"border-yellow-200 bg-yellow-50/50 text-yellow-700 dark:border-yellow-800 dark:bg-yellow-950/30 dark:text-yellow-300";case"info":return"border-blue-200 bg-blue-50/50 text-blue-700 dark:border-blue-800 dark:bg-blue-950/30 dark:text-blue-300";default:return"border-gray-200 bg-gray-50/50 text-gray-600 dark:border-gray-700 dark:bg-gray-900/30 dark:text-gray-400"}}});window.Alpine=Ot;function Cl(){const t=localStorage.getItem("theme");return t==="light"||t==="dark"?t:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}Ot.store("theme",{theme:Cl(),init(){this.apply(),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{localStorage.getItem("theme")||(this.theme=e.matches?"dark":"light",this.apply())})},set(t){this.theme=t,localStorage.setItem("theme",t),this.apply()},toggle(){this.set(this.theme==="dark"?"light":"dark")},apply(){document.documentElement.classList.toggle("dark",this.theme==="dark")}});Ot.store("notifications",{showError(t,e="high"){window.dispatchEvent(new CustomEvent("show-notification",{detail:{type:"error",message:t,importance:e}}))},showSuccess(t,e="medium"){window.dispatchEvent(new CustomEvent("show-notification",{detail:{type:"success",message:t,importance:e}}))},showWarning(t,e="medium"){window.dispatchEvent(new CustomEvent("show-notification",{detail:{type:"warning",message:t,importance:e}}))},showInfo(t,e="low"){window.dispatchEvent(new CustomEvent("show-notification",{detail:{type:"info",message:t,importance:e}}))}});Ot.data("appState",al);Ot.data("activities",fl);Ot.data("timer",vl);Ot.data("timeline",_l);Ot.data("insights",Sl);Ot.data("settings",Ol);Ot.data("notifications",Pl);Ot.start();export{lr as a,zo as b,sl as c,ul as g,Wl as u};
